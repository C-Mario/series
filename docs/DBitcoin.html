<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jose Valdes">

<title>Series de Tiempo - Descriptiva-josé</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ninguna coincidencia",
    "search-matching-documents-text": "coincidencias",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": ""
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series de Tiempo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DExportaciones.html" rel="" target="">
 <span class="menu-text">Descriptiva-Serie-Exportaciones</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./DBitcoin.html" rel="" target="" aria-current="page">
 <span class="menu-text">Descriptiva-josé</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./redes.html" rel="" target="">
 <span class="menu-text">Redes neuronales</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ejemplo.html" rel="" target="">
 <span class="menu-text">Descriptiva-josé</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/C-Mario/series" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">GitHub</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
  <li><a href="#trabajo-con-la-serie-bitcoin" id="toc-trabajo-con-la-serie-bitcoin" class="nav-link active" data-scroll-target="#trabajo-con-la-serie-bitcoin"><span class="header-section-number">1</span> Trabajo con la serie Bitcoin</a>
  <ul class="collapse">
  <li><a href="#probando-xts" id="toc-probando-xts" class="nav-link" data-scroll-target="#probando-xts"><span class="header-section-number">1.0.1</span> Probando xts</a></li>
  <li><a href="#análisis-de-varianza" id="toc-análisis-de-varianza" class="nav-link" data-scroll-target="#análisis-de-varianza"><span class="header-section-number">1.0.2</span> Análisis de varianza</a></li>
  <li><a href="#análisis-de-tendencia" id="toc-análisis-de-tendencia" class="nav-link" data-scroll-target="#análisis-de-tendencia"><span class="header-section-number">1.0.3</span> Análisis de tendencia</a></li>
  <li><a href="#serie-diferenciada" id="toc-serie-diferenciada" class="nav-link" data-scroll-target="#serie-diferenciada"><span class="header-section-number">1.1</span> Serie Diferenciada</a></li>
  <li><a href="#análisis-de-estacionalidad" id="toc-análisis-de-estacionalidad" class="nav-link" data-scroll-target="#análisis-de-estacionalidad"><span class="header-section-number">1.2</span> Análisis de Estacionalidad</a>
  <ul class="collapse">
  <li><a href="#mapas-de-calor" id="toc-mapas-de-calor" class="nav-link" data-scroll-target="#mapas-de-calor"><span class="header-section-number">1.2.1</span> Mapas de calor</a></li>
  <li><a href="#periodograma" id="toc-periodograma" class="nav-link" data-scroll-target="#periodograma"><span class="header-section-number">1.2.2</span> Periodograma</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Descriptiva-josé</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Código</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autores</div>
    <div class="quarto-title-meta-contents">
             <p>Jose Valdes </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="trabajo-con-la-serie-bitcoin" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Trabajo con la serie Bitcoin</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#datos</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>BTC_Daily <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"datos/BTC-Daily.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(BTC_Daily<span class="sc">$</span>date,BTC_Daily<span class="sc">$</span>close)</span>
<span id="cb1-4"><a href="#cb1-4"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(BTC_Daily<span class="sc">$</span>date,BTC_Daily<span class="sc">$</span>close)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">colnames</span>(Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FechaTiempo"</span>, <span class="st">"Valor"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># limpiando datos faltantes</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">str</span>(Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2651 obs. of  2 variables:
 $ FechaTiempo: chr  "2022-03-01 00:00:00" "2022-02-28 00:00:00" "2022-02-27 00:00:00" "2022-02-26 00:00:00" ...
 $ Valor      : num  43185 43179 37713 39147 39232 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>Data<span class="sc">$</span>FechaTiempo <span class="ot">&lt;-</span> <span class="fu">strftime</span>(Data<span class="sc">$</span>FechaTiempo, <span class="at">format=</span><span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">str</span>(Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2651 obs. of  2 variables:
 $ FechaTiempo: chr  "2022-03-01" "2022-02-28" "2022-02-27" "2022-02-26" ...
 $ Valor      : num  43185 43179 37713 39147 39232 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>Data<span class="sc">$</span>FechaTiempo <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(Data<span class="sc">$</span>FechaTiempo)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># procesamiento de los datos</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>Bitcoin <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>      <span class="fu">filter</span>(FechaTiempo <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>),</span>
<span id="cb5-6"><a href="#cb5-6"></a>             FechaTiempo <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-31"</span>))</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="fu">str</span>(Bitcoin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1826 obs. of  2 variables:
 $ FechaTiempo: Date, format: "2021-12-31" "2021-12-30" ...
 $ Valor      : num  46214 47151 46483 47543 50718 ...</code></pre>
</div>
</div>
<section id="probando-xts" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1" class="anchored" data-anchor-id="probando-xts"><span class="header-section-number">1.0.1</span> Probando xts</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># objeto serie de tiempo</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>Data_xts <span class="ot">&lt;-</span> xts<span class="sc">::</span><span class="fu">xts</span>(Bitcoin<span class="sc">$</span>Valor, <span class="at">order.by =</span> Bitcoin<span class="sc">$</span>FechaTiempo)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">head</span>(Data_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]
2017-01-01  998.80
2017-01-02 1014.10
2017-01-03 1036.99
2017-01-04 1122.56
2017-01-05  994.02
2017-01-06  891.56</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>TSstudio<span class="sc">::</span><span class="fu">ts_info</span>(Data_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> The Data_xts series is a xts object with 1 variable and 1826 observations
 Frequency: daily 
 Start time: 2017-01-01 
 End time: 2021-12-31 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">#class(Data_xts)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#frequency(Data_xts)</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#xts::periodicity(Data_xts)</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#xts::tclass(Data_xts)</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#plot(Data_xts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vista de los datos para inspección visual</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>TSstudio<span class="sc">::</span><span class="fu">ts_plot</span>(Data_xts,</span>
<span id="cb12-2"><a href="#cb12-2"></a>         <span class="at">title =</span> <span class="st">"Valor de cierre bitcoin en bolsa"</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>         <span class="at">Ytitle =</span> <span class="st">"Valor en dolares"</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>          <span class="at">Xtitle =</span> <span class="st">"Fecha"</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>          <span class="at">Xgrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-6"><a href="#cb12-6"></a>       <span class="at">Ygrid =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
</div>
</div>
<ul>
<li><p><strong>Varianza marginal:</strong> Se notan periodos donde el rango de valores que puede tomar la variable se va fluctuando a medida que pasa el tiempo.</p></li>
<li><p><strong>Componente Estacional:</strong> No se evidencia un comportamiento cíclico en la serie.</p></li>
<li><p><strong>Tendencia:</strong> Se muestra la serie <strong>no</strong> oscila sobre un valor fijo y tiene cambios abruptos de crecimiento y decrecimiento en algunos momentos.</p></li>
</ul>
</section>
<section id="análisis-de-varianza" class="level3" data-number="1.0.2">
<h3 data-number="1.0.2" class="anchored" data-anchor-id="análisis-de-varianza"><span class="header-section-number">1.0.2</span> Análisis de varianza</h3>
<p>Usaremos la transformación de <strong>Box-Cox</strong> para estabilizar la varianza; primero miramos el lambda</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">#Valor de lambda</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>forecast<span class="sc">::</span><span class="fu">BoxCox.lambda</span>(Data_xts, <span class="at">method =</span><span class="st">"loglik"</span>, <span class="at">lower =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(Data_xts <span class="sc">~</span> <span class="dv">1</span>),<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">length =</span> <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Vemos que se sugiere el valor <span class="math inline">\(\lambda = 0\)</span> lo cual dada de transformación de Box-Cox se usa la función logaritmo natural para la estabilización de la variabilidad así tenemos que:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">#trasnformación</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>lData_xts <span class="ot">&lt;-</span> <span class="fu">log</span>(Data_xts)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#plot(lData_xts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>TSstudio<span class="sc">::</span><span class="fu">ts_plot</span>(lData_xts,</span>
<span id="cb18-2"><a href="#cb18-2"></a>          <span class="at">title =</span> <span class="st">"Valor de Serie Trasnformada"</span>,</span>
<span id="cb18-3"><a href="#cb18-3"></a>           <span class="at">Ytitle =</span> <span class="st">"Valor de la trasnformación"</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>          <span class="at">Xtitle =</span> <span class="st">"Fecha"</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>          <span class="at">Xgrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>           <span class="at">Ygrid =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
</div>
</div>
<p>Ahora miramos si es necesario aplicar otra transformación a la serie</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">#Valor de lambda</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>(forecast<span class="sc">::</span><span class="fu">BoxCox.lambda</span>(lData_xts, <span class="at">method =</span><span class="st">"loglik"</span>, <span class="at">lower =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(lData_xts <span class="sc">~</span> <span class="dv">1</span>),<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Vemos que la sugerencia es <span class="math inline">\(\lambda = 0.9\)</span> lo cual es cercano a <span class="math inline">\(1\)</span>, además el IC de confianza captura al <span class="math inline">\(1\)</span>, por ende la transformación logarítmica parece haber estabilizado la varianza.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">#Gráfico de ellas juntas</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">plot</span>(Data_xts, <span class="at">main =</span> <span class="st">"Series original"</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="fu">plot</span>(lData_xts, <span class="at">main =</span> <span class="st">"Series transformada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Se puede ver cómo la transformación aplicada logra estabilizar la varianza en gran medida.</p>
</section>
<section id="análisis-de-tendencia" class="level3" data-number="1.0.3">
<h3 data-number="1.0.3" class="anchored" data-anchor-id="análisis-de-tendencia"><span class="header-section-number">1.0.3</span> Análisis de tendencia</h3>
<p>Trabajaremos con la serie a la cuál se le realizo la transformación para estabilizar la varianza, realizaremos el gráfico de los valores de la función de auto-correlación</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">#ACf</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">acf</span>(lData_xts, <span class="dv">180</span>, <span class="at">main =</span> <span class="st">"Serie Bitcoin Trasnformada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notamos que los valores van teniendo un decaimiento leve lo cual nos da un indicio más claro de que existe tendencia en la serie, analizaremos el gráfico de retardos de la serie trasnformada para ver si podemos tener indicios de una relación <em>no-lineal o lineal</em> en la serie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">#serie transformada</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb24-3"><a href="#cb24-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(lData_xts, <span class="dv">16</span>,<span class="at">corr=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Vemos que se nota un fuerte relación linea hasta para el retraso número 16, por lo tanto con lo mostrado por el <em>acf</em> y <em>el gráfico de retardos</em> tenemos indicios fuertes de tendencia en la serie así usaremos los métodos: <em>lineal determinista, Descomposición de</em> <em>promedios móviles y descomposición STL</em> para estimar dicha componente.</p>
<section id="lineal-determinista" class="level4" data-number="1.0.3.1">
<h4 data-number="1.0.3.1" class="anchored" data-anchor-id="lineal-determinista"><span class="header-section-number">1.0.3.1</span> Lineal determinista</h4>
<p>ajustaremos el modelo eliminaremos la tendencia y analizaremos los resultados</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">#pasar a ts para Graficarlo</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>ldata_ts <span class="ot">&lt;-</span> TSstudio<span class="sc">::</span><span class="fu">xts_to_ts</span>(lData_xts,<span class="at">frequency =</span> <span class="dv">365</span>,</span>
<span id="cb25-3"><a href="#cb25-3"></a>                                <span class="at">start =</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>))</span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co">#modelo lineal</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(ldata_ts<span class="sc">~</span><span class="fu">time</span>(ldata_ts), <span class="at">na.action=</span><span class="cn">NULL</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ldata_ts ~ time(ldata_ts), na.action = NULL)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.06366 -0.49265  0.01902  0.36341  1.68667 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    -1.230e+03  1.780e+01  -69.10   &lt;2e-16 ***
time(ldata_ts)  6.135e-01  8.813e-03   69.61   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5439 on 1824 degrees of freedom
Multiple R-squared:  0.7265,    Adjusted R-squared:  0.7264 
F-statistic:  4846 on 1 and 1824 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Gráfico</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="fu">abline</span>(fit,<span class="at">col =</span> <span class="st">"red"</span>)<span class="co"># Se añade la recta ajusta</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ahora eliminaremos la tendencia de la serie</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="do">###Eliminamos la tendencia con la predicción la recta</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> <span class="fu">predict</span>(fit)</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb28-4"><a href="#cb28-4"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Observamos que en la serie obtenida después de eliminar la tendencia lineal parece tener un comportamiento de alta variabilidad similar una <em>caminata aleatoria.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">acf</span>(ElimTenldata_ts,<span class="at">lag.max =</span><span class="fu">length</span>(ElimTenldata_ts), </span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb30-3"><a href="#cb30-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts, <span class="dv">16</span>,<span class="at">corr=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notamos que en la gráfica del <strong>acf</strong> se sigue teniendo un decaimiento lento de los valores de la función de auto-correlación para los primeros rezagos, además en el <strong>gráfico de retardos</strong> se sigue manteniendo una alta relación lineal entre el valor actual y sus regazos. Por ende todo esto nos da los argumentos necesarios para <strong>descartar</strong> <em>la estimación linealcómo una buena estimación de la tendencia.</em></p>
</section>
<section id="descomposición-por-promedio-móviles" class="level4" data-number="1.0.3.2">
<h4 data-number="1.0.3.2" class="anchored" data-anchor-id="descomposición-por-promedio-móviles"><span class="header-section-number">1.0.3.2</span> Descomposición por promedio móviles</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># descomposición de promedios moviles</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>descom_ldata <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ldata_ts)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">plot</span>(descom_ldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Podemos observar que usando <strong>un filtro de promedio móvil</strong> la tendencia estimada no se aproxima mucho a una lineal, cómo se puede apreciar en el siguiente gráfico; además la componente estacional no parece ser estimada de buena manera ya que no se ve un patrón de comportamiento claramente, además el residual presenta un comportamiento no estacionario aparentemente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Gráfico</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="fu">abline</span>(fit,<span class="at">col =</span> <span class="st">"red"</span>)<span class="co"># Se añade la recta ajusta</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), descom_ldata<span class="sc">$</span>trend, <span class="at">col =</span><span class="st">"green"</span>, <span class="at">cex=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Eliminaremos la tendencia del promedio móvil centrado y de la frecuencia</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="do">###Eliminamos la tendencia con la predicción promedio movil</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> descom_ldata<span class="sc">$</span>trend</span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb33-4"><a href="#cb33-4"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Podemos ver que la serie cómo en el caso <em>lineal</em> parece mostrar un comportamiento de <em>caminata aleatoria</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">acf</span>(ElimTenldata_ts[<span class="dv">183</span><span class="sc">:</span><span class="dv">1644</span>],<span class="at">lag.max =</span> <span class="dv">730</span>, </span>
<span id="cb34-2"><a href="#cb34-2"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb35-3"><a href="#cb35-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts[<span class="dv">183</span><span class="sc">:</span><span class="dv">1644</span>], <span class="dv">16</span>,<span class="at">corr=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notamos que tanto en el <strong>acf</strong> cómo en <strong>la gráfica de retardos</strong> se ve un comportamiento similar al anterior lo cuál nos hace descartar <em>la descompsición de promedios moviles</em> para la estimación de la tendencia.</p>
<p><strong><em>Filtro promedio móvil con solo retrasos</em></strong></p>
<p>Intentaremos ajustar un promedio móvil que tenga en cuenta solo los retrasos y sea de los periodos de un año, seis meses, tres meses y mes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">#gráfico</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>filter_1<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>, <span class="dv">365</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb36-3"><a href="#cb36-3"></a>filter_2<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">182</span>, <span class="dv">182</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a>filter_3<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">90</span>, <span class="dv">90</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a>filter_4<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>, <span class="dv">30</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_1, <span class="at">col =</span><span class="st">"green"</span>, <span class="at">cex=</span><span class="fl">0.33</span>)</span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_2, <span class="at">col =</span><span class="st">"blue"</span>, <span class="at">cex=</span><span class="fl">0.33</span>)</span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_3, <span class="at">col =</span><span class="st">"red"</span>, <span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_4, <span class="at">col =</span><span class="st">"cyan"</span>, <span class="at">cex=</span><span class="fl">0.31</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">#legend(locator(1), c("365 días","182 días","90 días","30 días"), col=c("green","blue","red","cyan"),lty=c(1,1,1,1),lwd=c(2,2,2,2))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notamos que para <em>3 meses</em> y <em>6 meses</em> los filtros de promedios móviles muestra una mejor estimación, por ende tomaremos para <em>3 meses</em> cómo estimación de la tendencia de la serie</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="do">###Eliminamos la tendencia con la predicción promedio movil</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> filter_3</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb38-4"><a href="#cb38-4"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">#</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="fu">acf</span>(ElimTenldata_ts[<span class="dv">90</span><span class="sc">:</span><span class="dv">1826</span>],<span class="at">lag.max =</span><span class="dv">1095</span>, </span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb40-3"><a href="#cb40-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts[<span class="dv">90</span><span class="sc">:</span><span class="dv">1826</span>], <span class="dv">16</span>,<span class="at">corr=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El comportamiento de los gráficos es similar a los anteriores con eso tenemos indicios de que la estimación de la tendencia de manera determinista potencialmente no es buena idea.</p>
</section>
<section id="descomposición-stl" class="level4" data-number="1.0.3.3">
<h4 data-number="1.0.3.3" class="anchored" data-anchor-id="descomposición-stl"><span class="header-section-number">1.0.3.3</span> Descomposición STL</h4>
<p>Usando la descomposición <strong>STL</strong> obtenemos la estimación de la tendencia</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>indice_ldata <span class="ot">&lt;-</span> <span class="fu">sort</span>(Bitcoin<span class="sc">$</span>FechaTiempo)</span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co">#  as.Date(as.yearmon(tk_index(ldata_ts)))</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="do">## Otra forma de extraer el indice estimetk::tk_index(lAirPass)</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>logdata <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ldata_ts)</span>
<span id="cb41-5"><a href="#cb41-5"></a>df_ldata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fecha=</span>indice_ldata,<span class="at">logdata=</span><span class="fu">as.matrix</span>(ldata_ts))</span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="fu">str</span>(df_ldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1826 obs. of  2 variables:
 $ Fecha   : Date, format: "2017-01-01" "2017-01-02" ...
 $ Series.1: num  6.91 6.92 6.94 7.02 6.9 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">colnames</span>(df_ldata) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fecha"</span>, <span class="st">"logdata"</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="fu">str</span>(df_ldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1826 obs. of  2 variables:
 $ Fecha  : Date, format: "2017-01-01" "2017-01-02" ...
 $ logdata: num  6.91 6.92 6.94 7.02 6.9 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>tibble_ldata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(df_ldata)</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="do">####Primera aproximación del ajuste STL</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>tibble_ldata<span class="sc">%&gt;%</span>timetk<span class="sc">::</span><span class="fu">plot_time_series</span>(Fecha, logdata, </span>
<span id="cb45-4"><a href="#cb45-4"></a>                   <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-5"><a href="#cb45-5"></a>                   <span class="at">.plotly_slider =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="do">#####Ajuste STL</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="co">#Note que obtenemos un objeto adicional en tibble_logpasajeros con Logpasa_ajus con parámetros que se pueden mover.</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>logdata_ajus <span class="ot">&lt;-</span> <span class="fu">smooth_vec</span>(logdata,<span class="at">span =</span> <span class="fl">0.75</span>, <span class="at">degree =</span> <span class="dv">2</span>)</span>
<span id="cb46-4"><a href="#cb46-4"></a>tibble_ldata<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">mutate</span>(logdata_ajus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,826 × 3
   Fecha      logdata logdata_ajus
   &lt;date&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 2017-01-01    6.91         6.90
 2 2017-01-02    6.92         6.91
 3 2017-01-03    6.94         6.91
 4 2017-01-04    7.02         6.92
 5 2017-01-05    6.90         6.92
 6 2017-01-06    6.79         6.93
 7 2017-01-07    6.80         6.94
 8 2017-01-08    6.81         6.94
 9 2017-01-09    6.80         6.95
10 2017-01-10    6.81         6.96
# ℹ 1,816 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="do">###Ajuste STL moviendo los parámetros</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>tibble_ldata<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">logdata_ajus=</span><span class="fu">smooth_vec</span>(logdata,<span class="at">span =</span> <span class="fl">0.75</span>, <span class="at">degree =</span> <span class="dv">2</span>))<span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Fecha, logdata)) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> logdata_ajus), <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Se puede evidenciar que la Estimación de la tendencia via <em>STL</em> parece mejorar aspectos que la <em>descomposición movil</em> intentada con información de un año no se tenia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="do">###Eliminamos la tendencia con la predicción la STL</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>ElimTenldata_xts <span class="ot">&lt;-</span> lData_xts <span class="sc">-</span> logdata_ajus</span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="fu">plot</span>(ElimTenldata_xts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb49-4"><a href="#cb49-4"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">acf</span>(ElimTenldata_xts,<span class="at">lag.max =</span><span class="dv">1094</span>, </span>
<span id="cb50-2"><a href="#cb50-2"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb51-3"><a href="#cb51-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_xts, <span class="dv">16</span>,<span class="at">corr=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Vemos que a diferencia de los promedio móviles si tenemos una estimación para todos los valores de la serie, además notamos que la <strong>acf</strong> y <strong>el gráfico de retardos</strong> tiene un comportamiento similar a los métodos anteriores.</p>
</section>
</section>
<section id="serie-diferenciada" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="serie-diferenciada"><span class="header-section-number">1.1</span> Serie Diferenciada</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="do">###Diferenciando con base en el objeto ts</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>dldata<span class="ot">&lt;-</span><span class="fu">diff</span>(ldata_ts)</span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="co">#plot(dldata)</span></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="co">#abline(h=0, col = "red")</span></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="co">#acf(dldata,lag.max =90, main="Serie Diferenciada")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="do">###Diferenciando con base en el objeto xts</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>dldata_xts<span class="ot">&lt;-</span><span class="fu">diff</span>(lData_xts)</span>
<span id="cb53-3"><a href="#cb53-3"></a>dldata_xts <span class="ot">&lt;-</span> dldata_xts[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="fu">plot</span>(dldata_xts, <span class="at">main =</span> <span class="st">"Serie diferenciada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Vemos que la serie al ser diferenciada muestra un comportamiento estacionario pues los valores oscilan sobre un valor fijo, además de un valor que muestra un comportamiento extremo pues varia demasiado con respecto a los demás.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># función de autocorrelación</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="fu">acf</span>(dldata_xts,<span class="at">lag.max =</span><span class="dv">30</span>, <span class="at">main=</span><span class="st">"Serie Diferenciada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb55-3"><a href="#cb55-3"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(dldata_xts, <span class="dv">16</span>,<span class="at">corr=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El gráfico de <strong>acf</strong> muestra que la tendencia parce a ver desparecido, además no parece destacar ningún valor para algún retraso de manera clara. Para el <strong>gráfico de retardos</strong> vemos claramente que ya no hay una relación lineal ni no lineal del valor actual con sus retardos.</p>
<p>Tomando en cuenta todo lo anterior trabajaremos con la serie aplicada la transformación de Box-Cox sugerida y diferenciada, además se tiene sospecha de que la serie presenta comportamiento de una camina aleatoria con tendencia no determinista.</p>
</section>
<section id="análisis-de-estacionalidad" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="análisis-de-estacionalidad"><span class="header-section-number">1.2</span> Análisis de Estacionalidad</h2>
<section id="mapas-de-calor" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="mapas-de-calor"><span class="header-section-number">1.2.1</span> Mapas de calor</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co">#Serie diferenciada</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>TSstudio<span class="sc">::</span><span class="fu">ts_heatmap</span>(dldata_xts, <span class="at">title =</span> <span class="st">"Mapa de calor - Cierre Bitcoin en bolsa dias año"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
</div>
</div>
<p>Para la serie diferenciada no se evidencia ninguno tipo de patrón lo cual nos da indicios de que no se tiene un componente estacional.</p>
</section>
<section id="periodograma" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="periodograma"><span class="header-section-number">1.2.2</span> Periodograma</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># periodograma</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>Periodograma <span class="ot">&lt;-</span> <span class="fu">spectrum</span>(<span class="fu">as.numeric</span>(dldata_xts),<span class="at">log=</span><span class="st">"no"</span>,<span class="at">span=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DBitcoin_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co">#</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>ubicacionDif <span class="ot">&lt;-</span> <span class="fu">which.max</span>(Periodograma<span class="sc">$</span>spec)</span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="fu">sprintf</span>(<span class="st">"El valor de la frecuencia donde se máximiza el periodograma para la serie es: %s"</span>,Periodograma<span class="sc">$</span>freq[ubicacionDif])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El valor de la frecuencia donde se máximiza el periodograma para la serie es: 0.4016"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co">#</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="fu">sprintf</span>(<span class="st">"El periodo correspondiente es aproximadamente: %s"</span>,<span class="dv">1</span><span class="sc">/</span>Periodograma<span class="sc">$</span>freq[ubicacionDif])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El periodo correspondiente es aproximadamente: 2.49003984063745"</code></pre>
</div>
</div>
<p>Para la serie diferenciada el periodograma no es claro, a pesar del suviazamiento usado la curva sigue mostrando varios picos en su recorrido el máximo lo encontramos de tal manera que <span class="math inline">\(\omega = \frac{251}{625}=0.416\)</span> lo cual se corresponde con un <span class="math inline">\(s \approx 2.5\)</span> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># intentando sacar el segundo más alto</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>n_dld <span class="ot">&lt;-</span> <span class="fu">length</span>(Periodograma<span class="sc">$</span>spec)</span>
<span id="cb62-3"><a href="#cb62-3"></a>valor_seg <span class="ot">&lt;-</span> <span class="fu">sort</span>(Periodograma<span class="sc">$</span>spec,<span class="at">partial=</span>n_dld<span class="dv">-1</span>)[n_dld<span class="dv">-1</span>]</span>
<span id="cb62-4"><a href="#cb62-4"></a>ubica_segundo <span class="ot">&lt;-</span> <span class="fu">which</span>(Periodograma<span class="sc">$</span>spec<span class="sc">==</span>valor_seg)</span>
<span id="cb62-5"><a href="#cb62-5"></a></span>
<span id="cb62-6"><a href="#cb62-6"></a><span class="fu">sprintf</span>(<span class="st">"El valor de la frecuencia donde se alcanza el segundo máximo para el periodograma para REC es: %s"</span>,Periodograma<span class="sc">$</span>freq[ubica_segundo])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El valor de la frecuencia donde se alcanza el segundo máximo para el periodograma para REC es: 0.401066666666667"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">#</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">sprintf</span>(<span class="st">"El periodo correspondiente es aproximadamente: %s"</span>,<span class="dv">1</span><span class="sc">/</span>Periodograma<span class="sc">$</span>freq[ubica_segundo])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El periodo correspondiente es aproximadamente: 2.49335106382979"</code></pre>
</div>
</div>
<p>vemos que el segundo valor es bastante parecido al segundo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># valor de frecuencia </span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="fu">tail</span>(<span class="fu">sort</span>(Periodograma<span class="sc">$</span>spec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.004895118 0.004914000 0.005095353 0.005470611 0.005752230 0.005966273</code></pre>
</div>
</div>
<p>Cómo se puede observar los primeros seis valores son bastante cercanos entre ellos, por lo tanto sus valores de periodo serán similiares.</p>
<p>Con esto <strong>descartamos</strong> la estimación de una componente estacional pues no tenemos evidencia clara de su existencia.</p>


<!-- -->

</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Volver arriba</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb68" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb68-1"><a href="#cb68-1"></a><span class="co">---</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="an">title:</span><span class="co"> "Descriptiva-josé"</span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="an">author:</span><span class="co"> "Jose Valdes"</span></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="an">lag:</span><span class="co"> es</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb68-8"><a href="#cb68-8"></a><span class="co">---</span></span>
<span id="cb68-9"><a href="#cb68-9"></a></span>
<span id="cb68-12"><a href="#cb68-12"></a><span class="in">```{r}</span></span>
<span id="cb68-13"><a href="#cb68-13"></a><span class="co">#| include: false</span></span>
<span id="cb68-14"><a href="#cb68-14"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb68-15"><a href="#cb68-15"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb68-16"><a href="#cb68-16"></a><span class="fu">library</span>(timetk)</span>
<span id="cb68-17"><a href="#cb68-17"></a><span class="fu">library</span>(tibble)</span>
<span id="cb68-18"><a href="#cb68-18"></a><span class="fu">library</span>(zoo)</span>
<span id="cb68-19"><a href="#cb68-19"></a><span class="fu">library</span>(fable)</span>
<span id="cb68-20"><a href="#cb68-20"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb68-21"><a href="#cb68-21"></a><span class="fu">library</span>(feasts)</span>
<span id="cb68-22"><a href="#cb68-22"></a><span class="in">```</span></span>
<span id="cb68-23"><a href="#cb68-23"></a></span>
<span id="cb68-24"><a href="#cb68-24"></a><span class="fu"># Trabajo con la serie Bitcoin</span></span>
<span id="cb68-25"><a href="#cb68-25"></a></span>
<span id="cb68-28"><a href="#cb68-28"></a><span class="in">```{r}</span></span>
<span id="cb68-29"><a href="#cb68-29"></a><span class="co">#datos</span></span>
<span id="cb68-30"><a href="#cb68-30"></a>BTC_Daily <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"datos/BTC-Daily.csv"</span>)</span>
<span id="cb68-31"><a href="#cb68-31"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(BTC_Daily<span class="sc">$</span>date,BTC_Daily<span class="sc">$</span>close)</span>
<span id="cb68-32"><a href="#cb68-32"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(BTC_Daily<span class="sc">$</span>date,BTC_Daily<span class="sc">$</span>close)</span>
<span id="cb68-33"><a href="#cb68-33"></a><span class="fu">colnames</span>(Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FechaTiempo"</span>, <span class="st">"Valor"</span>)</span>
<span id="cb68-34"><a href="#cb68-34"></a><span class="co"># limpiando datos faltantes</span></span>
<span id="cb68-35"><a href="#cb68-35"></a><span class="fu">str</span>(Data)</span>
<span id="cb68-36"><a href="#cb68-36"></a>Data<span class="sc">$</span>FechaTiempo <span class="ot">&lt;-</span> <span class="fu">strftime</span>(Data<span class="sc">$</span>FechaTiempo, <span class="at">format=</span><span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb68-37"><a href="#cb68-37"></a><span class="fu">str</span>(Data)</span>
<span id="cb68-38"><a href="#cb68-38"></a>Data<span class="sc">$</span>FechaTiempo <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(Data<span class="sc">$</span>FechaTiempo)</span>
<span id="cb68-39"><a href="#cb68-39"></a><span class="co"># procesamiento de los datos</span></span>
<span id="cb68-40"><a href="#cb68-40"></a></span>
<span id="cb68-41"><a href="#cb68-41"></a>Bitcoin <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span></span>
<span id="cb68-42"><a href="#cb68-42"></a>      <span class="fu">filter</span>(FechaTiempo <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>),</span>
<span id="cb68-43"><a href="#cb68-43"></a>             FechaTiempo <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-31"</span>))</span>
<span id="cb68-44"><a href="#cb68-44"></a><span class="fu">str</span>(Bitcoin)</span>
<span id="cb68-45"><a href="#cb68-45"></a><span class="in">```</span></span>
<span id="cb68-46"><a href="#cb68-46"></a></span>
<span id="cb68-47"><a href="#cb68-47"></a><span class="fu">### Probando xts</span></span>
<span id="cb68-48"><a href="#cb68-48"></a></span>
<span id="cb68-51"><a href="#cb68-51"></a><span class="in">```{r}</span></span>
<span id="cb68-52"><a href="#cb68-52"></a><span class="co"># objeto serie de tiempo</span></span>
<span id="cb68-53"><a href="#cb68-53"></a>Data_xts <span class="ot">&lt;-</span> xts<span class="sc">::</span><span class="fu">xts</span>(Bitcoin<span class="sc">$</span>Valor, <span class="at">order.by =</span> Bitcoin<span class="sc">$</span>FechaTiempo)</span>
<span id="cb68-54"><a href="#cb68-54"></a><span class="fu">head</span>(Data_xts)</span>
<span id="cb68-55"><a href="#cb68-55"></a>TSstudio<span class="sc">::</span><span class="fu">ts_info</span>(Data_xts)</span>
<span id="cb68-56"><a href="#cb68-56"></a><span class="co">#class(Data_xts)</span></span>
<span id="cb68-57"><a href="#cb68-57"></a><span class="co">#frequency(Data_xts)</span></span>
<span id="cb68-58"><a href="#cb68-58"></a><span class="co">#xts::periodicity(Data_xts)</span></span>
<span id="cb68-59"><a href="#cb68-59"></a><span class="co">#xts::tclass(Data_xts)</span></span>
<span id="cb68-60"><a href="#cb68-60"></a><span class="co">#plot(Data_xts)</span></span>
<span id="cb68-61"><a href="#cb68-61"></a><span class="in">```</span></span>
<span id="cb68-62"><a href="#cb68-62"></a></span>
<span id="cb68-63"><a href="#cb68-63"></a>Vista de los datos para inspección visual</span>
<span id="cb68-64"><a href="#cb68-64"></a></span>
<span id="cb68-67"><a href="#cb68-67"></a><span class="in">```{r}</span></span>
<span id="cb68-68"><a href="#cb68-68"></a>TSstudio<span class="sc">::</span><span class="fu">ts_plot</span>(Data_xts,</span>
<span id="cb68-69"><a href="#cb68-69"></a>         <span class="at">title =</span> <span class="st">"Valor de cierre bitcoin en bolsa"</span>,</span>
<span id="cb68-70"><a href="#cb68-70"></a>         <span class="at">Ytitle =</span> <span class="st">"Valor en dolares"</span>,</span>
<span id="cb68-71"><a href="#cb68-71"></a>          <span class="at">Xtitle =</span> <span class="st">"Fecha"</span>,</span>
<span id="cb68-72"><a href="#cb68-72"></a>          <span class="at">Xgrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-73"><a href="#cb68-73"></a>       <span class="at">Ygrid =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-74"><a href="#cb68-74"></a><span class="in">```</span></span>
<span id="cb68-75"><a href="#cb68-75"></a></span>
<span id="cb68-76"><a href="#cb68-76"></a><span class="ss">-   </span>**Varianza marginal:** Se notan periodos donde el rango de valores que puede tomar la variable se va fluctuando a medida que pasa el tiempo.</span>
<span id="cb68-77"><a href="#cb68-77"></a></span>
<span id="cb68-78"><a href="#cb68-78"></a><span class="ss">-   </span>**Componente Estacional:** No se evidencia un comportamiento cíclico en la serie.</span>
<span id="cb68-79"><a href="#cb68-79"></a></span>
<span id="cb68-80"><a href="#cb68-80"></a><span class="ss">-   </span>**Tendencia:** Se muestra la serie **no** oscila sobre un valor fijo y tiene cambios abruptos de crecimiento y decrecimiento en algunos momentos.</span>
<span id="cb68-81"><a href="#cb68-81"></a></span>
<span id="cb68-82"><a href="#cb68-82"></a><span class="fu">### Análisis de varianza</span></span>
<span id="cb68-83"><a href="#cb68-83"></a></span>
<span id="cb68-84"><a href="#cb68-84"></a>Usaremos la transformación de **Box-Cox** para estabilizar la varianza; primero miramos el lambda</span>
<span id="cb68-85"><a href="#cb68-85"></a></span>
<span id="cb68-88"><a href="#cb68-88"></a><span class="in">```{r}</span></span>
<span id="cb68-89"><a href="#cb68-89"></a><span class="co">#Valor de lambda</span></span>
<span id="cb68-90"><a href="#cb68-90"></a>forecast<span class="sc">::</span><span class="fu">BoxCox.lambda</span>(Data_xts, <span class="at">method =</span><span class="st">"loglik"</span>, <span class="at">lower =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">3</span>)</span>
<span id="cb68-91"><a href="#cb68-91"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(Data_xts <span class="sc">~</span> <span class="dv">1</span>),<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">length =</span> <span class="dv">50</span>))</span>
<span id="cb68-92"><a href="#cb68-92"></a><span class="in">```</span></span>
<span id="cb68-93"><a href="#cb68-93"></a></span>
<span id="cb68-94"><a href="#cb68-94"></a>Vemos que se sugiere el valor $\lambda = 0$ lo cual dada de transformación de Box-Cox se usa la función logaritmo natural para la estabilización de la variabilidad así tenemos que:</span>
<span id="cb68-95"><a href="#cb68-95"></a></span>
<span id="cb68-98"><a href="#cb68-98"></a><span class="in">```{r}</span></span>
<span id="cb68-99"><a href="#cb68-99"></a><span class="co">#trasnformación</span></span>
<span id="cb68-100"><a href="#cb68-100"></a>lData_xts <span class="ot">&lt;-</span> <span class="fu">log</span>(Data_xts)</span>
<span id="cb68-101"><a href="#cb68-101"></a><span class="co">#plot(lData_xts)</span></span>
<span id="cb68-102"><a href="#cb68-102"></a><span class="in">```</span></span>
<span id="cb68-103"><a href="#cb68-103"></a></span>
<span id="cb68-106"><a href="#cb68-106"></a><span class="in">```{r}</span></span>
<span id="cb68-107"><a href="#cb68-107"></a>TSstudio<span class="sc">::</span><span class="fu">ts_plot</span>(lData_xts,</span>
<span id="cb68-108"><a href="#cb68-108"></a>          <span class="at">title =</span> <span class="st">"Valor de Serie Trasnformada"</span>,</span>
<span id="cb68-109"><a href="#cb68-109"></a>           <span class="at">Ytitle =</span> <span class="st">"Valor de la trasnformación"</span>,</span>
<span id="cb68-110"><a href="#cb68-110"></a>          <span class="at">Xtitle =</span> <span class="st">"Fecha"</span>,</span>
<span id="cb68-111"><a href="#cb68-111"></a>          <span class="at">Xgrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-112"><a href="#cb68-112"></a>           <span class="at">Ygrid =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-113"><a href="#cb68-113"></a><span class="in">```</span></span>
<span id="cb68-114"><a href="#cb68-114"></a></span>
<span id="cb68-115"><a href="#cb68-115"></a>Ahora miramos si es necesario aplicar otra transformación a la serie</span>
<span id="cb68-116"><a href="#cb68-116"></a></span>
<span id="cb68-119"><a href="#cb68-119"></a><span class="in">```{r}</span></span>
<span id="cb68-120"><a href="#cb68-120"></a><span class="co">#Valor de lambda</span></span>
<span id="cb68-121"><a href="#cb68-121"></a>(forecast<span class="sc">::</span><span class="fu">BoxCox.lambda</span>(lData_xts, <span class="at">method =</span><span class="st">"loglik"</span>, <span class="at">lower =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">3</span>))</span>
<span id="cb68-122"><a href="#cb68-122"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(lData_xts <span class="sc">~</span> <span class="dv">1</span>),<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">50</span>))</span>
<span id="cb68-123"><a href="#cb68-123"></a><span class="in">```</span></span>
<span id="cb68-124"><a href="#cb68-124"></a></span>
<span id="cb68-125"><a href="#cb68-125"></a>Vemos que la sugerencia es $\lambda = 0.9$ lo cual es cercano a $1$, además el IC de confianza captura al $1$, por ende la transformación logarítmica parece haber estabilizado la varianza.</span>
<span id="cb68-126"><a href="#cb68-126"></a></span>
<span id="cb68-129"><a href="#cb68-129"></a><span class="in">```{r}</span></span>
<span id="cb68-130"><a href="#cb68-130"></a><span class="co">#Gráfico de ellas juntas</span></span>
<span id="cb68-131"><a href="#cb68-131"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb68-132"><a href="#cb68-132"></a><span class="fu">plot</span>(Data_xts, <span class="at">main =</span> <span class="st">"Series original"</span>)</span>
<span id="cb68-133"><a href="#cb68-133"></a><span class="fu">plot</span>(lData_xts, <span class="at">main =</span> <span class="st">"Series transformada"</span>)</span>
<span id="cb68-134"><a href="#cb68-134"></a><span class="in">```</span></span>
<span id="cb68-135"><a href="#cb68-135"></a></span>
<span id="cb68-136"><a href="#cb68-136"></a>Se puede ver cómo la transformación aplicada logra estabilizar la varianza en gran medida.</span>
<span id="cb68-137"><a href="#cb68-137"></a></span>
<span id="cb68-138"><a href="#cb68-138"></a><span class="fu">### Análisis de tendencia</span></span>
<span id="cb68-139"><a href="#cb68-139"></a></span>
<span id="cb68-140"><a href="#cb68-140"></a>Trabajaremos con la serie a la cuál se le realizo la transformación para estabilizar la varianza, realizaremos el gráfico de los valores de la función de auto-correlación</span>
<span id="cb68-141"><a href="#cb68-141"></a></span>
<span id="cb68-144"><a href="#cb68-144"></a><span class="in">```{r}</span></span>
<span id="cb68-145"><a href="#cb68-145"></a><span class="co">#ACf</span></span>
<span id="cb68-146"><a href="#cb68-146"></a><span class="fu">acf</span>(lData_xts, <span class="dv">180</span>, <span class="at">main =</span> <span class="st">"Serie Bitcoin Trasnformada"</span>)</span>
<span id="cb68-147"><a href="#cb68-147"></a><span class="in">```</span></span>
<span id="cb68-148"><a href="#cb68-148"></a></span>
<span id="cb68-149"><a href="#cb68-149"></a>Notamos que los valores van teniendo un decaimiento leve lo cual nos da un indicio más claro de que existe tendencia en la serie, analizaremos el gráfico de retardos de la serie trasnformada para ver si podemos tener indicios de una relación *no-lineal o lineal* en la serie.</span>
<span id="cb68-150"><a href="#cb68-150"></a></span>
<span id="cb68-153"><a href="#cb68-153"></a><span class="in">```{r}</span></span>
<span id="cb68-154"><a href="#cb68-154"></a><span class="co">#serie transformada</span></span>
<span id="cb68-155"><a href="#cb68-155"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-156"><a href="#cb68-156"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(lData_xts, <span class="dv">16</span>,<span class="at">corr=</span>T)</span>
<span id="cb68-157"><a href="#cb68-157"></a><span class="in">```</span></span>
<span id="cb68-158"><a href="#cb68-158"></a></span>
<span id="cb68-159"><a href="#cb68-159"></a>Vemos que se nota un fuerte relación linea hasta para el retraso número 16, por lo tanto con lo mostrado por el *acf* y *el gráfico de retardos* tenemos indicios fuertes de tendencia en la serie así usaremos los métodos: *lineal determinista, Descomposición de* *promedios móviles y descomposición STL* para estimar dicha componente.</span>
<span id="cb68-160"><a href="#cb68-160"></a></span>
<span id="cb68-161"><a href="#cb68-161"></a><span class="fu">#### Lineal determinista</span></span>
<span id="cb68-162"><a href="#cb68-162"></a></span>
<span id="cb68-163"><a href="#cb68-163"></a>ajustaremos el modelo eliminaremos la tendencia y analizaremos los resultados</span>
<span id="cb68-164"><a href="#cb68-164"></a></span>
<span id="cb68-167"><a href="#cb68-167"></a><span class="in">```{r}</span></span>
<span id="cb68-168"><a href="#cb68-168"></a><span class="co">#pasar a ts para Graficarlo</span></span>
<span id="cb68-169"><a href="#cb68-169"></a>ldata_ts <span class="ot">&lt;-</span> TSstudio<span class="sc">::</span><span class="fu">xts_to_ts</span>(lData_xts,<span class="at">frequency =</span> <span class="dv">365</span>,</span>
<span id="cb68-170"><a href="#cb68-170"></a>                                <span class="at">start =</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>))</span>
<span id="cb68-171"><a href="#cb68-171"></a><span class="co">#modelo lineal</span></span>
<span id="cb68-172"><a href="#cb68-172"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(ldata_ts<span class="sc">~</span><span class="fu">time</span>(ldata_ts), <span class="at">na.action=</span><span class="cn">NULL</span>))</span>
<span id="cb68-173"><a href="#cb68-173"></a><span class="co"># Gráfico</span></span>
<span id="cb68-174"><a href="#cb68-174"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-175"><a href="#cb68-175"></a><span class="fu">abline</span>(fit,<span class="at">col =</span> <span class="st">"red"</span>)<span class="co"># Se añade la recta ajusta</span></span>
<span id="cb68-176"><a href="#cb68-176"></a><span class="in">```</span></span>
<span id="cb68-177"><a href="#cb68-177"></a></span>
<span id="cb68-178"><a href="#cb68-178"></a>ahora eliminaremos la tendencia de la serie</span>
<span id="cb68-179"><a href="#cb68-179"></a></span>
<span id="cb68-182"><a href="#cb68-182"></a><span class="in">```{r}</span></span>
<span id="cb68-183"><a href="#cb68-183"></a><span class="do">###Eliminamos la tendencia con la predicción la recta</span></span>
<span id="cb68-184"><a href="#cb68-184"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> <span class="fu">predict</span>(fit)</span>
<span id="cb68-185"><a href="#cb68-185"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb68-186"><a href="#cb68-186"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-187"><a href="#cb68-187"></a><span class="in">```</span></span>
<span id="cb68-188"><a href="#cb68-188"></a></span>
<span id="cb68-189"><a href="#cb68-189"></a>Observamos que en la serie obtenida después de eliminar la tendencia lineal parece tener un comportamiento de alta variabilidad similar una *caminata aleatoria.*</span>
<span id="cb68-190"><a href="#cb68-190"></a></span>
<span id="cb68-193"><a href="#cb68-193"></a><span class="in">```{r}</span></span>
<span id="cb68-194"><a href="#cb68-194"></a><span class="fu">acf</span>(ElimTenldata_ts,<span class="at">lag.max =</span><span class="fu">length</span>(ElimTenldata_ts), </span>
<span id="cb68-195"><a href="#cb68-195"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span>
<span id="cb68-196"><a href="#cb68-196"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb68-197"><a href="#cb68-197"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-198"><a href="#cb68-198"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts, <span class="dv">16</span>,<span class="at">corr=</span>F)</span>
<span id="cb68-199"><a href="#cb68-199"></a><span class="in">```</span></span>
<span id="cb68-200"><a href="#cb68-200"></a></span>
<span id="cb68-201"><a href="#cb68-201"></a>Notamos que en la gráfica del **acf** se sigue teniendo un decaimiento lento de los valores de la función de auto-correlación para los primeros rezagos, además en el **gráfico de retardos** se sigue manteniendo una alta relación lineal entre el valor actual y sus regazos. Por ende todo esto nos da los argumentos necesarios para **descartar** *la estimación linealcómo una buena estimación de la tendencia.*</span>
<span id="cb68-202"><a href="#cb68-202"></a></span>
<span id="cb68-203"><a href="#cb68-203"></a><span class="fu">#### Descomposición por promedio móviles</span></span>
<span id="cb68-204"><a href="#cb68-204"></a></span>
<span id="cb68-207"><a href="#cb68-207"></a><span class="in">```{r}</span></span>
<span id="cb68-208"><a href="#cb68-208"></a><span class="co"># descomposición de promedios moviles</span></span>
<span id="cb68-209"><a href="#cb68-209"></a>descom_ldata <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ldata_ts)</span>
<span id="cb68-210"><a href="#cb68-210"></a><span class="fu">plot</span>(descom_ldata)</span>
<span id="cb68-211"><a href="#cb68-211"></a><span class="in">```</span></span>
<span id="cb68-212"><a href="#cb68-212"></a></span>
<span id="cb68-213"><a href="#cb68-213"></a>Podemos observar que usando **un filtro de promedio móvil** la tendencia estimada no se aproxima mucho a una lineal, cómo se puede apreciar en el siguiente gráfico; además la componente estacional no parece ser estimada de buena manera ya que no se ve un patrón de comportamiento claramente, además el residual presenta un comportamiento no estacionario aparentemente.</span>
<span id="cb68-214"><a href="#cb68-214"></a></span>
<span id="cb68-217"><a href="#cb68-217"></a><span class="in">```{r}</span></span>
<span id="cb68-218"><a href="#cb68-218"></a><span class="co"># Gráfico</span></span>
<span id="cb68-219"><a href="#cb68-219"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-220"><a href="#cb68-220"></a><span class="fu">abline</span>(fit,<span class="at">col =</span> <span class="st">"red"</span>)<span class="co"># Se añade la recta ajusta</span></span>
<span id="cb68-221"><a href="#cb68-221"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), descom_ldata<span class="sc">$</span>trend, <span class="at">col =</span><span class="st">"green"</span>, <span class="at">cex=</span><span class="fl">0.3</span>)</span>
<span id="cb68-222"><a href="#cb68-222"></a></span>
<span id="cb68-223"><a href="#cb68-223"></a><span class="in">```</span></span>
<span id="cb68-224"><a href="#cb68-224"></a></span>
<span id="cb68-225"><a href="#cb68-225"></a>Eliminaremos la tendencia del promedio móvil centrado y de la frecuencia</span>
<span id="cb68-226"><a href="#cb68-226"></a></span>
<span id="cb68-229"><a href="#cb68-229"></a><span class="in">```{r}</span></span>
<span id="cb68-230"><a href="#cb68-230"></a><span class="do">###Eliminamos la tendencia con la predicción promedio movil</span></span>
<span id="cb68-231"><a href="#cb68-231"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> descom_ldata<span class="sc">$</span>trend</span>
<span id="cb68-232"><a href="#cb68-232"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb68-233"><a href="#cb68-233"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-234"><a href="#cb68-234"></a><span class="in">```</span></span>
<span id="cb68-235"><a href="#cb68-235"></a></span>
<span id="cb68-236"><a href="#cb68-236"></a>Podemos ver que la serie cómo en el caso *lineal* parece mostrar un comportamiento de *caminata aleatoria*.</span>
<span id="cb68-237"><a href="#cb68-237"></a></span>
<span id="cb68-240"><a href="#cb68-240"></a><span class="in">```{r}</span></span>
<span id="cb68-241"><a href="#cb68-241"></a><span class="fu">acf</span>(ElimTenldata_ts[<span class="dv">183</span><span class="sc">:</span><span class="dv">1644</span>],<span class="at">lag.max =</span> <span class="dv">730</span>, </span>
<span id="cb68-242"><a href="#cb68-242"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span>
<span id="cb68-243"><a href="#cb68-243"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb68-244"><a href="#cb68-244"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-245"><a href="#cb68-245"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts[<span class="dv">183</span><span class="sc">:</span><span class="dv">1644</span>], <span class="dv">16</span>,<span class="at">corr=</span>F)</span>
<span id="cb68-246"><a href="#cb68-246"></a><span class="in">```</span></span>
<span id="cb68-247"><a href="#cb68-247"></a></span>
<span id="cb68-248"><a href="#cb68-248"></a>Notamos que tanto en el **acf** cómo en **la gráfica de retardos** se ve un comportamiento similar al anterior lo cuál nos hace descartar *la descompsición de promedios moviles* para la estimación de la tendencia.</span>
<span id="cb68-249"><a href="#cb68-249"></a></span>
<span id="cb68-250"><a href="#cb68-250"></a>***Filtro promedio móvil con solo retrasos***</span>
<span id="cb68-251"><a href="#cb68-251"></a></span>
<span id="cb68-252"><a href="#cb68-252"></a>Intentaremos ajustar un promedio móvil que tenga en cuenta solo los retrasos y sea de los periodos de un año, seis meses, tres meses y mes.</span>
<span id="cb68-253"><a href="#cb68-253"></a></span>
<span id="cb68-256"><a href="#cb68-256"></a><span class="in">```{r}</span></span>
<span id="cb68-257"><a href="#cb68-257"></a><span class="co">#gráfico</span></span>
<span id="cb68-258"><a href="#cb68-258"></a>filter_1<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>, <span class="dv">365</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb68-259"><a href="#cb68-259"></a>filter_2<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">182</span>, <span class="dv">182</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb68-260"><a href="#cb68-260"></a>filter_3<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">90</span>, <span class="dv">90</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb68-261"><a href="#cb68-261"></a>filter_4<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">filter</span>(ldata_ts, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>, <span class="dv">30</span>), <span class="at">sides =</span> <span class="dv">1</span>)</span>
<span id="cb68-262"><a href="#cb68-262"></a><span class="fu">plot</span>(ldata_ts, <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-263"><a href="#cb68-263"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_1, <span class="at">col =</span><span class="st">"green"</span>, <span class="at">cex=</span><span class="fl">0.33</span>)</span>
<span id="cb68-264"><a href="#cb68-264"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_2, <span class="at">col =</span><span class="st">"blue"</span>, <span class="at">cex=</span><span class="fl">0.33</span>)</span>
<span id="cb68-265"><a href="#cb68-265"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_3, <span class="at">col =</span><span class="st">"red"</span>, <span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb68-266"><a href="#cb68-266"></a><span class="fu">points</span>(<span class="fu">time</span>(ldata_ts), filter_4, <span class="at">col =</span><span class="st">"cyan"</span>, <span class="at">cex=</span><span class="fl">0.31</span>)</span>
<span id="cb68-267"><a href="#cb68-267"></a><span class="co">#legend(locator(1), c("365 días","182 días","90 días","30 días"), col=c("green","blue","red","cyan"),lty=c(1,1,1,1),lwd=c(2,2,2,2))</span></span>
<span id="cb68-268"><a href="#cb68-268"></a><span class="in">```</span></span>
<span id="cb68-269"><a href="#cb68-269"></a></span>
<span id="cb68-270"><a href="#cb68-270"></a>Notamos que para *3 meses* y *6 meses* los filtros de promedios móviles muestra una mejor estimación, por ende tomaremos para *3 meses* cómo estimación de la tendencia de la serie</span>
<span id="cb68-271"><a href="#cb68-271"></a></span>
<span id="cb68-274"><a href="#cb68-274"></a><span class="in">```{r}</span></span>
<span id="cb68-275"><a href="#cb68-275"></a><span class="do">###Eliminamos la tendencia con la predicción promedio movil</span></span>
<span id="cb68-276"><a href="#cb68-276"></a>ElimTenldata_ts <span class="ot">&lt;-</span> ldata_ts <span class="sc">-</span> filter_3</span>
<span id="cb68-277"><a href="#cb68-277"></a><span class="fu">plot</span>(ElimTenldata_ts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb68-278"><a href="#cb68-278"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-279"><a href="#cb68-279"></a><span class="co">#</span></span>
<span id="cb68-280"><a href="#cb68-280"></a><span class="fu">acf</span>(ElimTenldata_ts[<span class="dv">90</span><span class="sc">:</span><span class="dv">1826</span>],<span class="at">lag.max =</span><span class="dv">1095</span>, </span>
<span id="cb68-281"><a href="#cb68-281"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span>
<span id="cb68-282"><a href="#cb68-282"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb68-283"><a href="#cb68-283"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-284"><a href="#cb68-284"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_ts[<span class="dv">90</span><span class="sc">:</span><span class="dv">1826</span>], <span class="dv">16</span>,<span class="at">corr=</span>F)</span>
<span id="cb68-285"><a href="#cb68-285"></a><span class="in">```</span></span>
<span id="cb68-286"><a href="#cb68-286"></a></span>
<span id="cb68-287"><a href="#cb68-287"></a>El comportamiento de los gráficos es similar a los anteriores con eso tenemos indicios de que la estimación de la tendencia de manera determinista potencialmente no es buena idea.</span>
<span id="cb68-288"><a href="#cb68-288"></a></span>
<span id="cb68-289"><a href="#cb68-289"></a><span class="fu">#### Descomposición STL</span></span>
<span id="cb68-290"><a href="#cb68-290"></a></span>
<span id="cb68-291"><a href="#cb68-291"></a>Usando la descomposición **STL** obtenemos la estimación de la tendencia</span>
<span id="cb68-292"><a href="#cb68-292"></a></span>
<span id="cb68-295"><a href="#cb68-295"></a><span class="in">```{r}</span></span>
<span id="cb68-296"><a href="#cb68-296"></a>indice_ldata <span class="ot">&lt;-</span> <span class="fu">sort</span>(Bitcoin<span class="sc">$</span>FechaTiempo)</span>
<span id="cb68-297"><a href="#cb68-297"></a><span class="co">#  as.Date(as.yearmon(tk_index(ldata_ts)))</span></span>
<span id="cb68-298"><a href="#cb68-298"></a><span class="do">## Otra forma de extraer el indice estimetk::tk_index(lAirPass)</span></span>
<span id="cb68-299"><a href="#cb68-299"></a>logdata <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ldata_ts)</span>
<span id="cb68-300"><a href="#cb68-300"></a>df_ldata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fecha=</span>indice_ldata,<span class="at">logdata=</span><span class="fu">as.matrix</span>(ldata_ts))</span>
<span id="cb68-301"><a href="#cb68-301"></a><span class="fu">str</span>(df_ldata)</span>
<span id="cb68-302"><a href="#cb68-302"></a><span class="fu">colnames</span>(df_ldata) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fecha"</span>, <span class="st">"logdata"</span>)</span>
<span id="cb68-303"><a href="#cb68-303"></a><span class="fu">str</span>(df_ldata)</span>
<span id="cb68-304"><a href="#cb68-304"></a>tibble_ldata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(df_ldata)</span>
<span id="cb68-305"><a href="#cb68-305"></a><span class="do">####Primera aproximación del ajuste STL</span></span>
<span id="cb68-306"><a href="#cb68-306"></a>tibble_ldata<span class="sc">%&gt;%</span>timetk<span class="sc">::</span><span class="fu">plot_time_series</span>(Fecha, logdata, </span>
<span id="cb68-307"><a href="#cb68-307"></a>                   <span class="at">.interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-308"><a href="#cb68-308"></a>                   <span class="at">.plotly_slider =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-309"><a href="#cb68-309"></a><span class="in">```</span></span>
<span id="cb68-310"><a href="#cb68-310"></a></span>
<span id="cb68-313"><a href="#cb68-313"></a><span class="in">```{r}</span></span>
<span id="cb68-314"><a href="#cb68-314"></a><span class="do">#####Ajuste STL</span></span>
<span id="cb68-315"><a href="#cb68-315"></a><span class="co">#Note que obtenemos un objeto adicional en tibble_logpasajeros con Logpasa_ajus con parámetros que se pueden mover.</span></span>
<span id="cb68-316"><a href="#cb68-316"></a>logdata_ajus <span class="ot">&lt;-</span> <span class="fu">smooth_vec</span>(logdata,<span class="at">span =</span> <span class="fl">0.75</span>, <span class="at">degree =</span> <span class="dv">2</span>)</span>
<span id="cb68-317"><a href="#cb68-317"></a>tibble_ldata<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">mutate</span>(logdata_ajus)</span>
<span id="cb68-318"><a href="#cb68-318"></a><span class="do">###Ajuste STL moviendo los parámetros</span></span>
<span id="cb68-319"><a href="#cb68-319"></a>tibble_ldata<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">logdata_ajus=</span><span class="fu">smooth_vec</span>(logdata,<span class="at">span =</span> <span class="fl">0.75</span>, <span class="at">degree =</span> <span class="dv">2</span>))<span class="sc">%&gt;%</span></span>
<span id="cb68-320"><a href="#cb68-320"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Fecha, logdata)) <span class="sc">+</span></span>
<span id="cb68-321"><a href="#cb68-321"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb68-322"><a href="#cb68-322"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> logdata_ajus), <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb68-323"><a href="#cb68-323"></a><span class="in">```</span></span>
<span id="cb68-324"><a href="#cb68-324"></a></span>
<span id="cb68-325"><a href="#cb68-325"></a>Se puede evidenciar que la Estimación de la tendencia via *STL* parece mejorar aspectos que la *descomposición movil* intentada con información de un año no se tenia.</span>
<span id="cb68-326"><a href="#cb68-326"></a></span>
<span id="cb68-329"><a href="#cb68-329"></a><span class="in">```{r}</span></span>
<span id="cb68-330"><a href="#cb68-330"></a><span class="do">###Eliminamos la tendencia con la predicción la STL</span></span>
<span id="cb68-331"><a href="#cb68-331"></a>ElimTenldata_xts <span class="ot">&lt;-</span> lData_xts <span class="sc">-</span> logdata_ajus</span>
<span id="cb68-332"><a href="#cb68-332"></a><span class="fu">plot</span>(ElimTenldata_xts, <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>, </span>
<span id="cb68-333"><a href="#cb68-333"></a>     <span class="at">ylab=</span> <span class="st">"Valor en escala logarítmica"</span>)</span>
<span id="cb68-334"><a href="#cb68-334"></a><span class="fu">acf</span>(ElimTenldata_xts,<span class="at">lag.max =</span><span class="dv">1094</span>, </span>
<span id="cb68-335"><a href="#cb68-335"></a>    <span class="at">main=</span><span class="st">"Serie Sin tendencia"</span>)</span>
<span id="cb68-336"><a href="#cb68-336"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb68-337"><a href="#cb68-337"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-338"><a href="#cb68-338"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(ElimTenldata_xts, <span class="dv">16</span>,<span class="at">corr=</span>F)</span>
<span id="cb68-339"><a href="#cb68-339"></a><span class="in">```</span></span>
<span id="cb68-340"><a href="#cb68-340"></a></span>
<span id="cb68-341"><a href="#cb68-341"></a>Vemos que a diferencia de los promedio móviles si tenemos una estimación para todos los valores de la serie, además notamos que la **acf** y **el gráfico de retardos** tiene un comportamiento similar a los métodos anteriores.</span>
<span id="cb68-342"><a href="#cb68-342"></a></span>
<span id="cb68-343"><a href="#cb68-343"></a><span class="fu">## Serie Diferenciada</span></span>
<span id="cb68-344"><a href="#cb68-344"></a></span>
<span id="cb68-347"><a href="#cb68-347"></a><span class="in">```{r}</span></span>
<span id="cb68-348"><a href="#cb68-348"></a><span class="do">###Diferenciando con base en el objeto ts</span></span>
<span id="cb68-349"><a href="#cb68-349"></a>dldata<span class="ot">&lt;-</span><span class="fu">diff</span>(ldata_ts)</span>
<span id="cb68-350"><a href="#cb68-350"></a><span class="co">#plot(dldata)</span></span>
<span id="cb68-351"><a href="#cb68-351"></a><span class="co">#abline(h=0, col = "red")</span></span>
<span id="cb68-352"><a href="#cb68-352"></a><span class="co">#acf(dldata,lag.max =90, main="Serie Diferenciada")</span></span>
<span id="cb68-353"><a href="#cb68-353"></a><span class="in">```</span></span>
<span id="cb68-354"><a href="#cb68-354"></a></span>
<span id="cb68-357"><a href="#cb68-357"></a><span class="in">```{r}</span></span>
<span id="cb68-358"><a href="#cb68-358"></a><span class="do">###Diferenciando con base en el objeto xts</span></span>
<span id="cb68-359"><a href="#cb68-359"></a>dldata_xts<span class="ot">&lt;-</span><span class="fu">diff</span>(lData_xts)</span>
<span id="cb68-360"><a href="#cb68-360"></a>dldata_xts <span class="ot">&lt;-</span> dldata_xts[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb68-361"><a href="#cb68-361"></a><span class="fu">plot</span>(dldata_xts, <span class="at">main =</span> <span class="st">"Serie diferenciada"</span>)</span>
<span id="cb68-362"><a href="#cb68-362"></a><span class="in">```</span></span>
<span id="cb68-363"><a href="#cb68-363"></a></span>
<span id="cb68-364"><a href="#cb68-364"></a>Vemos que la serie al ser diferenciada muestra un comportamiento estacionario pues los valores oscilan sobre un valor fijo, además de un valor que muestra un comportamiento extremo pues varia demasiado con respecto a los demás.</span>
<span id="cb68-365"><a href="#cb68-365"></a></span>
<span id="cb68-368"><a href="#cb68-368"></a><span class="in">```{r}</span></span>
<span id="cb68-369"><a href="#cb68-369"></a><span class="co"># función de autocorrelación</span></span>
<span id="cb68-370"><a href="#cb68-370"></a><span class="fu">acf</span>(dldata_xts,<span class="at">lag.max =</span><span class="dv">30</span>, <span class="at">main=</span><span class="st">"Serie Diferenciada"</span>)</span>
<span id="cb68-371"><a href="#cb68-371"></a><span class="co"># Series trasnfromada sin tendencia Retardos</span></span>
<span id="cb68-372"><a href="#cb68-372"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb68-373"><a href="#cb68-373"></a>astsa<span class="sc">::</span><span class="fu">lag1.plot</span>(dldata_xts, <span class="dv">16</span>,<span class="at">corr=</span>T)</span>
<span id="cb68-374"><a href="#cb68-374"></a><span class="in">```</span></span>
<span id="cb68-375"><a href="#cb68-375"></a></span>
<span id="cb68-376"><a href="#cb68-376"></a>El gráfico de **acf** muestra que la tendencia parce a ver desparecido, además no parece destacar ningún valor para algún retraso de manera clara. Para el **gráfico de retardos** vemos claramente que ya no hay una relación lineal ni no lineal del valor actual con sus retardos.</span>
<span id="cb68-377"><a href="#cb68-377"></a></span>
<span id="cb68-378"><a href="#cb68-378"></a>Tomando en cuenta todo lo anterior trabajaremos con la serie aplicada la transformación de Box-Cox sugerida y diferenciada, además se tiene sospecha de que la serie presenta comportamiento de una camina aleatoria con tendencia no determinista.</span>
<span id="cb68-379"><a href="#cb68-379"></a></span>
<span id="cb68-380"><a href="#cb68-380"></a><span class="fu">## Análisis de Estacionalidad</span></span>
<span id="cb68-381"><a href="#cb68-381"></a></span>
<span id="cb68-382"><a href="#cb68-382"></a><span class="fu">### Mapas de calor</span></span>
<span id="cb68-383"><a href="#cb68-383"></a></span>
<span id="cb68-386"><a href="#cb68-386"></a><span class="in">```{r}</span></span>
<span id="cb68-387"><a href="#cb68-387"></a><span class="co">#Serie diferenciada</span></span>
<span id="cb68-388"><a href="#cb68-388"></a>TSstudio<span class="sc">::</span><span class="fu">ts_heatmap</span>(dldata_xts, <span class="at">title =</span> <span class="st">"Mapa de calor - Cierre Bitcoin en bolsa dias año"</span>)</span>
<span id="cb68-389"><a href="#cb68-389"></a><span class="in">```</span></span>
<span id="cb68-390"><a href="#cb68-390"></a></span>
<span id="cb68-391"><a href="#cb68-391"></a>Para la serie diferenciada no se evidencia ninguno tipo de patrón lo cual nos da indicios de que no se tiene un componente estacional.</span>
<span id="cb68-392"><a href="#cb68-392"></a></span>
<span id="cb68-393"><a href="#cb68-393"></a><span class="fu">### Periodograma</span></span>
<span id="cb68-394"><a href="#cb68-394"></a></span>
<span id="cb68-397"><a href="#cb68-397"></a><span class="in">```{r}</span></span>
<span id="cb68-398"><a href="#cb68-398"></a><span class="co"># periodograma</span></span>
<span id="cb68-399"><a href="#cb68-399"></a>Periodograma <span class="ot">&lt;-</span> <span class="fu">spectrum</span>(<span class="fu">as.numeric</span>(dldata_xts),<span class="at">log=</span><span class="st">"no"</span>,<span class="at">span=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb68-400"><a href="#cb68-400"></a><span class="co">#</span></span>
<span id="cb68-401"><a href="#cb68-401"></a>ubicacionDif <span class="ot">&lt;-</span> <span class="fu">which.max</span>(Periodograma<span class="sc">$</span>spec)</span>
<span id="cb68-402"><a href="#cb68-402"></a><span class="fu">sprintf</span>(<span class="st">"El valor de la frecuencia donde se máximiza el periodograma para la serie es: %s"</span>,Periodograma<span class="sc">$</span>freq[ubicacionDif])</span>
<span id="cb68-403"><a href="#cb68-403"></a><span class="co">#</span></span>
<span id="cb68-404"><a href="#cb68-404"></a><span class="fu">sprintf</span>(<span class="st">"El periodo correspondiente es aproximadamente: %s"</span>,<span class="dv">1</span><span class="sc">/</span>Periodograma<span class="sc">$</span>freq[ubicacionDif])</span>
<span id="cb68-405"><a href="#cb68-405"></a><span class="in">```</span></span>
<span id="cb68-406"><a href="#cb68-406"></a></span>
<span id="cb68-407"><a href="#cb68-407"></a>Para la serie diferenciada el periodograma no es claro, a pesar del suviazamiento usado la curva sigue mostrando varios picos en su recorrido el máximo lo encontramos de tal manera que $\omega = \frac{251}{625}=0.416$ lo cual se corresponde con un $s \approx 2.5$ .</span>
<span id="cb68-408"><a href="#cb68-408"></a></span>
<span id="cb68-411"><a href="#cb68-411"></a><span class="in">```{r}</span></span>
<span id="cb68-412"><a href="#cb68-412"></a><span class="co"># intentando sacar el segundo más alto</span></span>
<span id="cb68-413"><a href="#cb68-413"></a>n_dld <span class="ot">&lt;-</span> <span class="fu">length</span>(Periodograma<span class="sc">$</span>spec)</span>
<span id="cb68-414"><a href="#cb68-414"></a>valor_seg <span class="ot">&lt;-</span> <span class="fu">sort</span>(Periodograma<span class="sc">$</span>spec,<span class="at">partial=</span>n_dld<span class="dv">-1</span>)[n_dld<span class="dv">-1</span>]</span>
<span id="cb68-415"><a href="#cb68-415"></a>ubica_segundo <span class="ot">&lt;-</span> <span class="fu">which</span>(Periodograma<span class="sc">$</span>spec<span class="sc">==</span>valor_seg)</span>
<span id="cb68-416"><a href="#cb68-416"></a></span>
<span id="cb68-417"><a href="#cb68-417"></a><span class="fu">sprintf</span>(<span class="st">"El valor de la frecuencia donde se alcanza el segundo máximo para el periodograma para REC es: %s"</span>,Periodograma<span class="sc">$</span>freq[ubica_segundo])</span>
<span id="cb68-418"><a href="#cb68-418"></a><span class="co">#</span></span>
<span id="cb68-419"><a href="#cb68-419"></a><span class="fu">sprintf</span>(<span class="st">"El periodo correspondiente es aproximadamente: %s"</span>,<span class="dv">1</span><span class="sc">/</span>Periodograma<span class="sc">$</span>freq[ubica_segundo])</span>
<span id="cb68-420"><a href="#cb68-420"></a><span class="in">```</span></span>
<span id="cb68-421"><a href="#cb68-421"></a></span>
<span id="cb68-422"><a href="#cb68-422"></a>vemos que el segundo valor es bastante parecido al segundo.</span>
<span id="cb68-423"><a href="#cb68-423"></a></span>
<span id="cb68-426"><a href="#cb68-426"></a><span class="in">```{r}</span></span>
<span id="cb68-427"><a href="#cb68-427"></a><span class="co"># valor de frecuencia </span></span>
<span id="cb68-428"><a href="#cb68-428"></a><span class="fu">tail</span>(<span class="fu">sort</span>(Periodograma<span class="sc">$</span>spec))</span>
<span id="cb68-429"><a href="#cb68-429"></a><span class="in">```</span></span>
<span id="cb68-430"><a href="#cb68-430"></a></span>
<span id="cb68-431"><a href="#cb68-431"></a>Cómo se puede observar los primeros seis valores son bastante cercanos entre ellos, por lo tanto sus valores de periodo serán similiares.</span>
<span id="cb68-432"><a href="#cb68-432"></a></span>
<span id="cb68-433"><a href="#cb68-433"></a>Con esto **descartamos** la estimación de una componente estacional pues no tenemos evidencia clara de su existencia.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>