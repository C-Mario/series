<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Series de Tiempo - Predicción 1 paso adelante usando 12 retardos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ninguna coincidencia",
    "search-matching-documents-text": "coincidencias",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": ""
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series de Tiempo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-análisis-descriptivo" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Análisis Descriptivo</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-análisis-descriptivo">    
        <li>
    <a class="dropdown-item" href="./DExportaciones.html" rel="" target="">
 <span class="dropdown-text">Exportaciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DBitcoin.html" rel="" target="">
 <span class="dropdown-text">Bitcoin</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-exportaciones">    
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportacionesdoceRetardos.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportaciones.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-exportaciones">    
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_12.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_2.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-bitcoin">    
        <li>
    <a class="dropdown-item" href="./Arboles_Des_series.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-bitcoin">    
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_bayesiano.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (bayesiano)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_grilla.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (grilla)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/C-Mario/series" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">GitHub</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
  <li><a href="#árboles-de-decisión" id="toc-árboles-de-decisión" class="nav-link active" data-scroll-target="#árboles-de-decisión"><span class="header-section-number">1</span> Árboles de decisión</a>
  <ul class="collapse">
  <li><a href="#creación-de-los-rezagos" id="toc-creación-de-los-rezagos" class="nav-link" data-scroll-target="#creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</a></li>
  </ul></li>
  <li><a href="#árbol-para-serie-original" id="toc-árbol-para-serie-original" class="nav-link" data-scroll-target="#árbol-para-serie-original"><span class="header-section-number">2</span> Árbol para Serie Original</a>
  <ul class="collapse">
  <li><a href="#árbol" id="toc-árbol" class="nav-link" data-scroll-target="#árbol"><span class="header-section-number">2.0.1</span> Árbol</a></li>
  </ul></li>
  <li><a href="#serie-de-exportaciones-sin-tendencia" id="toc-serie-de-exportaciones-sin-tendencia" class="nav-link" data-scroll-target="#serie-de-exportaciones-sin-tendencia"><span class="header-section-number">3</span> Serie de Exportaciones sin Tendencia</a></li>
  <li><a href="#árboles-de-decisión-1" id="toc-árboles-de-decisión-1" class="nav-link" data-scroll-target="#árboles-de-decisión-1"><span class="header-section-number">4</span> Árboles de decisión</a>
  <ul class="collapse">
  <li><a href="#creación-de-los-rezagos-1" id="toc-creación-de-los-rezagos-1" class="nav-link" data-scroll-target="#creación-de-los-rezagos-1"><span class="header-section-number">4.0.1</span> Creación de los rezagos</a></li>
  </ul></li>
  <li><a href="#árbol-para-serie-sin-tendencia" id="toc-árbol-para-serie-sin-tendencia" class="nav-link" data-scroll-target="#árbol-para-serie-sin-tendencia"><span class="header-section-number">5</span> Árbol para Serie Sin Tendencia</a>
  <ul class="collapse">
  <li><a href="#árbol-1" id="toc-árbol-1" class="nav-link" data-scroll-target="#árbol-1"><span class="header-section-number">5.0.1</span> Árbol</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Predicción 1 paso adelante usando 12 retardos</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. <span class="math inline">\(\{X_t\}\)</span></p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># get working directory</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3"></a>os.getcwd()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'C:\\Users\\dofca\\Desktop\\series'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># librerias</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">import</span> sklearn</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">import</span> openpyxl</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">import</span> warnings</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Matplotlib Version: 1.25.2
Pandas Version: 2.0.3
Numpy Version: 1.25.2
Sklearn: 1.3.1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>data <span class="op">=</span> pd.read_excel(<span class="st">"datos/Exportaciones.xlsx"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Mes'</span>,<span class="st">'Total'</span>]).iloc[<span class="dv">96</span>:].reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a>data[<span class="st">'Total'</span>] <span class="op">=</span> data[<span class="st">'Total'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb5-5"><a href="#cb5-5"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mes</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000-01-01</td>
<td>1011676</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000-02-01</td>
<td>1054098</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000-03-01</td>
<td>1053546</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000-04-01</td>
<td>886359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000-05-01</td>
<td>1146258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">277</td>
<td>2023-02-01</td>
<td>4202234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">278</td>
<td>2023-03-01</td>
<td>4431911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">279</td>
<td>2023-04-01</td>
<td>3739214</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">280</td>
<td>2023-05-01</td>
<td>4497862</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">281</td>
<td>2023-06-01</td>
<td>3985981</td>
</tr>
</tbody>
</table>

<p>282 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="bu">print</span>(data.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 282 entries, 0 to 281
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype         
---  ------  --------------  -----         
 0   Mes     282 non-null    datetime64[ns]
 1   Total   282 non-null    int32         
dtypes: datetime64[ns](1), int32(1)
memory usage: 3.4 KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#mirando los datos</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#objeto ts</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>exportaciones <span class="op">=</span> data[<span class="st">'Total'</span>]</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb8-5"><a href="#cb8-5"></a>plt.plot(exportaciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-6-output-2.png" width="558" height="425"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(282, 2)</code></pre>
</div>
</div>
<section id="árboles-de-decisión" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Árboles de decisión</h1>
<section id="creación-de-los-rezagos" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1" class="anchored" data-anchor-id="creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</h3>
<p>Debido al análisis previo tomaremos los rezagos de 3 días atrás para poder predecir un paso adelante.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="bu">print</span>(df1)</span>
<span id="cb14-6"><a href="#cb14-6"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: []
Index: []
Empty DataFrame
Columns: []
Index: []</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">282</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="bu">print</span>(indice)</span>
<span id="cb16-4"><a href="#cb16-4"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Total'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="bu">print</span>(originalDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-30',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-30', '2000-10-31',
               ...
               '2022-09-30', '2022-10-31', '2022-11-30', '2022-12-31',
               '2023-01-31', '2023-02-28', '2023-03-31', '2023-04-30',
               '2023-05-31', '2023-06-30'],
              dtype='datetime64[ns]', length=282, freq='M')
                  0
2000-01-31  1011676
2000-02-29  1054098
2000-03-31  1053546
2000-04-30   886359
2000-05-31  1146258
...             ...
2023-02-28  4202234
2023-03-31  4431911
2023-04-30  3739214
2023-05-31  4497862
2023-06-30  3985981

[282 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Rezagos original</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb18-3"><a href="#cb18-3"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="bu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-12       t-11       t-10        t-9        t-8        t-7  \
2000-01-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-02-29        NaN        NaN        NaN        NaN        NaN        NaN   
2000-03-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-04-30        NaN        NaN        NaN        NaN        NaN        NaN   
2000-05-31        NaN        NaN        NaN        NaN        NaN        NaN   
...               ...        ...        ...        ...        ...        ...   
2023-02-28  4209198.0  4780210.0  5460531.0  4662521.0  5497617.0  5913682.0   
2023-03-31  4780210.0  5460531.0  4662521.0  5497617.0  5913682.0  4388737.0   
2023-04-30  5460531.0  4662521.0  5497617.0  5913682.0  4388737.0  4778520.0   
2023-05-31  4662521.0  5497617.0  5913682.0  4388737.0  4778520.0  4213182.0   
2023-06-30  5497617.0  5913682.0  4388737.0  4778520.0  4213182.0  4562248.0   

                  t-6        t-5        t-4        t-3        t-2        t-1  
2000-01-31        NaN        NaN        NaN        NaN        NaN        NaN  
2000-02-29        NaN        NaN        NaN        NaN        NaN  1011676.0  
2000-03-31        NaN        NaN        NaN        NaN  1011676.0  1054098.0  
2000-04-30        NaN        NaN        NaN  1011676.0  1054098.0  1053546.0  
2000-05-31        NaN        NaN  1011676.0  1054098.0  1053546.0   886359.0  
...               ...        ...        ...        ...        ...        ...  
2023-02-28  4388737.0  4778520.0  4213182.0  4562248.0  4642084.0  3696188.0  
2023-03-31  4778520.0  4213182.0  4562248.0  4642084.0  3696188.0  4202234.0  
2023-04-30  4213182.0  4562248.0  4642084.0  3696188.0  4202234.0  4431911.0  
2023-05-31  4562248.0  4642084.0  3696188.0  4202234.0  4431911.0  3739214.0  
2023-06-30  4642084.0  3696188.0  4202234.0  4431911.0  3739214.0  4497862.0  

[282 rows x 12 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Create column t original</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-12       t-11       t-10        t-9        t-8        t-7  \
2000-01-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-02-29        NaN        NaN        NaN        NaN        NaN        NaN   
2000-03-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-04-30        NaN        NaN        NaN        NaN        NaN        NaN   
2000-05-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-06-30        NaN        NaN        NaN        NaN        NaN        NaN   
2000-07-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-08-31        NaN        NaN        NaN        NaN        NaN  1011676.0   
2000-09-30        NaN        NaN        NaN        NaN  1011676.0  1054098.0   
2000-10-31        NaN        NaN        NaN  1011676.0  1054098.0  1053546.0   
2000-11-30        NaN        NaN  1011676.0  1054098.0  1053546.0   886359.0   
2000-12-31        NaN  1011676.0  1054098.0  1053546.0   886359.0  1146258.0   
2001-01-31  1011676.0  1054098.0  1053546.0   886359.0  1146258.0  1153956.0   
2001-02-28  1054098.0  1053546.0   886359.0  1146258.0  1153956.0  1104408.0   

                  t-6        t-5        t-4        t-3        t-2        t-1  \
2000-01-31        NaN        NaN        NaN        NaN        NaN        NaN   
2000-02-29        NaN        NaN        NaN        NaN        NaN  1011676.0   
2000-03-31        NaN        NaN        NaN        NaN  1011676.0  1054098.0   
2000-04-30        NaN        NaN        NaN  1011676.0  1054098.0  1053546.0   
2000-05-31        NaN        NaN  1011676.0  1054098.0  1053546.0   886359.0   
2000-06-30        NaN  1011676.0  1054098.0  1053546.0   886359.0  1146258.0   
2000-07-31  1011676.0  1054098.0  1053546.0   886359.0  1146258.0  1153956.0   
2000-08-31  1054098.0  1053546.0   886359.0  1146258.0  1153956.0  1104408.0   
2000-09-30  1053546.0   886359.0  1146258.0  1153956.0  1104408.0  1242391.0   
2000-10-31   886359.0  1146258.0  1153956.0  1104408.0  1242391.0  1102913.0   
2000-11-30  1146258.0  1153956.0  1104408.0  1242391.0  1102913.0   981716.0   
2000-12-31  1153956.0  1104408.0  1242391.0  1102913.0   981716.0  1192681.0   
2001-01-31  1104408.0  1242391.0  1102913.0   981716.0  1192681.0  1228398.0   
2001-02-28  1242391.0  1102913.0   981716.0  1192681.0  1228398.0  1017195.0   

                  t  
2000-01-31  1011676  
2000-02-29  1054098  
2000-03-31  1053546  
2000-04-30   886359  
2000-05-31  1146258  
2000-06-30  1153956  
2000-07-31  1104408  
2000-08-31  1242391  
2000-09-30  1102913  
2000-10-31   981716  
2000-11-30  1192681  
2000-12-31  1228398  
2001-01-31  1017195  
2001-02-28   964437  </code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">12</span>:]</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb22-4"><a href="#cb22-4"></a>df1_Ori.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-12       t-11       t-10        t-9        t-8        t-7  \
2001-01-31  1011676.0  1054098.0  1053546.0   886359.0  1146258.0  1153956.0   
2001-02-28  1054098.0  1053546.0   886359.0  1146258.0  1153956.0  1104408.0   
2001-03-31  1053546.0   886359.0  1146258.0  1153956.0  1104408.0  1242391.0   
2001-04-30   886359.0  1146258.0  1153956.0  1104408.0  1242391.0  1102913.0   
2001-05-31  1146258.0  1153956.0  1104408.0  1242391.0  1102913.0   981716.0   
...               ...        ...        ...        ...        ...        ...   
2023-02-28  4209198.0  4780210.0  5460531.0  4662521.0  5497617.0  5913682.0   
2023-03-31  4780210.0  5460531.0  4662521.0  5497617.0  5913682.0  4388737.0   
2023-04-30  5460531.0  4662521.0  5497617.0  5913682.0  4388737.0  4778520.0   
2023-05-31  4662521.0  5497617.0  5913682.0  4388737.0  4778520.0  4213182.0   
2023-06-30  5497617.0  5913682.0  4388737.0  4778520.0  4213182.0  4562248.0   

                  t-6        t-5        t-4        t-3        t-2        t-1  \
2001-01-31  1104408.0  1242391.0  1102913.0   981716.0  1192681.0  1228398.0   
2001-02-28  1242391.0  1102913.0   981716.0  1192681.0  1228398.0  1017195.0   
2001-03-31  1102913.0   981716.0  1192681.0  1228398.0  1017195.0   964437.0   
2001-04-30   981716.0  1192681.0  1228398.0  1017195.0   964437.0  1002450.0   
2001-05-31  1192681.0  1228398.0  1017195.0   964437.0  1002450.0  1058457.0   
...               ...        ...        ...        ...        ...        ...   
2023-02-28  4388737.0  4778520.0  4213182.0  4562248.0  4642084.0  3696188.0   
2023-03-31  4778520.0  4213182.0  4562248.0  4642084.0  3696188.0  4202234.0   
2023-04-30  4213182.0  4562248.0  4642084.0  3696188.0  4202234.0  4431911.0   
2023-05-31  4562248.0  4642084.0  3696188.0  4202234.0  4431911.0  3739214.0   
2023-06-30  4642084.0  3696188.0  4202234.0  4431911.0  3739214.0  4497862.0   

                  t  
2001-01-31  1017195  
2001-02-28   964437  
2001-03-31  1002450  
2001-04-30  1058457  
2001-05-31  1068023  
...             ...  
2023-02-28  4202234  
2023-03-31  4431911  
2023-04-30  3739214  
2023-05-31  4497862  
2023-06-30  3985981  

[270 rows x 13 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>3510</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="bu">print</span>(X1)</span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1011676. 1054098. 1053546. ...  981716. 1192681. 1228398.]
 [1054098. 1053546.  886359. ... 1192681. 1228398. 1017195.]
 [1053546.  886359. 1146258. ... 1228398. 1017195.  964437.]
 ...
 [5460531. 4662521. 5497617. ... 3696188. 4202234. 4431911.]
 [4662521. 5497617. 5913682. ... 4202234. 4431911. 3739214.]
 [5497617. 5913682. 4388737. ... 4431911. 3739214. 4497862.]]
Respuestas 
 [1017195.  964437. 1002450. 1058457. 1068023.  996736. 1005867. 1189605.
 1078781. 1013772.  965973.  968599.  943702.  945935.  859303. 1123902.
 1076509.  921463. 1040876.  915457. 1055414. 1070342.  966897. 1055590.
  923427. 1033043. 1034233. 1101056. 1181888.  995297. 1267598. 1092850.
 1079472. 1169195. 1082836. 1167628. 1183399. 1031826. 1206657. 1271618.
 1335727. 1433647. 1541103. 1516523. 1519458. 1529291. 1585709. 1633370.
 1378980. 1529265. 1722081. 1682450. 1737198. 2097853. 1653833. 1882740.
 1908016. 1788905. 1826199. 1938567. 1668171. 1862024. 1929864. 1872161.
 2211681. 2039364. 2141958. 2129881. 2104243. 2271572. 2146547. 2134504.
 1843668. 1914770. 2384657. 2497750. 2727980. 2114259. 2648147. 2621002.
 2523170. 2623649. 3152653. 3227536. 2842306. 2822470. 3007288. 3365420.
 3392615. 3675654. 3801685. 3294187. 3133994. 2981105. 2245379. 2224271.
 2525698. 2340118. 2711332. 2427571. 2742519. 2738083. 2898600. 2673470.
 2795983. 2948687. 2861294. 3182972. 2913433. 2869156. 3337903. 3490978.
 3513331. 3060628. 3157626. 3291236. 3271661. 3535759. 3426095. 3845531.
 3760176. 3958572. 4893312. 4823094. 5153710. 4708737. 4866229. 4941645.
 4582401. 4772996. 5147330. 5306738. 4785773. 4999318. 5712355. 5010929.
 5403375. 4563431. 4976905. 4570780. 4910403. 5432930. 4807338. 4951628.
 4849196. 4667767. 4617842. 4949487. 5332470. 4870839. 4652297. 4977706.
 4849996. 4837983. 4948665. 5272122. 4808832. 4271442. 4408181. 4316676.
 5495867. 4704814. 5048930. 4813091. 5077247. 4322278. 3794686. 3794711.
 2916976. 3160957. 3461944. 3219706. 3381084. 3217408. 3043778. 2868451.
 2898168. 2815522. 2444535. 2588994. 1919053. 2328723. 2334998. 2463793.
 2751470. 2780512. 2266997. 3044377. 2797686. 2770014. 2833622. 3477094.
 2785044. 2716024. 3300421. 2697992. 3505436. 2895612. 3125483. 3191598.
 3389679. 3277516. 3122237. 4014818. 3324889. 3027603. 3365116. 3786537.
 3719410. 3331933. 3632055. 3684399. 3512842. 3768666. 3343509. 3407819.
 3066110. 3183071. 3344850. 3862819. 3748342. 3096363. 3255830. 3264261.
 3067349. 3326497. 2943625. 3330051. 3419466. 2943626. 2439036. 1864239.
 2221172. 2289482. 2551988. 2584767. 2544874. 2644954. 2523372. 3028837.
 2610936. 2938994. 3383554. 2976372. 3096913. 3182216. 3444158. 3465143.
 3792236. 3799111. 4155805. 4544551. 3801609. 4209198. 4780210. 5460531.
 4662521. 5497617. 5913682. 4388737. 4778520. 4213182. 4562248. 4642084.
 3696188. 4202234. 4431911. 3739214. 4497862. 3985981.]</code></pre>
</div>
</div>
</section>
</section>
<section id="árbol-para-serie-original" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Árbol para Serie Original</h1>
<section id="entrenamiento-validación-y-prueba" class="level4" data-number="2.0.0.1">
<h4 data-number="2.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba"><span class="header-section-number">2.0.0.1</span> Entrenamiento, Validación y prueba</h4>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb27-3"><a href="#cb27-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb27-4"><a href="#cb27-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 270
189 28 54
Train + Validation + Test: 271</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 270
Training Observations for Target: 189
Validation Observations for Target: 28
Test Observations for Target: 53</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 270
Training Observations for Feature: 189
Validation Observations for Feature: 28
Test Observations for Feature: 53</code></pre>
</div>
</div>
</section>
<section id="árbol" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="árbol"><span class="header-section-number">2.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de Validación: -1.7548809186918701
el RECM sobre validación es: 332309503244.0</code></pre>
</div>
</div>
<p>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb35-7"><a href="#cb35-7"></a></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb35-9"><a href="#cb35-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb35-11"><a href="#cb35-11"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb35-12"><a href="#cb35-12"></a>    </span>
<span id="cb35-13"><a href="#cb35-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb35-15"><a href="#cb35-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb35-16"><a href="#cb35-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9380991089808784
Coeficiente R2 sobre el conjunto de validación: -2.051209928658386 

el RECM sobre el conjunto de validación es: 606674.875354811
max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9664178293704504
Coeficiente R2 sobre el conjunto de validación: -1.7135186026890032 

el RECM sobre el conjunto de validación es: 572118.9945819594
max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9768825370828798
Coeficiente R2 sobre el conjunto de validación: -1.7037887014868796 

el RECM sobre el conjunto de validación es: 571092.3459406185
max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9851230357060198
Coeficiente R2 sobre el conjunto de validación: -1.832333851372148 

el RECM sobre el conjunto de validación es: 584510.3243444414
max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9925782041053538
Coeficiente R2 sobre el conjunto de validación: -2.2041965658843563 

el RECM sobre el conjunto de validación es: 621698.1004856585
max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9978144610458868
Coeficiente R2 sobre el conjunto de validación: -2.3497128586740375 

el RECM sobre el conjunto de validación es: 635658.3486494402
max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9994408733552114
Coeficiente R2 sobre el conjunto de validación: -2.811262198389598 

el RECM sobre el conjunto de validación es: 678038.5380785092
max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9998981374422563
Coeficiente R2 sobre el conjunto de validación: -2.0147327960575905 

el RECM sobre el conjunto de validación es: 603037.5808233338
max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999911411632353
Coeficiente R2 sobre el conjunto de validación: -2.1214885273158406 

el RECM sobre el conjunto de validación es: 613621.8796439593
max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999995801959258
Coeficiente R2 sobre el conjunto de validación: -2.1521096826836246 

el RECM sobre el conjunto de validación es: 616624.2860853936
max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999999961093721
Coeficiente R2 sobre el conjunto de validación: -2.5439260490331046 

el RECM sobre el conjunto de validación es: 653826.1563723243
max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de validación: -2.7126672435521564 

el RECM sobre el conjunto de validación es: 669210.8571930343
max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de validación: -1.9050269567306248 

el RECM sobre el conjunto de validación es: 591963.6624602235
max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de validación: -2.3128435879041693 

el RECM sobre el conjunto de validación es: 632150.42019757</code></pre>
</div>
</div>
<p>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="co">#######</span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="co">####</span></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="co">#####</span></span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="co">####</span></span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb37-14"><a href="#cb37-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb37-15"><a href="#cb37-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb37-16"><a href="#cb37-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(189, 12)
(28, 12)
(189,)
(28,)
(217, 12)
(217,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb39-2"><a href="#cb39-2"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb39-7"><a href="#cb39-7"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb39-14"><a href="#cb39-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb39-16"><a href="#cb39-16"></a>plt.legend()</span>
<span id="cb39-17"><a href="#cb39-17"></a>plt.show()</span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb39-19"><a href="#cb39-19"></a></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-21-output-1.png" width="576" height="443"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 237470.97155102508
Raíz de la Pérdida cuadrática Prueba: 512170.57525904087</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb41-4"><a href="#cb41-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb41-5"><a href="#cb41-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_11 &lt;= 2818996.00
|   |--- feature_0 &lt;= 1406313.50
|   |   |--- feature_11 &lt;= 1269608.00
|   |   |   |--- feature_7 &lt;= 944818.50
|   |   |   |   |--- value: [944508.20]
|   |   |   |--- feature_7 &gt;  944818.50
|   |   |   |   |--- value: [1068707.63]
|   |   |--- feature_11 &gt;  1269608.00
|   |   |   |--- feature_7 &lt;= 1524374.50
|   |   |   |   |--- value: [1485522.56]
|   |   |   |--- feature_7 &gt;  1524374.50
|   |   |   |   |--- value: [1688654.00]
|   |--- feature_0 &gt;  1406313.50
|   |   |--- feature_0 &lt;= 2101048.00
|   |   |   |--- feature_0 &lt;= 1729639.50
|   |   |   |   |--- value: [1895482.33]
|   |   |   |--- feature_0 &gt;  1729639.50
|   |   |   |   |--- value: [2177202.55]
|   |   |--- feature_0 &gt;  2101048.00
|   |   |   |--- feature_6 &lt;= 2851036.50
|   |   |   |   |--- value: [2806855.75]
|   |   |   |--- feature_6 &gt;  2851036.50
|   |   |   |   |--- value: [2414665.18]
|--- feature_11 &gt;  2818996.00
|   |--- feature_11 &lt;= 3902051.50
|   |   |--- feature_11 &lt;= 3328411.00
|   |   |   |--- feature_5 &lt;= 3491265.00
|   |   |   |   |--- value: [3049887.90]
|   |   |   |--- feature_5 &gt;  3491265.00
|   |   |   |   |--- value: [3412516.20]
|   |   |--- feature_11 &gt;  3328411.00
|   |   |   |--- feature_8 &lt;= 2810078.00
|   |   |   |   |--- value: [2840328.00]
|   |   |   |--- feature_8 &gt;  2810078.00
|   |   |   |   |--- value: [3496117.27]
|   |--- feature_11 &gt;  3902051.50
|   |   |--- feature_7 &lt;= 3308846.50
|   |   |   |--- value: [3324889.00]
|   |   |--- feature_7 &gt;  3308846.50
|   |   |   |--- feature_5 &lt;= 5150520.00
|   |   |   |   |--- value: [4812843.37]
|   |   |   |--- feature_5 &gt;  5150520.00
|   |   |   |   |--- value: [5188817.57]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb43-2"><a href="#cb43-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb43-3"><a href="#cb43-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb43-4"><a href="#cb43-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb43-5"><a href="#cb43-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-23-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>217
217
53
53</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">225</span>]</span>
<span id="cb46-4"><a href="#cb46-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">225</span>:<span class="dv">280</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>270</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>225
45</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb50-2"><a href="#cb50-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>270
270</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb52-2"><a href="#cb52-2"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb52-3"><a href="#cb52-3"></a>ObsvsPred1.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-01-31</td>
<td>1017195.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001-02-28</td>
<td>964437.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-03-31</td>
<td>1002450.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001-04-30</td>
<td>1058457.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-05-31</td>
<td>1068023.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001-06-30</td>
<td>996736.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-07-31</td>
<td>1005867.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001-08-31</td>
<td>1189605.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-09-30</td>
<td>1078781.0</td>
<td>1.068708e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001-10-31</td>
<td>1013772.0</td>
<td>1.068708e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="co">#gráfico</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>plt.legend()</span>
<span id="cb53-8"><a href="#cb53-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-29-output-1.png" width="781" height="499"></p>
</div>
</div>
</section>
</section>
<section id="serie-de-exportaciones-sin-tendencia" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Serie de Exportaciones sin Tendencia</h1>
<p>Implementaremos ahora el modelo de árboles sobre la serie sin tendencia, eliminada usando la estimación dada por medio del filtro de promedios móviles. Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. <span class="math inline">\(\{X_t\}\)</span></p>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"ExportacionesSinTendencia.xlsx"</span>,</span>
<span id="cb54-3"><a href="#cb54-3"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'ExportacionesSinTend'</span>]).reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb54-4"><a href="#cb54-4"></a>data2[<span class="st">'ExportacionesSinTend'</span>] <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb54-5"><a href="#cb54-5"></a>data2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fecha</th>
<th data-quarto-table-cell-role="th">ExportacionesSinTend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000-07-01</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000-08-01</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000-09-01</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000-10-01</td>
<td>-53</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000-11-01</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">265</td>
<td>2022-08-01</td>
<td>-71</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">266</td>
<td>2022-09-01</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">267</td>
<td>2022-10-01</td>
<td>-88</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">268</td>
<td>2022-11-01</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">269</td>
<td>2022-12-01</td>
<td>39</td>
</tr>
</tbody>
</table>

<p>270 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="bu">print</span>(data2.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 270 entries, 0 to 269
Data columns (total 2 columns):
 #   Column                Non-Null Count  Dtype         
---  ------                --------------  -----         
 0   Fecha                 270 non-null    datetime64[ns]
 1   ExportacionesSinTend  270 non-null    int32         
dtypes: datetime64[ns](1), int32(1)
memory usage: 3.3 KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">#mirando los datos</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co">#objeto ts</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>exportaciones <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>]</span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb57-5"><a href="#cb57-5"></a>plt.plot(exportaciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-32-output-2.png" width="586" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>data2.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>(270, 2)</code></pre>
</div>
</div>
</section>
<section id="árboles-de-decisión-1" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Árboles de decisión</h1>
<section id="creación-de-los-rezagos-1" class="level3" data-number="4.0.1">
<h3 data-number="4.0.1" class="anchored" data-anchor-id="creación-de-los-rezagos-1"><span class="header-section-number">4.0.1</span> Creación de los rezagos</h3>
<p>Tomaremos los rezagos de 12 meses atrás para poder predecir un paso adelante.</p>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="bu">print</span>(df1)</span>
<span id="cb63-6"><a href="#cb63-6"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: []
Index: []
Empty DataFrame
Columns: []
Index: []</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/7/2000'</span>, periods<span class="op">=</span><span class="dv">270</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="bu">print</span>(indice)</span>
<span id="cb65-4"><a href="#cb65-4"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data2[<span class="st">'ExportacionesSinTend'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb65-5"><a href="#cb65-5"></a><span class="bu">print</span>(originalDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-30',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-30', '2000-10-31',
               ...
               '2021-09-30', '2021-10-31', '2021-11-30', '2021-12-31',
               '2022-01-31', '2022-02-28', '2022-03-31', '2022-04-30',
               '2022-05-31', '2022-06-30'],
              dtype='datetime64[ns]', length=270, freq='M')
             0
2000-01-31   5
2000-02-29  70
2000-03-31   9
2000-04-30 -53
2000-05-31  46
...         ..
2022-02-28 -71
2022-03-31  17
2022-04-30 -88
2022-05-31   7
2022-06-30  39

[270 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Rezagos original</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb67-3"><a href="#cb67-3"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="bu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            t-12   t-11   t-10    t-9    t-8    t-7    t-6    t-5    t-4  \
2000-01-31   NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN   
2000-02-29   NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN   
2000-03-31   NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN   
2000-04-30   NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN   
2000-05-31   NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    5.0   
...          ...    ...    ...    ...    ...    ...    ...    ...    ...   
2022-02-28 -30.0   24.0  -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   
2022-03-31  24.0  -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0   
2022-04-30 -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0   
2022-05-31  33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0  239.0   
2022-06-30  82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0  239.0  -71.0   

              t-3    t-2    t-1  
2000-01-31    NaN    NaN    NaN  
2000-02-29    NaN    NaN    5.0  
2000-03-31    NaN    5.0   70.0  
2000-04-30    5.0   70.0    9.0  
2000-05-31   70.0    9.0  -53.0  
...           ...    ...    ...  
2022-02-28   -7.0  159.0  239.0  
2022-03-31  159.0  239.0  -71.0  
2022-04-30  239.0  -71.0   17.0  
2022-05-31  -71.0   17.0  -88.0  
2022-06-30   17.0  -88.0    7.0  

[270 rows x 12 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Create column t original</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            t-12  t-11  t-10   t-9   t-8   t-7   t-6   t-5   t-4   t-3   t-2  \
2000-01-31   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   
2000-02-29   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   
2000-03-31   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   5.0   
2000-04-30   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   5.0  70.0   
2000-05-31   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   5.0  70.0   9.0   
2000-06-30   NaN   NaN   NaN   NaN   NaN   NaN   NaN   5.0  70.0   9.0 -53.0   
2000-07-31   NaN   NaN   NaN   NaN   NaN   NaN   5.0  70.0   9.0 -53.0  46.0   
2000-08-31   NaN   NaN   NaN   NaN   NaN   5.0  70.0   9.0 -53.0  46.0  67.0   
2000-09-30   NaN   NaN   NaN   NaN   5.0  70.0   9.0 -53.0  46.0  67.0 -28.0   
2000-10-31   NaN   NaN   NaN   5.0  70.0   9.0 -53.0  46.0  67.0 -28.0 -51.0   
2000-11-30   NaN   NaN   5.0  70.0   9.0 -53.0  46.0  67.0 -28.0 -51.0 -31.0   
2000-12-31   NaN   5.0  70.0   9.0 -53.0  46.0  67.0 -28.0 -51.0 -31.0  -3.0   
2001-01-31   5.0  70.0   9.0 -53.0  46.0  67.0 -28.0 -51.0 -31.0  -3.0   5.0   
2001-02-28  70.0   9.0 -53.0  46.0  67.0 -28.0 -51.0 -31.0  -3.0   5.0 -20.0   

             t-1   t  
2000-01-31   NaN   5  
2000-02-29   5.0  70  
2000-03-31  70.0   9  
2000-04-30   9.0 -53  
2000-05-31 -53.0  46  
2000-06-30  46.0  67  
2000-07-31  67.0 -28  
2000-08-31 -28.0 -51  
2000-09-30 -51.0 -31  
2000-10-31 -31.0  -3  
2000-11-30  -3.0   5  
2000-12-31   5.0 -20  
2001-01-31 -20.0  -9  
2001-02-28  -9.0  81  </code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">12</span>:]</span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb71-4"><a href="#cb71-4"></a>df1_Ori.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            t-12   t-11   t-10    t-9    t-8    t-7    t-6    t-5    t-4  \
2001-01-31   5.0   70.0    9.0  -53.0   46.0   67.0  -28.0  -51.0  -31.0   
2001-02-28  70.0    9.0  -53.0   46.0   67.0  -28.0  -51.0  -31.0   -3.0   
2001-03-31   9.0  -53.0   46.0   67.0  -28.0  -51.0  -31.0   -3.0    5.0   
2001-04-30 -53.0   46.0   67.0  -28.0  -51.0  -31.0   -3.0    5.0  -20.0   
2001-05-31  46.0   67.0  -28.0  -51.0  -31.0   -3.0    5.0  -20.0   -9.0   
...          ...    ...    ...    ...    ...    ...    ...    ...    ...   
2022-02-28 -30.0   24.0  -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   
2022-03-31  24.0  -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0   
2022-04-30 -12.0   33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0   
2022-05-31  33.0   82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0  239.0   
2022-06-30  82.0 -132.0  -68.0   39.0  164.0   -7.0  159.0  239.0  -71.0   

              t-3    t-2    t-1   t  
2001-01-31   -3.0    5.0  -20.0  -9  
2001-02-28    5.0  -20.0   -9.0  81  
2001-03-31  -20.0   -9.0   81.0  32  
2001-04-30   -9.0   81.0   32.0   2  
2001-05-31   81.0   32.0    2.0 -23  
...           ...    ...    ...  ..  
2022-02-28   -7.0  159.0  239.0 -71  
2022-03-31  159.0  239.0  -71.0  17  
2022-04-30  239.0  -71.0   17.0 -88  
2022-05-31  -71.0   17.0  -88.0   7  
2022-06-30   17.0  -88.0    7.0  39  

[258 rows x 13 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>3354</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb74-5"><a href="#cb74-5"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="bu">print</span>(X1)</span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[   5.   70.    9. ...   -3.    5.  -20.]
 [  70.    9.  -53. ...    5.  -20.   -9.]
 [   9.  -53.   46. ...  -20.   -9.   81.]
 ...
 [ -12.   33.   82. ...  239.  -71.   17.]
 [  33.   82. -132. ...  -71.   17.  -88.]
 [  82. -132.  -68. ...   17.  -88.    7.]]
Respuestas 
 [  -9.   81.   32.    2.  -23.  -20.  -32.  -26.  -66.   67.   43.  -37.
   23.  -42.   23.   27.  -26.   14.  -58.  -11.  -14.   15.   49.  -45.
   75.  -10.  -20.   16.  -31.   -2.   -8.  -92.  -26.  -11.    1.   25.
   57.   34.   18.    6.   15.   16.  -98.  -44.   18.   -7.    6.  124.
  -43.   31.   31.  -17.  -14.   20.  -84.  -24.   -6.  -36.   67.    3.
   32.   24.    9.   49.   -7.  -19. -126. -114.   29.   54.  105. -110.
   30.   -3.  -52.  -40.   91.   85.  -51.  -77.  -41.   43.   56.  150.
  197.   80.   47.   20. -180. -169.  -55.  -95.   28.  -52.   34.   13.
   43.  -33.  -11.   12.  -33.   42.  -38.  -60.   54.   81.   74.  -57.
  -47.  -33.  -65.  -25.  -81.   -9.  -63.  -48.  130.   90.  131.    9.
   19.   16.  -77.  -45.   29.   61.  -46.    1.  143.   -5.   72.  -97.
   -6.  -90.   -6.  110.  -16.   12.   -9.  -49.  -63.   13.   95.   -3.
  -52.   21.   -1.    5.   32.   98.    1. -118.  -88. -106.  156.   18.
  123.  104.  180.   38.  -53.  -19. -211. -106.   13.  -12.   61.   47.
   27.    1.   33.   31.  -62.   -6. -207.  -64.  -63.  -21.   60.   53.
 -123.   89.    4.  -18.  -11.  151.  -47.  -78.   73. -104.  104.  -66.
  -15.   -7.   40.   -1.  -56.  159.  -20. -110.  -27.   71.   47.  -46.
   39.   53.    9.   71.  -36.  -17. -100.  -61.   -9.  129.  110.  -51.
  -12.  -11.  -50.   53.   -8.  123.  164.   54.  -79. -254. -121.  -90.
    3.   22.   -1.    4.  -58.   66.  -74.    0.   94.  -41.  -38.  -48.
   -9.  -30.   24.  -12.   33.   82. -132.  -68.   39.  164.   -7.  159.
  239.  -71.   17.  -88.    7.   39.]</code></pre>
</div>
</div>
</section>
</section>
<section id="árbol-para-serie-sin-tendencia" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Árbol para Serie Sin Tendencia</h1>
<section id="entrenamiento-validación-y-prueba-1" class="level4" data-number="5.0.0.1">
<h4 data-number="5.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba-1"><span class="header-section-number">5.0.0.1</span> Entrenamiento, Validación y prueba</h4>
<div class="cell" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb76-3"><a href="#cb76-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb76-4"><a href="#cb76-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb76-7"><a href="#cb76-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 258
180 26 51
Train + Validation + Test: 257</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 258
Training Observations for Target: 180
Validation Observations for Target: 26
Test Observations for Target: 52</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb80-2"><a href="#cb80-2"></a></span>
<span id="cb80-3"><a href="#cb80-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb80-4"><a href="#cb80-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb80-5"><a href="#cb80-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb80-6"><a href="#cb80-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb80-7"><a href="#cb80-7"></a></span>
<span id="cb80-8"><a href="#cb80-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb80-9"><a href="#cb80-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb80-10"><a href="#cb80-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb80-11"><a href="#cb80-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 258
Training Observations for Feature: 180
Validation Observations for Feature: 26
Test Observations for Feature: 52</code></pre>
</div>
</div>
</section>
<section id="árbol-1" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="árbol-1"><span class="header-section-number">5.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb82-8"><a href="#cb82-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb82-9"><a href="#cb82-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb82-10"><a href="#cb82-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb82-11"><a href="#cb82-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de Validación: -0.36155906119852443
el RECM sobre validación es: 7475.307692307692</code></pre>
</div>
</div>
<p>Vemos que el R2 para los datos de validación es malo pues es negativo, Se relizará un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</p>
<div class="cell" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb84-2"><a href="#cb84-2"></a></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb84-7"><a href="#cb84-7"></a></span>
<span id="cb84-8"><a href="#cb84-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb84-9"><a href="#cb84-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb84-10"><a href="#cb84-10"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb84-11"><a href="#cb84-11"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb84-12"><a href="#cb84-12"></a>    </span>
<span id="cb84-13"><a href="#cb84-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb84-14"><a href="#cb84-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb84-15"><a href="#cb84-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb84-16"><a href="#cb84-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb84-17"><a href="#cb84-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.25686511970310677
Coeficiente R2 sobre el conjunto de validación: -0.2651415670711108 

el RECM sobre el conjunto de validación es: 83.3423720244207 

max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.4245443431150394
Coeficiente R2 sobre el conjunto de validación: -0.25312344192618963 

el RECM sobre el conjunto de validación es: 82.94557487875332 

max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.570233841687424
Coeficiente R2 sobre el conjunto de validación: -0.3946378641992552 

el RECM sobre el conjunto de validación es: 87.50382155206147 

max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.7247525080241783
Coeficiente R2 sobre el conjunto de validación: -0.19662975618360146 

el RECM sobre el conjunto de validación es: 81.05432498970345 

max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.8709713841871555
Coeficiente R2 sobre el conjunto de validación: -0.35559462890663207 

el RECM sobre el conjunto de validación es: 86.27028128286491 

max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9433510456062553
Coeficiente R2 sobre el conjunto de validación: -0.709072303001282 

el RECM sobre el conjunto de validación es: 96.86714780774055 

max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9726668839828992
Coeficiente R2 sobre el conjunto de validación: -0.6473773745003699 

el RECM sobre el conjunto de validación es: 95.10269911072858 

max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9865860401853749
Coeficiente R2 sobre el conjunto de validación: -0.39089588349704174 

el RECM sobre el conjunto de validación es: 87.38635107682887 

max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9941479557500952
Coeficiente R2 sobre el conjunto de validación: -0.48267762709243045 

el RECM sobre el conjunto de validación es: 90.2234981331616 

max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9978703406029361
Coeficiente R2 sobre el conjunto de validación: -0.8745405463882787 

el RECM sobre el conjunto de validación es: 101.44805235569653 

max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9990766376693829
Coeficiente R2 sobre el conjunto de validación: -0.4727281499619058 

el RECM sobre el conjunto de validación es: 89.92026712424794 

max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9995620305866239
Coeficiente R2 sobre el conjunto de validación: -0.24182245414347547 

el RECM sobre el conjunto de validación es: 82.57071561348538 

max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999093006589739
Coeficiente R2 sobre el conjunto de validación: -0.5578788994919184 

el RECM sobre el conjunto de validación es: 92.48326251897608 

max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999917449841307
Coeficiente R2 sobre el conjunto de validación: -0.7418972235102907 

el RECM sobre el conjunto de validación es: 97.79295239669135 
</code></pre>
</div>
</div>
<p>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Tomaremos el más cercano a cero que el el de la profundidad 6. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</p>
<div class="cell" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="co">#######</span></span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb86-5"><a href="#cb86-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co">####</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb86-9"><a href="#cb86-9"></a><span class="co">#####</span></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co">####</span></span>
<span id="cb86-11"><a href="#cb86-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb86-12"><a href="#cb86-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb86-13"><a href="#cb86-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb86-14"><a href="#cb86-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-15"><a href="#cb86-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-16"><a href="#cb86-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb86-17"><a href="#cb86-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(180, 12)
(26, 12)
(180,)
(26,)
(206, 12)
(206,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb88-2"><a href="#cb88-2"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">6</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb88-3"><a href="#cb88-3"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb88-4"><a href="#cb88-4"></a></span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb88-6"><a href="#cb88-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb88-7"><a href="#cb88-7"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb88-8"><a href="#cb88-8"></a></span>
<span id="cb88-9"><a href="#cb88-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb88-10"><a href="#cb88-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb88-11"><a href="#cb88-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb88-12"><a href="#cb88-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb88-13"><a href="#cb88-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb88-14"><a href="#cb88-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb88-15"><a href="#cb88-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb88-16"><a href="#cb88-16"></a>plt.legend()</span>
<span id="cb88-17"><a href="#cb88-17"></a>plt.show()</span>
<span id="cb88-18"><a href="#cb88-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb88-19"><a href="#cb88-19"></a></span>
<span id="cb88-20"><a href="#cb88-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-47-output-1.png" width="604" height="429"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 34.410731597123124
Raíz de la Pérdida cuadrática Prueba: 102.6782863348308</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb90-2"><a href="#cb90-2"></a></span>
<span id="cb90-3"><a href="#cb90-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb90-4"><a href="#cb90-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb90-5"><a href="#cb90-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb90-6"><a href="#cb90-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_6 &lt;= 18.50
|   |--- feature_5 &lt;= 80.00
|   |   |--- feature_0 &lt;= -10.50
|   |   |   |--- feature_9 &lt;= -42.50
|   |   |   |   |--- feature_9 &lt;= -62.50
|   |   |   |   |   |--- feature_4 &lt;= 18.00
|   |   |   |   |   |   |--- value: [-42.50]
|   |   |   |   |   |--- feature_4 &gt;  18.00
|   |   |   |   |   |   |--- value: [-5.00]
|   |   |   |   |--- feature_9 &gt;  -62.50
|   |   |   |   |   |--- feature_9 &lt;= -59.00
|   |   |   |   |   |   |--- value: [-64.00]
|   |   |   |   |   |--- feature_9 &gt;  -59.00
|   |   |   |   |   |   |--- value: [-107.00]
|   |   |   |--- feature_9 &gt;  -42.50
|   |   |   |   |--- feature_1 &lt;= 30.00
|   |   |   |   |   |--- feature_9 &lt;= -16.50
|   |   |   |   |   |   |--- value: [-54.60]
|   |   |   |   |   |--- feature_9 &gt;  -16.50
|   |   |   |   |   |   |--- value: [-3.48]
|   |   |   |   |--- feature_1 &gt;  30.00
|   |   |   |   |   |--- feature_10 &lt;= -35.50
|   |   |   |   |   |   |--- value: [76.00]
|   |   |   |   |   |--- feature_10 &gt;  -35.50
|   |   |   |   |   |   |--- value: [15.00]
|   |   |--- feature_0 &gt;  -10.50
|   |   |   |--- feature_10 &lt;= 116.50
|   |   |   |   |--- feature_8 &lt;= 48.00
|   |   |   |   |   |--- feature_1 &lt;= -71.50
|   |   |   |   |   |   |--- value: [-37.25]
|   |   |   |   |   |--- feature_1 &gt;  -71.50
|   |   |   |   |   |   |--- value: [29.84]
|   |   |   |   |--- feature_8 &gt;  48.00
|   |   |   |   |   |--- feature_5 &lt;= -15.50
|   |   |   |   |   |   |--- value: [7.30]
|   |   |   |   |   |--- feature_5 &gt;  -15.50
|   |   |   |   |   |   |--- value: [-38.25]
|   |   |   |--- feature_10 &gt;  116.50
|   |   |   |   |--- feature_4 &lt;= 8.50
|   |   |   |   |   |--- feature_3 &lt;= 32.50
|   |   |   |   |   |   |--- value: [131.00]
|   |   |   |   |   |--- feature_3 &gt;  32.50
|   |   |   |   |   |   |--- value: [180.00]
|   |   |   |   |--- feature_4 &gt;  8.50
|   |   |   |   |   |--- feature_4 &lt;= 50.50
|   |   |   |   |   |   |--- value: [31.00]
|   |   |   |   |   |--- feature_4 &gt;  50.50
|   |   |   |   |   |   |--- value: [80.00]
|   |--- feature_5 &gt;  80.00
|   |   |--- feature_8 &lt;= 26.00
|   |   |   |--- feature_11 &lt;= 120.50
|   |   |   |   |--- feature_0 &lt;= 111.50
|   |   |   |   |   |--- feature_1 &lt;= 7.00
|   |   |   |   |   |   |--- value: [75.17]
|   |   |   |   |   |--- feature_1 &gt;  7.00
|   |   |   |   |   |   |--- value: [116.50]
|   |   |   |   |--- feature_0 &gt;  111.50
|   |   |   |   |   |--- value: [159.00]
|   |   |   |--- feature_11 &gt;  120.50
|   |   |   |   |--- value: [197.00]
|   |   |--- feature_8 &gt;  26.00
|   |   |   |--- feature_10 &lt;= 12.00
|   |   |   |   |--- value: [-84.00]
|   |   |   |--- feature_10 &gt;  12.00
|   |   |   |   |--- feature_7 &lt;= 22.50
|   |   |   |   |   |--- value: [-15.00]
|   |   |   |   |--- feature_7 &gt;  22.50
|   |   |   |   |   |--- value: [-19.00]
|--- feature_6 &gt;  18.50
|   |--- feature_9 &lt;= 25.50
|   |   |--- feature_0 &lt;= -7.50
|   |   |   |--- feature_8 &lt;= -18.50
|   |   |   |   |--- feature_4 &lt;= -24.50
|   |   |   |   |   |--- feature_10 &lt;= 21.00
|   |   |   |   |   |   |--- value: [32.00]
|   |   |   |   |   |--- feature_10 &gt;  21.00
|   |   |   |   |   |   |--- value: [150.00]
|   |   |   |   |--- feature_4 &gt;  -24.50
|   |   |   |   |   |--- feature_9 &lt;= -85.50
|   |   |   |   |   |   |--- value: [23.33]
|   |   |   |   |   |--- feature_9 &gt;  -85.50
|   |   |   |   |   |   |--- value: [-37.38]
|   |   |   |--- feature_8 &gt;  -18.50
|   |   |   |   |--- feature_7 &lt;= 33.00
|   |   |   |   |   |--- feature_11 &lt;= -112.00
|   |   |   |   |   |   |--- value: [-114.00]
|   |   |   |   |   |--- feature_11 &gt;  -112.00
|   |   |   |   |   |   |--- value: [-27.77]
|   |   |   |   |--- feature_7 &gt;  33.00
|   |   |   |   |   |--- feature_1 &lt;= -84.50
|   |   |   |   |   |   |--- value: [-102.00]
|   |   |   |   |   |--- feature_1 &gt;  -84.50
|   |   |   |   |   |   |--- value: [-66.50]
|   |   |--- feature_0 &gt;  -7.50
|   |   |   |--- feature_0 &lt;= -5.50
|   |   |   |   |--- feature_6 &lt;= 79.00
|   |   |   |   |   |--- value: [151.00]
|   |   |   |   |--- feature_6 &gt;  79.00
|   |   |   |   |   |--- value: [91.00]
|   |   |   |--- feature_0 &gt;  -5.50
|   |   |   |   |--- feature_11 &lt;= -85.50
|   |   |   |   |   |--- value: [156.00]
|   |   |   |   |--- feature_11 &gt;  -85.50
|   |   |   |   |   |--- feature_2 &lt;= 36.50
|   |   |   |   |   |   |--- value: [13.46]
|   |   |   |   |   |--- feature_2 &gt;  36.50
|   |   |   |   |   |   |--- value: [-46.67]
|   |--- feature_9 &gt;  25.50
|   |   |--- feature_4 &lt;= 27.50
|   |   |   |--- feature_8 &lt;= 173.50
|   |   |   |   |--- feature_2 &lt;= -38.50
|   |   |   |   |   |--- feature_0 &lt;= -1.50
|   |   |   |   |   |   |--- value: [-8.50]
|   |   |   |   |   |--- feature_0 &gt;  -1.50
|   |   |   |   |   |   |--- value: [20.00]
|   |   |   |   |--- feature_2 &gt;  -38.50
|   |   |   |   |   |--- feature_9 &lt;= 151.00
|   |   |   |   |   |   |--- value: [-71.83]
|   |   |   |   |   |--- feature_9 &gt;  151.00
|   |   |   |   |   |   |--- value: [-3.50]
|   |   |   |--- feature_8 &gt;  173.50
|   |   |   |   |--- value: [-180.00]
|   |   |--- feature_4 &gt;  27.50
|   |   |   |--- feature_1 &lt;= -38.50
|   |   |   |   |--- feature_11 &lt;= -99.50
|   |   |   |   |   |--- value: [-169.00]
|   |   |   |   |--- feature_11 &gt;  -99.50
|   |   |   |   |   |--- feature_11 &lt;= -12.50
|   |   |   |   |   |   |--- value: [-211.00]
|   |   |   |   |   |--- feature_11 &gt;  -12.50
|   |   |   |   |   |   |--- value: [-207.00]
|   |   |   |--- feature_1 &gt;  -38.50
|   |   |   |   |--- feature_1 &lt;= -25.00
|   |   |   |   |   |--- value: [-58.00]
|   |   |   |   |--- feature_1 &gt;  -25.00
|   |   |   |   |   |--- value: [-126.00]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb92-2"><a href="#cb92-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb92-3"><a href="#cb92-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb92-4"><a href="#cb92-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb92-5"><a href="#cb92-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-49-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</p>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb93-3"><a href="#cb93-3"></a></span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb93-5"><a href="#cb93-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>206
206
52
52</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb95-3"><a href="#cb95-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">206</span>]</span>
<span id="cb95-4"><a href="#cb95-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">206</span>:<span class="dv">258</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>258</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>206
52</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb99-2"><a href="#cb99-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb99-4"><a href="#cb99-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>258
258</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb101-2"><a href="#cb101-2"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb101-3"><a href="#cb101-3"></a>ObsvsPred1.tail(<span class="dv">52</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-03-31</td>
<td>9.0</td>
<td>29.842105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-04-30</td>
<td>71.0</td>
<td>-71.833333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-05-31</td>
<td>-36.0</td>
<td>-71.833333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-06-30</td>
<td>-17.0</td>
<td>-38.250000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-07-31</td>
<td>-100.0</td>
<td>-211.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-31</td>
<td>-61.0</td>
<td>-27.769231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-09-30</td>
<td>-9.0</td>
<td>76.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-10-31</td>
<td>129.0</td>
<td>13.461538</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-11-30</td>
<td>110.0</td>
<td>29.842105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-12-31</td>
<td>-51.0</td>
<td>15.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-31</td>
<td>-12.0</td>
<td>29.842105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-02-28</td>
<td>-11.0</td>
<td>7.300000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-03-31</td>
<td>-50.0</td>
<td>7.300000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-04-30</td>
<td>53.0</td>
<td>13.461538</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-05-31</td>
<td>-8.0</td>
<td>-27.769231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-06-30</td>
<td>123.0</td>
<td>75.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31</td>
<td>164.0</td>
<td>-3.476190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-08-31</td>
<td>54.0</td>
<td>-3.476190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-09-30</td>
<td>-79.0</td>
<td>131.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-10-31</td>
<td>-254.0</td>
<td>20.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-11-30</td>
<td>-121.0</td>
<td>-38.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-12-31</td>
<td>-90.0</td>
<td>-66.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-01-31</td>
<td>3.0</td>
<td>23.333333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-02-29</td>
<td>22.0</td>
<td>23.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-31</td>
<td>-1.0</td>
<td>-5.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-04-30</td>
<td>4.0</td>
<td>29.842105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-05-31</td>
<td>-58.0</td>
<td>29.842105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-30</td>
<td>66.0</td>
<td>29.842105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-07-31</td>
<td>-74.0</td>
<td>29.842105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-08-31</td>
<td>0.0</td>
<td>13.461538</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-09-30</td>
<td>94.0</td>
<td>-3.476190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-10-31</td>
<td>-41.0</td>
<td>-5.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-11-30</td>
<td>-38.0</td>
<td>-3.476190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-12-31</td>
<td>-48.0</td>
<td>-71.833333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-01-31</td>
<td>-9.0</td>
<td>-38.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-02-28</td>
<td>-30.0</td>
<td>29.842105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-03-31</td>
<td>24.0</td>
<td>13.461538</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-04-30</td>
<td>-12.0</td>
<td>75.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-05-31</td>
<td>33.0</td>
<td>15.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-06-30</td>
<td>82.0</td>
<td>-37.250000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-07-31</td>
<td>-132.0</td>
<td>-3.476190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-08-31</td>
<td>-68.0</td>
<td>29.842105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-09-30</td>
<td>39.0</td>
<td>-71.833333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-10-31</td>
<td>164.0</td>
<td>-42.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-11-30</td>
<td>-7.0</td>
<td>-37.375000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-12-31</td>
<td>159.0</td>
<td>-71.833333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-31</td>
<td>239.0</td>
<td>-84.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-02-28</td>
<td>-71.0</td>
<td>-3.476190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-03-31</td>
<td>17.0</td>
<td>-3.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-04-30</td>
<td>-88.0</td>
<td>-3.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-05-31</td>
<td>7.0</td>
<td>-19.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-06-30</td>
<td>39.0</td>
<td>13.461538</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="co">#gráfico</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb102-3"><a href="#cb102-3"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb102-5"><a href="#cb102-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb102-7"><a href="#cb102-7"></a>plt.legend()</span>
<span id="cb102-8"><a href="#cb102-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportacionesdoceRetardos_files/figure-html/cell-55-output-1.png" width="809" height="485"></p>
</div>
</div>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Volver arriba</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb103" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb103-1"><a href="#cb103-1"></a><span class="co">---</span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="an">title:</span><span class="co"> "Predicción 1 paso adelante usando 12 retardos"</span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co">---</span></span>
<span id="cb103-7"><a href="#cb103-7"></a></span>
<span id="cb103-8"><a href="#cb103-8"></a>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. $<span class="sc">\{</span>X_t<span class="sc">\}</span>$</span>
<span id="cb103-9"><a href="#cb103-9"></a></span>
<span id="cb103-12"><a href="#cb103-12"></a><span class="in">```{python}</span></span>
<span id="cb103-13"><a href="#cb103-13"></a><span class="co"># get working directory</span></span>
<span id="cb103-14"><a href="#cb103-14"></a><span class="im">import</span> os</span>
<span id="cb103-15"><a href="#cb103-15"></a>os.getcwd()</span>
<span id="cb103-16"><a href="#cb103-16"></a><span class="in">```</span></span>
<span id="cb103-17"><a href="#cb103-17"></a></span>
<span id="cb103-20"><a href="#cb103-20"></a><span class="in">```{python}</span></span>
<span id="cb103-21"><a href="#cb103-21"></a><span class="co"># librerias</span></span>
<span id="cb103-22"><a href="#cb103-22"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb103-23"><a href="#cb103-23"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb103-24"><a href="#cb103-24"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb103-25"><a href="#cb103-25"></a><span class="im">import</span> sklearn</span>
<span id="cb103-26"><a href="#cb103-26"></a><span class="im">import</span> openpyxl</span>
<span id="cb103-27"><a href="#cb103-27"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb103-28"><a href="#cb103-28"></a><span class="im">import</span> warnings</span>
<span id="cb103-29"><a href="#cb103-29"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-30"><a href="#cb103-30"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-31"><a href="#cb103-31"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-32"><a href="#cb103-32"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-33"><a href="#cb103-33"></a><span class="in">```</span></span>
<span id="cb103-34"><a href="#cb103-34"></a></span>
<span id="cb103-37"><a href="#cb103-37"></a><span class="in">```{python}</span></span>
<span id="cb103-38"><a href="#cb103-38"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb103-39"><a href="#cb103-39"></a>data <span class="op">=</span> pd.read_excel(<span class="st">"datos/Exportaciones.xlsx"</span>,</span>
<span id="cb103-40"><a href="#cb103-40"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Mes'</span>,<span class="st">'Total'</span>]).iloc[<span class="dv">96</span>:].reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb103-41"><a href="#cb103-41"></a>data[<span class="st">'Total'</span>] <span class="op">=</span> data[<span class="st">'Total'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb103-42"><a href="#cb103-42"></a>data</span>
<span id="cb103-43"><a href="#cb103-43"></a><span class="in">```</span></span>
<span id="cb103-44"><a href="#cb103-44"></a></span>
<span id="cb103-47"><a href="#cb103-47"></a><span class="in">```{python}</span></span>
<span id="cb103-48"><a href="#cb103-48"></a><span class="co"># tipo de datos</span></span>
<span id="cb103-49"><a href="#cb103-49"></a><span class="bu">print</span>(data.info())</span>
<span id="cb103-50"><a href="#cb103-50"></a><span class="in">```</span></span>
<span id="cb103-51"><a href="#cb103-51"></a></span>
<span id="cb103-54"><a href="#cb103-54"></a><span class="in">```{python}</span></span>
<span id="cb103-55"><a href="#cb103-55"></a><span class="co">#mirando los datos</span></span>
<span id="cb103-56"><a href="#cb103-56"></a><span class="co">#objeto ts</span></span>
<span id="cb103-57"><a href="#cb103-57"></a>exportaciones <span class="op">=</span> data[<span class="st">'Total'</span>]</span>
<span id="cb103-58"><a href="#cb103-58"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb103-59"><a href="#cb103-59"></a>plt.plot(exportaciones)</span>
<span id="cb103-60"><a href="#cb103-60"></a><span class="in">```</span></span>
<span id="cb103-61"><a href="#cb103-61"></a></span>
<span id="cb103-64"><a href="#cb103-64"></a><span class="in">```{python}</span></span>
<span id="cb103-65"><a href="#cb103-65"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb103-66"><a href="#cb103-66"></a><span class="in">```</span></span>
<span id="cb103-67"><a href="#cb103-67"></a></span>
<span id="cb103-70"><a href="#cb103-70"></a><span class="in">```{python}</span></span>
<span id="cb103-71"><a href="#cb103-71"></a>data.shape</span>
<span id="cb103-72"><a href="#cb103-72"></a><span class="in">```</span></span>
<span id="cb103-73"><a href="#cb103-73"></a></span>
<span id="cb103-74"><a href="#cb103-74"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb103-75"><a href="#cb103-75"></a></span>
<span id="cb103-76"><a href="#cb103-76"></a><span class="fu">### Creación de los rezagos</span></span>
<span id="cb103-77"><a href="#cb103-77"></a></span>
<span id="cb103-78"><a href="#cb103-78"></a>Debido al análisis previo tomaremos los rezagos de 3 días atrás para poder predecir un paso adelante.</span>
<span id="cb103-79"><a href="#cb103-79"></a></span>
<span id="cb103-82"><a href="#cb103-82"></a><span class="in">```{python}</span></span>
<span id="cb103-83"><a href="#cb103-83"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb103-84"><a href="#cb103-84"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb103-85"><a href="#cb103-85"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb103-86"><a href="#cb103-86"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb103-87"><a href="#cb103-87"></a><span class="bu">print</span>(df1)</span>
<span id="cb103-88"><a href="#cb103-88"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb103-89"><a href="#cb103-89"></a><span class="bu">print</span>(df2)</span>
<span id="cb103-90"><a href="#cb103-90"></a><span class="in">```</span></span>
<span id="cb103-91"><a href="#cb103-91"></a></span>
<span id="cb103-94"><a href="#cb103-94"></a><span class="in">```{python}</span></span>
<span id="cb103-95"><a href="#cb103-95"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb103-96"><a href="#cb103-96"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">282</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb103-97"><a href="#cb103-97"></a><span class="bu">print</span>(indice)</span>
<span id="cb103-98"><a href="#cb103-98"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Total'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb103-99"><a href="#cb103-99"></a><span class="bu">print</span>(originalDatadf)</span>
<span id="cb103-100"><a href="#cb103-100"></a><span class="in">```</span></span>
<span id="cb103-101"><a href="#cb103-101"></a></span>
<span id="cb103-104"><a href="#cb103-104"></a><span class="in">```{python}</span></span>
<span id="cb103-105"><a href="#cb103-105"></a><span class="co"># Rezagos original</span></span>
<span id="cb103-106"><a href="#cb103-106"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb103-107"><a href="#cb103-107"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb103-108"><a href="#cb103-108"></a><span class="bu">print</span>(df1)</span>
<span id="cb103-109"><a href="#cb103-109"></a><span class="in">```</span></span>
<span id="cb103-110"><a href="#cb103-110"></a></span>
<span id="cb103-113"><a href="#cb103-113"></a><span class="in">```{python}</span></span>
<span id="cb103-114"><a href="#cb103-114"></a><span class="co"># Create column t original</span></span>
<span id="cb103-115"><a href="#cb103-115"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb103-116"><a href="#cb103-116"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span>
<span id="cb103-117"><a href="#cb103-117"></a><span class="in">```</span></span>
<span id="cb103-118"><a href="#cb103-118"></a></span>
<span id="cb103-121"><a href="#cb103-121"></a><span class="in">```{python}</span></span>
<span id="cb103-122"><a href="#cb103-122"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb103-123"><a href="#cb103-123"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">12</span>:]</span>
<span id="cb103-124"><a href="#cb103-124"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb103-125"><a href="#cb103-125"></a>df1_Ori.size</span>
<span id="cb103-126"><a href="#cb103-126"></a><span class="in">```</span></span>
<span id="cb103-127"><a href="#cb103-127"></a></span>
<span id="cb103-130"><a href="#cb103-130"></a><span class="in">```{python}</span></span>
<span id="cb103-131"><a href="#cb103-131"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb103-132"><a href="#cb103-132"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb103-133"><a href="#cb103-133"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb103-134"><a href="#cb103-134"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb103-135"><a href="#cb103-135"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb103-136"><a href="#cb103-136"></a><span class="bu">print</span>(X1)</span>
<span id="cb103-137"><a href="#cb103-137"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span>
<span id="cb103-138"><a href="#cb103-138"></a><span class="in">```</span></span>
<span id="cb103-139"><a href="#cb103-139"></a></span>
<span id="cb103-140"><a href="#cb103-140"></a><span class="fu"># Árbol para Serie Original</span></span>
<span id="cb103-141"><a href="#cb103-141"></a></span>
<span id="cb103-142"><a href="#cb103-142"></a><span class="fu">#### Entrenamiento, Validación y prueba</span></span>
<span id="cb103-143"><a href="#cb103-143"></a></span>
<span id="cb103-146"><a href="#cb103-146"></a><span class="in">```{python}</span></span>
<span id="cb103-147"><a href="#cb103-147"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb103-148"><a href="#cb103-148"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb103-149"><a href="#cb103-149"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb103-150"><a href="#cb103-150"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb103-151"><a href="#cb103-151"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb103-152"><a href="#cb103-152"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb103-153"><a href="#cb103-153"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb103-154"><a href="#cb103-154"></a><span class="in">```</span></span>
<span id="cb103-155"><a href="#cb103-155"></a></span>
<span id="cb103-158"><a href="#cb103-158"></a><span class="in">```{python}</span></span>
<span id="cb103-159"><a href="#cb103-159"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb103-160"><a href="#cb103-160"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb103-161"><a href="#cb103-161"></a></span>
<span id="cb103-162"><a href="#cb103-162"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb103-163"><a href="#cb103-163"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb103-164"><a href="#cb103-164"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb103-165"><a href="#cb103-165"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb103-166"><a href="#cb103-166"></a><span class="in">```</span></span>
<span id="cb103-167"><a href="#cb103-167"></a></span>
<span id="cb103-170"><a href="#cb103-170"></a><span class="in">```{python}</span></span>
<span id="cb103-171"><a href="#cb103-171"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb103-172"><a href="#cb103-172"></a></span>
<span id="cb103-173"><a href="#cb103-173"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb103-174"><a href="#cb103-174"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb103-175"><a href="#cb103-175"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb103-176"><a href="#cb103-176"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb103-177"><a href="#cb103-177"></a></span>
<span id="cb103-178"><a href="#cb103-178"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb103-179"><a href="#cb103-179"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb103-180"><a href="#cb103-180"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb103-181"><a href="#cb103-181"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb103-182"><a href="#cb103-182"></a><span class="in">```</span></span>
<span id="cb103-183"><a href="#cb103-183"></a></span>
<span id="cb103-184"><a href="#cb103-184"></a><span class="fu">### Árbol</span></span>
<span id="cb103-185"><a href="#cb103-185"></a></span>
<span id="cb103-188"><a href="#cb103-188"></a><span class="in">```{python}</span></span>
<span id="cb103-189"><a href="#cb103-189"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb103-190"><a href="#cb103-190"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb103-191"><a href="#cb103-191"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb103-192"><a href="#cb103-192"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb103-193"><a href="#cb103-193"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb103-194"><a href="#cb103-194"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb103-195"><a href="#cb103-195"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb103-196"><a href="#cb103-196"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb103-197"><a href="#cb103-197"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb103-198"><a href="#cb103-198"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb103-199"><a href="#cb103-199"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb103-200"><a href="#cb103-200"></a><span class="in">```</span></span>
<span id="cb103-201"><a href="#cb103-201"></a></span>
<span id="cb103-202"><a href="#cb103-202"></a>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</span>
<span id="cb103-203"><a href="#cb103-203"></a></span>
<span id="cb103-206"><a href="#cb103-206"></a><span class="in">```{python}</span></span>
<span id="cb103-207"><a href="#cb103-207"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb103-208"><a href="#cb103-208"></a></span>
<span id="cb103-209"><a href="#cb103-209"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb103-210"><a href="#cb103-210"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb103-211"><a href="#cb103-211"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb103-212"><a href="#cb103-212"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb103-213"><a href="#cb103-213"></a></span>
<span id="cb103-214"><a href="#cb103-214"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb103-215"><a href="#cb103-215"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb103-216"><a href="#cb103-216"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb103-217"><a href="#cb103-217"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb103-218"><a href="#cb103-218"></a>    </span>
<span id="cb103-219"><a href="#cb103-219"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb103-220"><a href="#cb103-220"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb103-221"><a href="#cb103-221"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb103-222"><a href="#cb103-222"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb103-223"><a href="#cb103-223"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb103-224"><a href="#cb103-224"></a><span class="in">```</span></span>
<span id="cb103-225"><a href="#cb103-225"></a></span>
<span id="cb103-226"><a href="#cb103-226"></a>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</span>
<span id="cb103-227"><a href="#cb103-227"></a></span>
<span id="cb103-230"><a href="#cb103-230"></a><span class="in">```{python}</span></span>
<span id="cb103-231"><a href="#cb103-231"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb103-232"><a href="#cb103-232"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb103-233"><a href="#cb103-233"></a><span class="co">#######</span></span>
<span id="cb103-234"><a href="#cb103-234"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb103-235"><a href="#cb103-235"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb103-236"><a href="#cb103-236"></a><span class="co">####</span></span>
<span id="cb103-237"><a href="#cb103-237"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb103-238"><a href="#cb103-238"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb103-239"><a href="#cb103-239"></a><span class="co">#####</span></span>
<span id="cb103-240"><a href="#cb103-240"></a><span class="co">####</span></span>
<span id="cb103-241"><a href="#cb103-241"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb103-242"><a href="#cb103-242"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb103-243"><a href="#cb103-243"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb103-244"><a href="#cb103-244"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb103-245"><a href="#cb103-245"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb103-246"><a href="#cb103-246"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb103-247"><a href="#cb103-247"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb103-248"><a href="#cb103-248"></a><span class="in">```</span></span>
<span id="cb103-249"><a href="#cb103-249"></a></span>
<span id="cb103-252"><a href="#cb103-252"></a><span class="in">```{python}</span></span>
<span id="cb103-253"><a href="#cb103-253"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb103-254"><a href="#cb103-254"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb103-255"><a href="#cb103-255"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb103-256"><a href="#cb103-256"></a></span>
<span id="cb103-257"><a href="#cb103-257"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb103-258"><a href="#cb103-258"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb103-259"><a href="#cb103-259"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb103-260"><a href="#cb103-260"></a></span>
<span id="cb103-261"><a href="#cb103-261"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb103-262"><a href="#cb103-262"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb103-263"><a href="#cb103-263"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb103-264"><a href="#cb103-264"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb103-265"><a href="#cb103-265"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb103-266"><a href="#cb103-266"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb103-267"><a href="#cb103-267"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb103-268"><a href="#cb103-268"></a>plt.legend()</span>
<span id="cb103-269"><a href="#cb103-269"></a>plt.show()</span>
<span id="cb103-270"><a href="#cb103-270"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb103-271"><a href="#cb103-271"></a></span>
<span id="cb103-272"><a href="#cb103-272"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb103-273"><a href="#cb103-273"></a><span class="in">```</span></span>
<span id="cb103-274"><a href="#cb103-274"></a></span>
<span id="cb103-277"><a href="#cb103-277"></a><span class="in">```{python}</span></span>
<span id="cb103-278"><a href="#cb103-278"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb103-279"><a href="#cb103-279"></a></span>
<span id="cb103-280"><a href="#cb103-280"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb103-281"><a href="#cb103-281"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb103-282"><a href="#cb103-282"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb103-283"><a href="#cb103-283"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb103-284"><a href="#cb103-284"></a><span class="in">```</span></span>
<span id="cb103-285"><a href="#cb103-285"></a></span>
<span id="cb103-288"><a href="#cb103-288"></a><span class="in">```{python}</span></span>
<span id="cb103-289"><a href="#cb103-289"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb103-290"><a href="#cb103-290"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb103-291"><a href="#cb103-291"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb103-292"><a href="#cb103-292"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb103-293"><a href="#cb103-293"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb103-294"><a href="#cb103-294"></a><span class="in">```</span></span>
<span id="cb103-295"><a href="#cb103-295"></a></span>
<span id="cb103-296"><a href="#cb103-296"></a>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</span>
<span id="cb103-297"><a href="#cb103-297"></a></span>
<span id="cb103-300"><a href="#cb103-300"></a><span class="in">```{python}</span></span>
<span id="cb103-301"><a href="#cb103-301"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb103-302"><a href="#cb103-302"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb103-303"><a href="#cb103-303"></a></span>
<span id="cb103-304"><a href="#cb103-304"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb103-305"><a href="#cb103-305"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb103-306"><a href="#cb103-306"></a><span class="in">```</span></span>
<span id="cb103-307"><a href="#cb103-307"></a></span>
<span id="cb103-310"><a href="#cb103-310"></a><span class="in">```{python}</span></span>
<span id="cb103-311"><a href="#cb103-311"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb103-312"><a href="#cb103-312"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb103-313"><a href="#cb103-313"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">225</span>]</span>
<span id="cb103-314"><a href="#cb103-314"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">225</span>:<span class="dv">280</span>]</span>
<span id="cb103-315"><a href="#cb103-315"></a><span class="in">```</span></span>
<span id="cb103-316"><a href="#cb103-316"></a></span>
<span id="cb103-319"><a href="#cb103-319"></a><span class="in">```{python}</span></span>
<span id="cb103-320"><a href="#cb103-320"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb103-321"><a href="#cb103-321"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb103-322"><a href="#cb103-322"></a><span class="in">```</span></span>
<span id="cb103-323"><a href="#cb103-323"></a></span>
<span id="cb103-326"><a href="#cb103-326"></a><span class="in">```{python}</span></span>
<span id="cb103-327"><a href="#cb103-327"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb103-328"><a href="#cb103-328"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb103-329"><a href="#cb103-329"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb103-330"><a href="#cb103-330"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb103-331"><a href="#cb103-331"></a><span class="in">```</span></span>
<span id="cb103-332"><a href="#cb103-332"></a></span>
<span id="cb103-335"><a href="#cb103-335"></a><span class="in">```{python}</span></span>
<span id="cb103-336"><a href="#cb103-336"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb103-337"><a href="#cb103-337"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb103-338"><a href="#cb103-338"></a>ObsvsPred1.head(<span class="dv">10</span>)</span>
<span id="cb103-339"><a href="#cb103-339"></a><span class="in">```</span></span>
<span id="cb103-340"><a href="#cb103-340"></a></span>
<span id="cb103-343"><a href="#cb103-343"></a><span class="in">```{python}</span></span>
<span id="cb103-344"><a href="#cb103-344"></a><span class="co">#gráfico</span></span>
<span id="cb103-345"><a href="#cb103-345"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb103-346"><a href="#cb103-346"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb103-347"><a href="#cb103-347"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb103-348"><a href="#cb103-348"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb103-349"><a href="#cb103-349"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb103-350"><a href="#cb103-350"></a>plt.legend()</span>
<span id="cb103-351"><a href="#cb103-351"></a>plt.show()</span>
<span id="cb103-352"><a href="#cb103-352"></a><span class="in">```</span></span>
<span id="cb103-353"><a href="#cb103-353"></a></span>
<span id="cb103-354"><a href="#cb103-354"></a><span class="fu"># Serie de Exportaciones sin Tendencia</span></span>
<span id="cb103-355"><a href="#cb103-355"></a></span>
<span id="cb103-356"><a href="#cb103-356"></a>Implementaremos ahora el modelo de árboles sobre la serie sin tendencia, eliminada usando la estimación dada por medio del filtro de promedios móviles. Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. $<span class="sc">\{</span>X_t<span class="sc">\}</span>$</span>
<span id="cb103-357"><a href="#cb103-357"></a></span>
<span id="cb103-360"><a href="#cb103-360"></a><span class="in">```{python}</span></span>
<span id="cb103-361"><a href="#cb103-361"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb103-362"><a href="#cb103-362"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"ExportacionesSinTendencia.xlsx"</span>,</span>
<span id="cb103-363"><a href="#cb103-363"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'ExportacionesSinTend'</span>]).reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb103-364"><a href="#cb103-364"></a>data2[<span class="st">'ExportacionesSinTend'</span>] <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb103-365"><a href="#cb103-365"></a>data2</span>
<span id="cb103-366"><a href="#cb103-366"></a><span class="in">```</span></span>
<span id="cb103-367"><a href="#cb103-367"></a></span>
<span id="cb103-370"><a href="#cb103-370"></a><span class="in">```{python}</span></span>
<span id="cb103-371"><a href="#cb103-371"></a><span class="co"># tipo de datos</span></span>
<span id="cb103-372"><a href="#cb103-372"></a><span class="bu">print</span>(data2.info())</span>
<span id="cb103-373"><a href="#cb103-373"></a><span class="in">```</span></span>
<span id="cb103-374"><a href="#cb103-374"></a></span>
<span id="cb103-377"><a href="#cb103-377"></a><span class="in">```{python}</span></span>
<span id="cb103-378"><a href="#cb103-378"></a><span class="co">#mirando los datos</span></span>
<span id="cb103-379"><a href="#cb103-379"></a><span class="co">#objeto ts</span></span>
<span id="cb103-380"><a href="#cb103-380"></a>exportaciones <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>]</span>
<span id="cb103-381"><a href="#cb103-381"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb103-382"><a href="#cb103-382"></a>plt.plot(exportaciones)</span>
<span id="cb103-383"><a href="#cb103-383"></a><span class="in">```</span></span>
<span id="cb103-384"><a href="#cb103-384"></a></span>
<span id="cb103-387"><a href="#cb103-387"></a><span class="in">```{python}</span></span>
<span id="cb103-388"><a href="#cb103-388"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb103-389"><a href="#cb103-389"></a><span class="in">```</span></span>
<span id="cb103-390"><a href="#cb103-390"></a></span>
<span id="cb103-393"><a href="#cb103-393"></a><span class="in">```{python}</span></span>
<span id="cb103-394"><a href="#cb103-394"></a>data2.shape</span>
<span id="cb103-395"><a href="#cb103-395"></a><span class="in">```</span></span>
<span id="cb103-396"><a href="#cb103-396"></a></span>
<span id="cb103-397"><a href="#cb103-397"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb103-398"><a href="#cb103-398"></a></span>
<span id="cb103-399"><a href="#cb103-399"></a><span class="fu">### Creación de los rezagos</span></span>
<span id="cb103-400"><a href="#cb103-400"></a></span>
<span id="cb103-401"><a href="#cb103-401"></a>Tomaremos los rezagos de 12 meses atrás para poder predecir un paso adelante.</span>
<span id="cb103-402"><a href="#cb103-402"></a></span>
<span id="cb103-405"><a href="#cb103-405"></a><span class="in">```{python}</span></span>
<span id="cb103-406"><a href="#cb103-406"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb103-407"><a href="#cb103-407"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb103-408"><a href="#cb103-408"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb103-409"><a href="#cb103-409"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb103-410"><a href="#cb103-410"></a><span class="bu">print</span>(df1)</span>
<span id="cb103-411"><a href="#cb103-411"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb103-412"><a href="#cb103-412"></a><span class="bu">print</span>(df2)</span>
<span id="cb103-413"><a href="#cb103-413"></a><span class="in">```</span></span>
<span id="cb103-414"><a href="#cb103-414"></a></span>
<span id="cb103-417"><a href="#cb103-417"></a><span class="in">```{python}</span></span>
<span id="cb103-418"><a href="#cb103-418"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb103-419"><a href="#cb103-419"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/7/2000'</span>, periods<span class="op">=</span><span class="dv">270</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb103-420"><a href="#cb103-420"></a><span class="bu">print</span>(indice)</span>
<span id="cb103-421"><a href="#cb103-421"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data2[<span class="st">'ExportacionesSinTend'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb103-422"><a href="#cb103-422"></a><span class="bu">print</span>(originalDatadf)</span>
<span id="cb103-423"><a href="#cb103-423"></a><span class="in">```</span></span>
<span id="cb103-424"><a href="#cb103-424"></a></span>
<span id="cb103-427"><a href="#cb103-427"></a><span class="in">```{python}</span></span>
<span id="cb103-428"><a href="#cb103-428"></a><span class="co"># Rezagos original</span></span>
<span id="cb103-429"><a href="#cb103-429"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb103-430"><a href="#cb103-430"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb103-431"><a href="#cb103-431"></a><span class="bu">print</span>(df1)</span>
<span id="cb103-432"><a href="#cb103-432"></a><span class="in">```</span></span>
<span id="cb103-433"><a href="#cb103-433"></a></span>
<span id="cb103-436"><a href="#cb103-436"></a><span class="in">```{python}</span></span>
<span id="cb103-437"><a href="#cb103-437"></a><span class="co"># Create column t original</span></span>
<span id="cb103-438"><a href="#cb103-438"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb103-439"><a href="#cb103-439"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span>
<span id="cb103-440"><a href="#cb103-440"></a><span class="in">```</span></span>
<span id="cb103-441"><a href="#cb103-441"></a></span>
<span id="cb103-444"><a href="#cb103-444"></a><span class="in">```{python}</span></span>
<span id="cb103-445"><a href="#cb103-445"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb103-446"><a href="#cb103-446"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">12</span>:]</span>
<span id="cb103-447"><a href="#cb103-447"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb103-448"><a href="#cb103-448"></a>df1_Ori.size</span>
<span id="cb103-449"><a href="#cb103-449"></a><span class="in">```</span></span>
<span id="cb103-450"><a href="#cb103-450"></a></span>
<span id="cb103-453"><a href="#cb103-453"></a><span class="in">```{python}</span></span>
<span id="cb103-454"><a href="#cb103-454"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb103-455"><a href="#cb103-455"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb103-456"><a href="#cb103-456"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb103-457"><a href="#cb103-457"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb103-458"><a href="#cb103-458"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb103-459"><a href="#cb103-459"></a><span class="bu">print</span>(X1)</span>
<span id="cb103-460"><a href="#cb103-460"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span>
<span id="cb103-461"><a href="#cb103-461"></a><span class="in">```</span></span>
<span id="cb103-462"><a href="#cb103-462"></a></span>
<span id="cb103-463"><a href="#cb103-463"></a><span class="fu"># Árbol para Serie Sin Tendencia</span></span>
<span id="cb103-464"><a href="#cb103-464"></a></span>
<span id="cb103-465"><a href="#cb103-465"></a><span class="fu">#### Entrenamiento, Validación y prueba</span></span>
<span id="cb103-466"><a href="#cb103-466"></a></span>
<span id="cb103-469"><a href="#cb103-469"></a><span class="in">```{python}</span></span>
<span id="cb103-470"><a href="#cb103-470"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb103-471"><a href="#cb103-471"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb103-472"><a href="#cb103-472"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb103-473"><a href="#cb103-473"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb103-474"><a href="#cb103-474"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb103-475"><a href="#cb103-475"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb103-476"><a href="#cb103-476"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb103-477"><a href="#cb103-477"></a><span class="in">```</span></span>
<span id="cb103-478"><a href="#cb103-478"></a></span>
<span id="cb103-481"><a href="#cb103-481"></a><span class="in">```{python}</span></span>
<span id="cb103-482"><a href="#cb103-482"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb103-483"><a href="#cb103-483"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb103-484"><a href="#cb103-484"></a></span>
<span id="cb103-485"><a href="#cb103-485"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb103-486"><a href="#cb103-486"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb103-487"><a href="#cb103-487"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb103-488"><a href="#cb103-488"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb103-489"><a href="#cb103-489"></a><span class="in">```</span></span>
<span id="cb103-490"><a href="#cb103-490"></a></span>
<span id="cb103-493"><a href="#cb103-493"></a><span class="in">```{python}</span></span>
<span id="cb103-494"><a href="#cb103-494"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb103-495"><a href="#cb103-495"></a></span>
<span id="cb103-496"><a href="#cb103-496"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb103-497"><a href="#cb103-497"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb103-498"><a href="#cb103-498"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb103-499"><a href="#cb103-499"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb103-500"><a href="#cb103-500"></a></span>
<span id="cb103-501"><a href="#cb103-501"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb103-502"><a href="#cb103-502"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb103-503"><a href="#cb103-503"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb103-504"><a href="#cb103-504"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb103-505"><a href="#cb103-505"></a><span class="in">```</span></span>
<span id="cb103-506"><a href="#cb103-506"></a></span>
<span id="cb103-507"><a href="#cb103-507"></a><span class="fu">### Árbol</span></span>
<span id="cb103-508"><a href="#cb103-508"></a></span>
<span id="cb103-511"><a href="#cb103-511"></a><span class="in">```{python}</span></span>
<span id="cb103-512"><a href="#cb103-512"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb103-513"><a href="#cb103-513"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb103-514"><a href="#cb103-514"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb103-515"><a href="#cb103-515"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb103-516"><a href="#cb103-516"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb103-517"><a href="#cb103-517"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb103-518"><a href="#cb103-518"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb103-519"><a href="#cb103-519"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb103-520"><a href="#cb103-520"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb103-521"><a href="#cb103-521"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb103-522"><a href="#cb103-522"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb103-523"><a href="#cb103-523"></a><span class="in">```</span></span>
<span id="cb103-524"><a href="#cb103-524"></a></span>
<span id="cb103-525"><a href="#cb103-525"></a>Vemos que el R2 para los datos de validación es malo pues es negativo, Se relizará un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</span>
<span id="cb103-526"><a href="#cb103-526"></a></span>
<span id="cb103-529"><a href="#cb103-529"></a><span class="in">```{python}</span></span>
<span id="cb103-530"><a href="#cb103-530"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb103-531"><a href="#cb103-531"></a></span>
<span id="cb103-532"><a href="#cb103-532"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb103-533"><a href="#cb103-533"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb103-534"><a href="#cb103-534"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb103-535"><a href="#cb103-535"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb103-536"><a href="#cb103-536"></a></span>
<span id="cb103-537"><a href="#cb103-537"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb103-538"><a href="#cb103-538"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb103-539"><a href="#cb103-539"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb103-540"><a href="#cb103-540"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb103-541"><a href="#cb103-541"></a>    </span>
<span id="cb103-542"><a href="#cb103-542"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb103-543"><a href="#cb103-543"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb103-544"><a href="#cb103-544"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb103-545"><a href="#cb103-545"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb103-546"><a href="#cb103-546"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb103-547"><a href="#cb103-547"></a><span class="in">```</span></span>
<span id="cb103-548"><a href="#cb103-548"></a></span>
<span id="cb103-549"><a href="#cb103-549"></a>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Tomaremos el más cercano a cero que el el de la profundidad 6. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</span>
<span id="cb103-550"><a href="#cb103-550"></a></span>
<span id="cb103-553"><a href="#cb103-553"></a><span class="in">```{python}</span></span>
<span id="cb103-554"><a href="#cb103-554"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb103-555"><a href="#cb103-555"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb103-556"><a href="#cb103-556"></a><span class="co">#######</span></span>
<span id="cb103-557"><a href="#cb103-557"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb103-558"><a href="#cb103-558"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb103-559"><a href="#cb103-559"></a><span class="co">####</span></span>
<span id="cb103-560"><a href="#cb103-560"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb103-561"><a href="#cb103-561"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb103-562"><a href="#cb103-562"></a><span class="co">#####</span></span>
<span id="cb103-563"><a href="#cb103-563"></a><span class="co">####</span></span>
<span id="cb103-564"><a href="#cb103-564"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb103-565"><a href="#cb103-565"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb103-566"><a href="#cb103-566"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb103-567"><a href="#cb103-567"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb103-568"><a href="#cb103-568"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb103-569"><a href="#cb103-569"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb103-570"><a href="#cb103-570"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb103-571"><a href="#cb103-571"></a><span class="in">```</span></span>
<span id="cb103-572"><a href="#cb103-572"></a></span>
<span id="cb103-575"><a href="#cb103-575"></a><span class="in">```{python}</span></span>
<span id="cb103-576"><a href="#cb103-576"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb103-577"><a href="#cb103-577"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">6</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb103-578"><a href="#cb103-578"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb103-579"><a href="#cb103-579"></a></span>
<span id="cb103-580"><a href="#cb103-580"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb103-581"><a href="#cb103-581"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb103-582"><a href="#cb103-582"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb103-583"><a href="#cb103-583"></a></span>
<span id="cb103-584"><a href="#cb103-584"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb103-585"><a href="#cb103-585"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb103-586"><a href="#cb103-586"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb103-587"><a href="#cb103-587"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb103-588"><a href="#cb103-588"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb103-589"><a href="#cb103-589"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb103-590"><a href="#cb103-590"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb103-591"><a href="#cb103-591"></a>plt.legend()</span>
<span id="cb103-592"><a href="#cb103-592"></a>plt.show()</span>
<span id="cb103-593"><a href="#cb103-593"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb103-594"><a href="#cb103-594"></a></span>
<span id="cb103-595"><a href="#cb103-595"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb103-596"><a href="#cb103-596"></a><span class="in">```</span></span>
<span id="cb103-597"><a href="#cb103-597"></a></span>
<span id="cb103-600"><a href="#cb103-600"></a><span class="in">```{python}</span></span>
<span id="cb103-601"><a href="#cb103-601"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb103-602"><a href="#cb103-602"></a></span>
<span id="cb103-603"><a href="#cb103-603"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb103-604"><a href="#cb103-604"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb103-605"><a href="#cb103-605"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb103-606"><a href="#cb103-606"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb103-607"><a href="#cb103-607"></a><span class="in">```</span></span>
<span id="cb103-608"><a href="#cb103-608"></a></span>
<span id="cb103-611"><a href="#cb103-611"></a><span class="in">```{python}</span></span>
<span id="cb103-612"><a href="#cb103-612"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb103-613"><a href="#cb103-613"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb103-614"><a href="#cb103-614"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb103-615"><a href="#cb103-615"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb103-616"><a href="#cb103-616"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb103-617"><a href="#cb103-617"></a><span class="in">```</span></span>
<span id="cb103-618"><a href="#cb103-618"></a></span>
<span id="cb103-619"><a href="#cb103-619"></a>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</span>
<span id="cb103-620"><a href="#cb103-620"></a></span>
<span id="cb103-623"><a href="#cb103-623"></a><span class="in">```{python}</span></span>
<span id="cb103-624"><a href="#cb103-624"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb103-625"><a href="#cb103-625"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb103-626"><a href="#cb103-626"></a></span>
<span id="cb103-627"><a href="#cb103-627"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb103-628"><a href="#cb103-628"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb103-629"><a href="#cb103-629"></a><span class="in">```</span></span>
<span id="cb103-630"><a href="#cb103-630"></a></span>
<span id="cb103-633"><a href="#cb103-633"></a><span class="in">```{python}</span></span>
<span id="cb103-634"><a href="#cb103-634"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb103-635"><a href="#cb103-635"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb103-636"><a href="#cb103-636"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">206</span>]</span>
<span id="cb103-637"><a href="#cb103-637"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">206</span>:<span class="dv">258</span>]</span>
<span id="cb103-638"><a href="#cb103-638"></a><span class="in">```</span></span>
<span id="cb103-639"><a href="#cb103-639"></a></span>
<span id="cb103-642"><a href="#cb103-642"></a><span class="in">```{python}</span></span>
<span id="cb103-643"><a href="#cb103-643"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb103-644"><a href="#cb103-644"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb103-645"><a href="#cb103-645"></a><span class="in">```</span></span>
<span id="cb103-646"><a href="#cb103-646"></a></span>
<span id="cb103-649"><a href="#cb103-649"></a><span class="in">```{python}</span></span>
<span id="cb103-650"><a href="#cb103-650"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb103-651"><a href="#cb103-651"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb103-652"><a href="#cb103-652"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb103-653"><a href="#cb103-653"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb103-654"><a href="#cb103-654"></a><span class="in">```</span></span>
<span id="cb103-655"><a href="#cb103-655"></a></span>
<span id="cb103-658"><a href="#cb103-658"></a><span class="in">```{python}</span></span>
<span id="cb103-659"><a href="#cb103-659"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb103-660"><a href="#cb103-660"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb103-661"><a href="#cb103-661"></a>ObsvsPred1.tail(<span class="dv">52</span>)</span>
<span id="cb103-662"><a href="#cb103-662"></a><span class="in">```</span></span>
<span id="cb103-663"><a href="#cb103-663"></a></span>
<span id="cb103-666"><a href="#cb103-666"></a><span class="in">```{python}</span></span>
<span id="cb103-667"><a href="#cb103-667"></a><span class="co">#gráfico</span></span>
<span id="cb103-668"><a href="#cb103-668"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb103-669"><a href="#cb103-669"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb103-670"><a href="#cb103-670"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb103-671"><a href="#cb103-671"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb103-672"><a href="#cb103-672"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb103-673"><a href="#cb103-673"></a>plt.legend()</span>
<span id="cb103-674"><a href="#cb103-674"></a>plt.show()</span>
<span id="cb103-675"><a href="#cb103-675"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>