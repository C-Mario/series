<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Series de Tiempo - Predicción 1 paso adelante usando 2 retardos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ninguna coincidencia",
    "search-matching-documents-text": "coincidencias",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": ""
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series de Tiempo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-análisis-descriptivo" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Análisis Descriptivo</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-análisis-descriptivo">    
        <li>
    <a class="dropdown-item" href="./DExportaciones.html" rel="" target="">
 <span class="dropdown-text">Exportaciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DBitcoin.html" rel="" target="">
 <span class="dropdown-text">Bitcoin</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-exportaciones">    
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportacionesdoceRetardos.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportaciones.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-exportaciones">    
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_12.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_2.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-bitcoin">    
        <li>
    <a class="dropdown-item" href="./Arboles_Des_series.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-bitcoin">    
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_bayesiano.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (bayesiano)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_grilla.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (grilla)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/C-Mario/series" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">GitHub</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
  <li><a href="#pacf" id="toc-pacf" class="nav-link active" data-scroll-target="#pacf"><span class="header-section-number">0.1</span> PACF</a></li>
  <li><a href="#árboles-de-decisión" id="toc-árboles-de-decisión" class="nav-link" data-scroll-target="#árboles-de-decisión"><span class="header-section-number">1</span> Árboles de decisión</a>
  <ul class="collapse">
  <li><a href="#creación-de-los-rezagos" id="toc-creación-de-los-rezagos" class="nav-link" data-scroll-target="#creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</a></li>
  </ul></li>
  <li><a href="#árbol-para-serie-original" id="toc-árbol-para-serie-original" class="nav-link" data-scroll-target="#árbol-para-serie-original"><span class="header-section-number">2</span> Árbol para Serie Original</a>
  <ul class="collapse">
  <li><a href="#árbol" id="toc-árbol" class="nav-link" data-scroll-target="#árbol"><span class="header-section-number">2.0.1</span> Árbol</a></li>
  </ul></li>
  <li><a href="#serie-de-exportaciones-sin-tendencia" id="toc-serie-de-exportaciones-sin-tendencia" class="nav-link" data-scroll-target="#serie-de-exportaciones-sin-tendencia"><span class="header-section-number">3</span> Serie de Exportaciones sin Tendencia</a>
  <ul class="collapse">
  <li><a href="#pacf-1" id="toc-pacf-1" class="nav-link" data-scroll-target="#pacf-1"><span class="header-section-number">3.1</span> PACF</a></li>
  </ul></li>
  <li><a href="#árboles-de-decisión-1" id="toc-árboles-de-decisión-1" class="nav-link" data-scroll-target="#árboles-de-decisión-1"><span class="header-section-number">4</span> Árboles de decisión</a>
  <ul class="collapse">
  <li><a href="#creación-de-los-rezagos-1" id="toc-creación-de-los-rezagos-1" class="nav-link" data-scroll-target="#creación-de-los-rezagos-1"><span class="header-section-number">4.0.1</span> Creación de los rezagos</a></li>
  </ul></li>
  <li><a href="#árbol-para-serie-sin-tendencia" id="toc-árbol-para-serie-sin-tendencia" class="nav-link" data-scroll-target="#árbol-para-serie-sin-tendencia"><span class="header-section-number">5</span> Árbol para Serie Sin Tendencia</a>
  <ul class="collapse">
  <li><a href="#árbol-1" id="toc-árbol-1" class="nav-link" data-scroll-target="#árbol-1"><span class="header-section-number">5.0.1</span> Árbol</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Predicción 1 paso adelante usando 2 retardos</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. <span class="math inline">\(\{X_t\}\)</span></p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># get working directory</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3"></a>os.getcwd()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'C:\\Users\\dofca\\Desktop\\series'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># librerias</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">import</span> sklearn</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">import</span> openpyxl</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">import</span> warnings</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Matplotlib Version: 1.25.2
Pandas Version: 2.0.3
Numpy Version: 1.25.2
Sklearn: 1.3.1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>data <span class="op">=</span> pd.read_excel(<span class="st">"datos/Exportaciones.xlsx"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Mes'</span>,<span class="st">'Total'</span>]).iloc[<span class="dv">96</span>:].reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a>data[<span class="st">'Total'</span>] <span class="op">=</span> data[<span class="st">'Total'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb5-5"><a href="#cb5-5"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mes</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000-01-01</td>
<td>1011676</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000-02-01</td>
<td>1054098</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000-03-01</td>
<td>1053546</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000-04-01</td>
<td>886359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000-05-01</td>
<td>1146258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">277</td>
<td>2023-02-01</td>
<td>4202234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">278</td>
<td>2023-03-01</td>
<td>4431911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">279</td>
<td>2023-04-01</td>
<td>3739214</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">280</td>
<td>2023-05-01</td>
<td>4497862</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">281</td>
<td>2023-06-01</td>
<td>3985981</td>
</tr>
</tbody>
</table>

<p>282 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="bu">print</span>(data.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 282 entries, 0 to 281
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype         
---  ------  --------------  -----         
 0   Mes     282 non-null    datetime64[ns]
 1   Total   282 non-null    int32         
dtypes: datetime64[ns](1), int32(1)
memory usage: 3.4 KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#mirando los datos</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#objeto ts</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>exportaciones <span class="op">=</span> data[<span class="st">'Total'</span>]</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb8-5"><a href="#cb8-5"></a>plt.plot(exportaciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-6-output-2.png" width="558" height="425"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(282, 2)</code></pre>
</div>
</div>
<section id="pacf" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="pacf"><span class="header-section-number">0.1</span> PACF</h2>
<p>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb14-3"><a href="#cb14-3"></a>plot_pacf(exportaciones,lags<span class="op">=</span><span class="dv">140</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>pyplot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-9-output-1.png" width="590" height="431"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb15-2"><a href="#cb15-2"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(exportaciones, nlags<span class="op">=</span><span class="dv">140</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>T <span class="op">=</span> <span class="bu">len</span>(exportaciones)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>pacf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>array([ 1.00000000e+00,  9.59093603e-01,  2.97306056e-01,  1.17473996e-01,
       -7.03116609e-02,  3.26288216e-02, -6.03088214e-02,  1.13079878e-01,
       -1.13945940e-01, -2.33175139e-02, -1.11985646e-01,  2.02110227e-02,
        1.97278486e-02, -1.61423863e-01, -1.73791666e-02, -2.59991629e-02,
        2.41560086e-04,  7.51378723e-02, -2.72384453e-02,  7.60706013e-02,
       -2.47900629e-02,  8.49355502e-02,  3.74581253e-03, -1.43352938e-02,
        1.70410088e-02, -5.48238243e-02,  6.18273478e-02, -2.33524022e-02,
        4.74134619e-02,  1.08676085e-01, -8.12916663e-02, -1.67238998e-02,
       -3.96609731e-02, -1.05509554e-02,  5.15184774e-02, -4.09772449e-02,
        8.88414578e-02, -1.42772584e-01,  4.04045194e-02, -7.10728718e-02,
        6.10028381e-02, -9.75167769e-02, -4.70334839e-02,  8.36344066e-02,
       -6.77084813e-02, -3.56866811e-02,  4.65635129e-02,  6.27645281e-02,
        4.39629333e-02, -7.92100171e-02, -8.88109850e-02,  7.12681174e-02,
       -3.21905999e-02,  4.85459580e-02,  6.50733823e-03,  2.13679789e-02,
       -9.51162538e-02,  9.82890285e-03,  1.33457048e-02, -6.80490500e-03,
       -3.46524136e-02, -7.92901439e-02,  2.19653527e-02,  4.03653681e-02,
       -4.80582281e-03, -3.71454463e-02, -3.98280807e-02, -1.23770212e-01,
        2.30426145e-02,  2.40775563e-02,  2.36460653e-02,  3.65899044e-02,
        6.89818169e-02, -4.65605372e-02, -9.87423014e-02, -1.44166098e-02,
       -3.74822317e-02,  1.14862473e-01, -1.62496570e-03,  4.79499922e-03,
        1.21842509e-02,  4.07497124e-02, -4.06867111e-02, -4.16711832e-02,
        3.49704696e-02, -9.46634772e-03, -5.98154753e-02, -9.68932715e-03,
        4.16318031e-02,  3.05359681e-02,  5.76540164e-03,  3.41372435e-02,
       -3.61253646e-02,  2.07301731e-02, -4.34001846e-03,  1.87940224e-02,
       -5.97117781e-02,  3.06439973e-03, -4.93934874e-02,  1.06724162e-02,
        1.20967188e-03,  5.28574452e-02,  2.65553192e-02,  8.33244420e-04,
       -3.98366077e-02, -1.20608182e-02, -5.61664842e-02, -4.74597336e-02,
       -2.63848485e-02,  3.65173396e-03, -4.37024075e-02,  1.02159583e-01,
       -1.92846099e-02,  9.42032935e-03,  5.17064189e-02, -4.24857437e-02,
        7.57797502e-02,  3.32127608e-02, -3.92237359e-02, -1.64670791e-03,
       -1.41737394e-02,  1.55365471e-02, -7.03132739e-02, -1.44528291e-02,
        5.83931996e-03, -7.49281785e-02, -1.00802917e-02, -2.71361284e-02,
        1.70813154e-02, -7.28848521e-02,  3.34594698e-02,  5.60933395e-03,
       -1.26753457e-02, -2.48107506e-02,  1.84242234e-02,  4.94408804e-02,
       -1.08315454e-02, -4.22730382e-03,  1.63697862e-03, -5.47095096e-02,
        1.97184305e-02])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb18-2"><a href="#cb18-2"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb18-3"><a href="#cb18-3"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb18-5"><a href="#cb18-5"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n_steps set to 2</code></pre>
</div>
</div>
<p>Observamos que con el <strong>pacf</strong> se nos recomienda usar dos retardos, lo cuál nos recueda que cuando se quizo establecer una componente estacional se sugeria un periodo de 2.4, por lo tanto teniendo encuenta lo anterior usaremos <strong>2 retrasos</strong> para la serie original</p>
</section>
<section id="árboles-de-decisión" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Árboles de decisión</h1>
<section id="creación-de-los-rezagos" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1" class="anchored" data-anchor-id="creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</h3>
<p>Debido al análisis previo tomaremos los rezagos de 2 días atrás para poder predecir un paso adelante.</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="bu">print</span>(df1)</span>
<span id="cb20-6"><a href="#cb20-6"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: []
Index: []
Empty DataFrame
Columns: []
Index: []</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">282</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="bu">print</span>(indice)</span>
<span id="cb22-4"><a href="#cb22-4"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Total'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="bu">print</span>(originalDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-30',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-30', '2000-10-31',
               ...
               '2022-09-30', '2022-10-31', '2022-11-30', '2022-12-31',
               '2023-01-31', '2023-02-28', '2023-03-31', '2023-04-30',
               '2023-05-31', '2023-06-30'],
              dtype='datetime64[ns]', length=282, freq='M')
                  0
2000-01-31  1011676
2000-02-29  1054098
2000-03-31  1053546
2000-04-30   886359
2000-05-31  1146258
...             ...
2023-02-28  4202234
2023-03-31  4431911
2023-04-30  3739214
2023-05-31  4497862
2023-06-30  3985981

[282 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Rezagos original</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb24-3"><a href="#cb24-3"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="bu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  t-2        t-1
2000-01-31        NaN        NaN
2000-02-29        NaN  1011676.0
2000-03-31  1011676.0  1054098.0
2000-04-30  1054098.0  1053546.0
2000-05-31  1053546.0   886359.0
...               ...        ...
2023-02-28  4642084.0  3696188.0
2023-03-31  3696188.0  4202234.0
2023-04-30  4202234.0  4431911.0
2023-05-31  4431911.0  3739214.0
2023-06-30  3739214.0  4497862.0

[282 rows x 2 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Create column t original</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  t-2        t-1        t
2000-01-31        NaN        NaN  1011676
2000-02-29        NaN  1011676.0  1054098
2000-03-31  1011676.0  1054098.0  1053546
2000-04-30  1054098.0  1053546.0   886359
2000-05-31  1053546.0   886359.0  1146258
2000-06-30   886359.0  1146258.0  1153956
2000-07-31  1146258.0  1153956.0  1104408
2000-08-31  1153956.0  1104408.0  1242391
2000-09-30  1104408.0  1242391.0  1102913
2000-10-31  1242391.0  1102913.0   981716
2000-11-30  1102913.0   981716.0  1192681
2000-12-31   981716.0  1192681.0  1228398
2001-01-31  1192681.0  1228398.0  1017195
2001-02-28  1228398.0  1017195.0   964437</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">2</span>:]</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb28-4"><a href="#cb28-4"></a>df1_Ori.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  t-2        t-1        t
2000-03-31  1011676.0  1054098.0  1053546
2000-04-30  1054098.0  1053546.0   886359
2000-05-31  1053546.0   886359.0  1146258
2000-06-30   886359.0  1146258.0  1153956
2000-07-31  1146258.0  1153956.0  1104408
...               ...        ...      ...
2023-02-28  4642084.0  3696188.0  4202234
2023-03-31  3696188.0  4202234.0  4431911
2023-04-30  4202234.0  4431911.0  3739214
2023-05-31  4431911.0  3739214.0  4497862
2023-06-30  3739214.0  4497862.0  3985981

[280 rows x 3 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>840</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="bu">print</span>(X1)</span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1011676. 1054098.]
 [1054098. 1053546.]
 [1053546.  886359.]
 [ 886359. 1146258.]
 [1146258. 1153956.]
 [1153956. 1104408.]
 [1104408. 1242391.]
 [1242391. 1102913.]
 [1102913.  981716.]
 [ 981716. 1192681.]
 [1192681. 1228398.]
 [1228398. 1017195.]
 [1017195.  964437.]
 [ 964437. 1002450.]
 [1002450. 1058457.]
 [1058457. 1068023.]
 [1068023.  996736.]
 [ 996736. 1005867.]
 [1005867. 1189605.]
 [1189605. 1078781.]
 [1078781. 1013772.]
 [1013772.  965973.]
 [ 965973.  968599.]
 [ 968599.  943702.]
 [ 943702.  945935.]
 [ 945935.  859303.]
 [ 859303. 1123902.]
 [1123902. 1076509.]
 [1076509.  921463.]
 [ 921463. 1040876.]
 [1040876.  915457.]
 [ 915457. 1055414.]
 [1055414. 1070342.]
 [1070342.  966897.]
 [ 966897. 1055590.]
 [1055590.  923427.]
 [ 923427. 1033043.]
 [1033043. 1034233.]
 [1034233. 1101056.]
 [1101056. 1181888.]
 [1181888.  995297.]
 [ 995297. 1267598.]
 [1267598. 1092850.]
 [1092850. 1079472.]
 [1079472. 1169195.]
 [1169195. 1082836.]
 [1082836. 1167628.]
 [1167628. 1183399.]
 [1183399. 1031826.]
 [1031826. 1206657.]
 [1206657. 1271618.]
 [1271618. 1335727.]
 [1335727. 1433647.]
 [1433647. 1541103.]
 [1541103. 1516523.]
 [1516523. 1519458.]
 [1519458. 1529291.]
 [1529291. 1585709.]
 [1585709. 1633370.]
 [1633370. 1378980.]
 [1378980. 1529265.]
 [1529265. 1722081.]
 [1722081. 1682450.]
 [1682450. 1737198.]
 [1737198. 2097853.]
 [2097853. 1653833.]
 [1653833. 1882740.]
 [1882740. 1908016.]
 [1908016. 1788905.]
 [1788905. 1826199.]
 [1826199. 1938567.]
 [1938567. 1668171.]
 [1668171. 1862024.]
 [1862024. 1929864.]
 [1929864. 1872161.]
 [1872161. 2211681.]
 [2211681. 2039364.]
 [2039364. 2141958.]
 [2141958. 2129881.]
 [2129881. 2104243.]
 [2104243. 2271572.]
 [2271572. 2146547.]
 [2146547. 2134504.]
 [2134504. 1843668.]
 [1843668. 1914770.]
 [1914770. 2384657.]
 [2384657. 2497750.]
 [2497750. 2727980.]
 [2727980. 2114259.]
 [2114259. 2648147.]
 [2648147. 2621002.]
 [2621002. 2523170.]
 [2523170. 2623649.]
 [2623649. 3152653.]
 [3152653. 3227536.]
 [3227536. 2842306.]
 [2842306. 2822470.]
 [2822470. 3007288.]
 [3007288. 3365420.]
 [3365420. 3392615.]
 [3392615. 3675654.]
 [3675654. 3801685.]
 [3801685. 3294187.]
 [3294187. 3133994.]
 [3133994. 2981105.]
 [2981105. 2245379.]
 [2245379. 2224271.]
 [2224271. 2525698.]
 [2525698. 2340118.]
 [2340118. 2711332.]
 [2711332. 2427571.]
 [2427571. 2742519.]
 [2742519. 2738083.]
 [2738083. 2898600.]
 [2898600. 2673470.]
 [2673470. 2795983.]
 [2795983. 2948687.]
 [2948687. 2861294.]
 [2861294. 3182972.]
 [3182972. 2913433.]
 [2913433. 2869156.]
 [2869156. 3337903.]
 [3337903. 3490978.]
 [3490978. 3513331.]
 [3513331. 3060628.]
 [3060628. 3157626.]
 [3157626. 3291236.]
 [3291236. 3271661.]
 [3271661. 3535759.]
 [3535759. 3426095.]
 [3426095. 3845531.]
 [3845531. 3760176.]
 [3760176. 3958572.]
 [3958572. 4893312.]
 [4893312. 4823094.]
 [4823094. 5153710.]
 [5153710. 4708737.]
 [4708737. 4866229.]
 [4866229. 4941645.]
 [4941645. 4582401.]
 [4582401. 4772996.]
 [4772996. 5147330.]
 [5147330. 5306738.]
 [5306738. 4785773.]
 [4785773. 4999318.]
 [4999318. 5712355.]
 [5712355. 5010929.]
 [5010929. 5403375.]
 [5403375. 4563431.]
 [4563431. 4976905.]
 [4976905. 4570780.]
 [4570780. 4910403.]
 [4910403. 5432930.]
 [5432930. 4807338.]
 [4807338. 4951628.]
 [4951628. 4849196.]
 [4849196. 4667767.]
 [4667767. 4617842.]
 [4617842. 4949487.]
 [4949487. 5332470.]
 [5332470. 4870839.]
 [4870839. 4652297.]
 [4652297. 4977706.]
 [4977706. 4849996.]
 [4849996. 4837983.]
 [4837983. 4948665.]
 [4948665. 5272122.]
 [5272122. 4808832.]
 [4808832. 4271442.]
 [4271442. 4408181.]
 [4408181. 4316676.]
 [4316676. 5495867.]
 [5495867. 4704814.]
 [4704814. 5048930.]
 [5048930. 4813091.]
 [4813091. 5077247.]
 [5077247. 4322278.]
 [4322278. 3794686.]
 [3794686. 3794711.]
 [3794711. 2916976.]
 [2916976. 3160957.]
 [3160957. 3461944.]
 [3461944. 3219706.]
 [3219706. 3381084.]
 [3381084. 3217408.]
 [3217408. 3043778.]
 [3043778. 2868451.]
 [2868451. 2898168.]
 [2898168. 2815522.]
 [2815522. 2444535.]
 [2444535. 2588994.]
 [2588994. 1919053.]
 [1919053. 2328723.]
 [2328723. 2334998.]
 [2334998. 2463793.]
 [2463793. 2751470.]
 [2751470. 2780512.]
 [2780512. 2266997.]
 [2266997. 3044377.]
 [3044377. 2797686.]
 [2797686. 2770014.]
 [2770014. 2833622.]
 [2833622. 3477094.]
 [3477094. 2785044.]
 [2785044. 2716024.]
 [2716024. 3300421.]
 [3300421. 2697992.]
 [2697992. 3505436.]
 [3505436. 2895612.]
 [2895612. 3125483.]
 [3125483. 3191598.]
 [3191598. 3389679.]
 [3389679. 3277516.]
 [3277516. 3122237.]
 [3122237. 4014818.]
 [4014818. 3324889.]
 [3324889. 3027603.]
 [3027603. 3365116.]
 [3365116. 3786537.]
 [3786537. 3719410.]
 [3719410. 3331933.]
 [3331933. 3632055.]
 [3632055. 3684399.]
 [3684399. 3512842.]
 [3512842. 3768666.]
 [3768666. 3343509.]
 [3343509. 3407819.]
 [3407819. 3066110.]
 [3066110. 3183071.]
 [3183071. 3344850.]
 [3344850. 3862819.]
 [3862819. 3748342.]
 [3748342. 3096363.]
 [3096363. 3255830.]
 [3255830. 3264261.]
 [3264261. 3067349.]
 [3067349. 3326497.]
 [3326497. 2943625.]
 [2943625. 3330051.]
 [3330051. 3419466.]
 [3419466. 2943626.]
 [2943626. 2439036.]
 [2439036. 1864239.]
 [1864239. 2221172.]
 [2221172. 2289482.]
 [2289482. 2551988.]
 [2551988. 2584767.]
 [2584767. 2544874.]
 [2544874. 2644954.]
 [2644954. 2523372.]
 [2523372. 3028837.]
 [3028837. 2610936.]
 [2610936. 2938994.]
 [2938994. 3383554.]
 [3383554. 2976372.]
 [2976372. 3096913.]
 [3096913. 3182216.]
 [3182216. 3444158.]
 [3444158. 3465143.]
 [3465143. 3792236.]
 [3792236. 3799111.]
 [3799111. 4155805.]
 [4155805. 4544551.]
 [4544551. 3801609.]
 [3801609. 4209198.]
 [4209198. 4780210.]
 [4780210. 5460531.]
 [5460531. 4662521.]
 [4662521. 5497617.]
 [5497617. 5913682.]
 [5913682. 4388737.]
 [4388737. 4778520.]
 [4778520. 4213182.]
 [4213182. 4562248.]
 [4562248. 4642084.]
 [4642084. 3696188.]
 [3696188. 4202234.]
 [4202234. 4431911.]
 [4431911. 3739214.]
 [3739214. 4497862.]]
Respuestas 
 [1053546.  886359. 1146258. 1153956. 1104408. 1242391. 1102913.  981716.
 1192681. 1228398. 1017195.  964437. 1002450. 1058457. 1068023.  996736.
 1005867. 1189605. 1078781. 1013772.  965973.  968599.  943702.  945935.
  859303. 1123902. 1076509.  921463. 1040876.  915457. 1055414. 1070342.
  966897. 1055590.  923427. 1033043. 1034233. 1101056. 1181888.  995297.
 1267598. 1092850. 1079472. 1169195. 1082836. 1167628. 1183399. 1031826.
 1206657. 1271618. 1335727. 1433647. 1541103. 1516523. 1519458. 1529291.
 1585709. 1633370. 1378980. 1529265. 1722081. 1682450. 1737198. 2097853.
 1653833. 1882740. 1908016. 1788905. 1826199. 1938567. 1668171. 1862024.
 1929864. 1872161. 2211681. 2039364. 2141958. 2129881. 2104243. 2271572.
 2146547. 2134504. 1843668. 1914770. 2384657. 2497750. 2727980. 2114259.
 2648147. 2621002. 2523170. 2623649. 3152653. 3227536. 2842306. 2822470.
 3007288. 3365420. 3392615. 3675654. 3801685. 3294187. 3133994. 2981105.
 2245379. 2224271. 2525698. 2340118. 2711332. 2427571. 2742519. 2738083.
 2898600. 2673470. 2795983. 2948687. 2861294. 3182972. 2913433. 2869156.
 3337903. 3490978. 3513331. 3060628. 3157626. 3291236. 3271661. 3535759.
 3426095. 3845531. 3760176. 3958572. 4893312. 4823094. 5153710. 4708737.
 4866229. 4941645. 4582401. 4772996. 5147330. 5306738. 4785773. 4999318.
 5712355. 5010929. 5403375. 4563431. 4976905. 4570780. 4910403. 5432930.
 4807338. 4951628. 4849196. 4667767. 4617842. 4949487. 5332470. 4870839.
 4652297. 4977706. 4849996. 4837983. 4948665. 5272122. 4808832. 4271442.
 4408181. 4316676. 5495867. 4704814. 5048930. 4813091. 5077247. 4322278.
 3794686. 3794711. 2916976. 3160957. 3461944. 3219706. 3381084. 3217408.
 3043778. 2868451. 2898168. 2815522. 2444535. 2588994. 1919053. 2328723.
 2334998. 2463793. 2751470. 2780512. 2266997. 3044377. 2797686. 2770014.
 2833622. 3477094. 2785044. 2716024. 3300421. 2697992. 3505436. 2895612.
 3125483. 3191598. 3389679. 3277516. 3122237. 4014818. 3324889. 3027603.
 3365116. 3786537. 3719410. 3331933. 3632055. 3684399. 3512842. 3768666.
 3343509. 3407819. 3066110. 3183071. 3344850. 3862819. 3748342. 3096363.
 3255830. 3264261. 3067349. 3326497. 2943625. 3330051. 3419466. 2943626.
 2439036. 1864239. 2221172. 2289482. 2551988. 2584767. 2544874. 2644954.
 2523372. 3028837. 2610936. 2938994. 3383554. 2976372. 3096913. 3182216.
 3444158. 3465143. 3792236. 3799111. 4155805. 4544551. 3801609. 4209198.
 4780210. 5460531. 4662521. 5497617. 5913682. 4388737. 4778520. 4213182.
 4562248. 4642084. 3696188. 4202234. 4431911. 3739214. 4497862. 3985981.]</code></pre>
</div>
</div>
</section>
</section>
<section id="árbol-para-serie-original" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Árbol para Serie Original</h1>
<section id="entrenamiento-validación-y-prueba" class="level4" data-number="2.0.0.1">
<h4 data-number="2.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba"><span class="header-section-number">2.0.0.1</span> Entrenamiento, Validación y prueba</h4>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb33-3"><a href="#cb33-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb33-4"><a href="#cb33-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 280
196 29 56
Train + Validation + Test: 281</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 280
Training Observations for Target: 196
Validation Observations for Target: 29
Test Observations for Target: 55</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb37-4"><a href="#cb37-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 280
Training Observations for Feature: 196
Validation Observations for Feature: 29
Test Observations for Feature: 55</code></pre>
</div>
</div>
</section>
<section id="árbol" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="árbol"><span class="header-section-number">2.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de Validación: -0.9957468394345483
el RECM sobre validación es: 314021133770.5517</code></pre>
</div>
</div>
<p>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</p>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb41-9"><a href="#cb41-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb41-11"><a href="#cb41-11"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb41-12"><a href="#cb41-12"></a>    </span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb41-15"><a href="#cb41-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb41-16"><a href="#cb41-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9448886702102718
Coeficiente R2 sobre el conjunto de validación: -1.088017789994565 

el RECM sobre el conjunto de validación es: 573183.6726079404
max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9692432238418371
Coeficiente R2 sobre el conjunto de validación: -0.8422460453834877 

el RECM sobre el conjunto de validación es: 538394.3950459106
max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9783266474186452
Coeficiente R2 sobre el conjunto de validación: -0.5669014414580396 

el RECM sobre el conjunto de validación es: 496532.35543516674
max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9842654186860248
Coeficiente R2 sobre el conjunto de validación: -0.8380486254917823 

el RECM sobre el conjunto de validación es: 537780.6995918642
max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9897832765928137
Coeficiente R2 sobre el conjunto de validación: -0.9542318718699783 

el RECM sobre el conjunto de validación es: 554516.8653650281
max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9937044281888229
Coeficiente R2 sobre el conjunto de validación: -0.8843688632366069 

el RECM sobre el conjunto de validación es: 544514.7809955052
max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9965163518047335
Coeficiente R2 sobre el conjunto de validación: -1.0173859465570052 

el RECM sobre el conjunto de validación es: 563405.6645496098
max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.997736780045468
Coeficiente R2 sobre el conjunto de validación: -0.958310123886982 

el RECM sobre el conjunto de validación es: 555095.1695408727
max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9991593867209211
Coeficiente R2 sobre el conjunto de validación: -1.1076259140640996 

el RECM sobre el conjunto de validación es: 575868.7057293948
max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9997209884655672
Coeficiente R2 sobre el conjunto de validación: -0.9499196090238338 

el RECM sobre el conjunto de validación es: 553904.721252913
max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9998998175749997
Coeficiente R2 sobre el conjunto de validación: -1.0445150478674257 

el RECM sobre el conjunto de validación es: 567181.2549913402
max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999707138251954
Coeficiente R2 sobre el conjunto de validación: -0.9704446621528584 

el RECM sobre el conjunto de validación es: 556812.3187240271
max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9999969265889176
Coeficiente R2 sobre el conjunto de validación: -0.9506669786796578 

el RECM sobre el conjunto de validación es: 554010.8620188123
max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de validación: -0.9300433322924266 

el RECM sobre el conjunto de validación es: 551074.4087733494</code></pre>
</div>
</div>
<p>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co">#######</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="co">####</span></span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb43-9"><a href="#cb43-9"></a><span class="co">#####</span></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="co">####</span></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb43-12"><a href="#cb43-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb43-14"><a href="#cb43-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb43-15"><a href="#cb43-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb43-16"><a href="#cb43-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb43-17"><a href="#cb43-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(196, 2)
(29, 2)
(196,)
(29,)
(225, 2)
(225,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb45-2"><a href="#cb45-2"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb45-7"><a href="#cb45-7"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb45-8"><a href="#cb45-8"></a></span>
<span id="cb45-9"><a href="#cb45-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb45-10"><a href="#cb45-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb45-11"><a href="#cb45-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb45-12"><a href="#cb45-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb45-13"><a href="#cb45-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb45-14"><a href="#cb45-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb45-15"><a href="#cb45-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb45-16"><a href="#cb45-16"></a>plt.legend()</span>
<span id="cb45-17"><a href="#cb45-17"></a>plt.show()</span>
<span id="cb45-18"><a href="#cb45-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb45-19"><a href="#cb45-19"></a></span>
<span id="cb45-20"><a href="#cb45-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-25-output-1.png" width="576" height="443"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 249566.97518562482
Raíz de la Pérdida cuadrática Prueba: 552220.6310930281</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb47-4"><a href="#cb47-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb47-5"><a href="#cb47-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_1 &lt;= 2622325.50
|   |--- feature_1 &lt;= 1643601.50
|   |   |--- feature_1 &lt;= 1269608.00
|   |   |   |--- feature_1 &lt;= 1079126.50
|   |   |   |   |--- value: [1031537.35]
|   |   |   |--- feature_1 &gt;  1079126.50
|   |   |   |   |--- value: [1118014.53]
|   |   |--- feature_1 &gt;  1269608.00
|   |   |   |--- feature_0 &lt;= 1303672.50
|   |   |   |   |--- value: [1384687.00]
|   |   |   |--- feature_0 &gt;  1303672.50
|   |   |   |   |--- value: [1550642.22]
|   |--- feature_1 &gt;  1643601.50
|   |   |--- feature_0 &lt;= 2217976.00
|   |   |   |--- feature_1 &lt;= 2300147.50
|   |   |   |   |--- value: [1958100.96]
|   |   |   |--- feature_1 &gt;  2300147.50
|   |   |   |   |--- value: [2416374.00]
|   |   |--- feature_0 &gt;  2217976.00
|   |   |   |--- feature_1 &lt;= 2524434.00
|   |   |   |   |--- value: [2578112.08]
|   |   |   |--- feature_1 &gt;  2524434.00
|   |   |   |   |--- value: [2260780.33]
|--- feature_1 &gt;  2622325.50
|   |--- feature_1 &lt;= 3902051.50
|   |   |--- feature_1 &lt;= 3052502.50
|   |   |   |--- feature_0 &lt;= 2760742.00
|   |   |   |   |--- value: [2674501.82]
|   |   |   |--- feature_0 &gt;  2760742.00
|   |   |   |   |--- value: [2989486.73]
|   |   |--- feature_1 &gt;  3052502.50
|   |   |   |--- feature_0 &lt;= 2865225.00
|   |   |   |   |--- value: [2903923.40]
|   |   |   |--- feature_0 &gt;  2865225.00
|   |   |   |   |--- value: [3417219.18]
|   |--- feature_1 &gt;  3902051.50
|   |   |--- feature_0 &lt;= 3441206.50
|   |   |   |--- value: [3324889.00]
|   |   |--- feature_0 &gt;  3441206.50
|   |   |   |--- feature_0 &lt;= 4796555.50
|   |   |   |   |--- value: [5019372.33]
|   |   |   |--- feature_0 &gt;  4796555.50
|   |   |   |   |--- value: [4797306.20]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb49-2"><a href="#cb49-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb49-3"><a href="#cb49-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb49-4"><a href="#cb49-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb49-5"><a href="#cb49-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-27-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</p>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb50-3"><a href="#cb50-3"></a></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>225
225
55
55</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">225</span>]</span>
<span id="cb52-4"><a href="#cb52-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">225</span>:<span class="dv">280</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>280</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>225
55</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb56-2"><a href="#cb56-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>280
280</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb58-2"><a href="#cb58-2"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb58-3"><a href="#cb58-3"></a>ObsvsPred1.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-03-31</td>
<td>1053546.0</td>
<td>1.031537e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-04-30</td>
<td>886359.0</td>
<td>1.031537e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-05-31</td>
<td>1146258.0</td>
<td>1.031537e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-06-30</td>
<td>1153956.0</td>
<td>1.118015e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-07-31</td>
<td>1104408.0</td>
<td>1.118015e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-08-31</td>
<td>1242391.0</td>
<td>1.118015e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-09-30</td>
<td>1102913.0</td>
<td>1.118015e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-10-31</td>
<td>981716.0</td>
<td>1.118015e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-11-30</td>
<td>1192681.0</td>
<td>1.031537e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-12-31</td>
<td>1228398.0</td>
<td>1.118015e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">#gráfico</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb59-5"><a href="#cb59-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb59-7"><a href="#cb59-7"></a>plt.legend()</span>
<span id="cb59-8"><a href="#cb59-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-33-output-1.png" width="781" height="499"></p>
</div>
</div>
</section>
</section>
<section id="serie-de-exportaciones-sin-tendencia" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Serie de Exportaciones sin Tendencia</h1>
<p>Implementaremos ahora el modelo de árboles sobre la serie sin tendencia, eliminada usando la estimación dada por medio del filtro de promedios móviles. Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. <span class="math inline">\(\{X_t\}\)</span></p>
<div class="cell" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"ExportacionesSinTendencia.xlsx"</span>,</span>
<span id="cb60-3"><a href="#cb60-3"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'ExportacionesSinTend'</span>]).reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb60-4"><a href="#cb60-4"></a>data2[<span class="st">'ExportacionesSinTend'</span>] <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb60-5"><a href="#cb60-5"></a>data2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fecha</th>
<th data-quarto-table-cell-role="th">ExportacionesSinTend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000-07-01</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000-08-01</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000-09-01</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000-10-01</td>
<td>-53</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000-11-01</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">265</td>
<td>2022-08-01</td>
<td>-71</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">266</td>
<td>2022-09-01</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">267</td>
<td>2022-10-01</td>
<td>-88</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">268</td>
<td>2022-11-01</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">269</td>
<td>2022-12-01</td>
<td>39</td>
</tr>
</tbody>
</table>

<p>270 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="bu">print</span>(data2.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 270 entries, 0 to 269
Data columns (total 2 columns):
 #   Column                Non-Null Count  Dtype         
---  ------                --------------  -----         
 0   Fecha                 270 non-null    datetime64[ns]
 1   ExportacionesSinTend  270 non-null    int32         
dtypes: datetime64[ns](1), int32(1)
memory usage: 3.3 KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">#mirando los datos</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="co">#objeto ts</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>exportaciones <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>]</span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb63-5"><a href="#cb63-5"></a>plt.plot(exportaciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-36-output-2.png" width="586" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>data2.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>(270, 2)</code></pre>
</div>
</div>
<section id="pacf-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="pacf-1"><span class="header-section-number">3.1</span> PACF</h2>
<p>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</p>
<div class="cell" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb69-3"><a href="#cb69-3"></a>plot_pacf(exportaciones,lags<span class="op">=</span><span class="dv">134</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb69-4"><a href="#cb69-4"></a>pyplot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-39-output-1.png" width="598" height="431"></p>
</div>
</div>
<div class="cell" data-execution_count="39">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb70-2"><a href="#cb70-2"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(exportaciones, nlags<span class="op">=</span><span class="dv">134</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb70-3"><a href="#cb70-3"></a>T <span class="op">=</span> <span class="bu">len</span>(exportaciones)</span>
<span id="cb70-4"><a href="#cb70-4"></a></span>
<span id="cb70-5"><a href="#cb70-5"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a>pacf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>array([ 1.        ,  0.21355648, -0.01410819, -0.10451617, -0.2093758 ,
       -0.14017377, -0.17906702,  0.09686678, -0.13392601,  0.01595307,
       -0.13946366, -0.0563855 ,  0.17741868, -0.0609385 , -0.00478777,
        0.00611697, -0.09012201,  0.04079611, -0.1288755 ,  0.01040772,
       -0.06054336, -0.00809331,  0.05521414,  0.00145114, -0.06018931,
       -0.05344687, -0.06106559, -0.09355214, -0.04415682,  0.08980262,
       -0.12158518, -0.05246829, -0.08134046, -0.11923296,  0.01961602,
       -0.06611188,  0.14387345, -0.08387056, -0.02154623, -0.03719252,
        0.11636824, -0.03659881, -0.04184158,  0.0773012 , -0.09796869,
       -0.09592436, -0.02679615,  0.03304619,  0.08238835, -0.10051005,
       -0.1233177 ,  0.11816191, -0.10239664, -0.00298642,  0.05553658,
       -0.02902818, -0.07533038, -0.030158  , -0.01596098, -0.0076432 ,
       -0.02810041, -0.11429884,  0.06089394,  0.02933573,  0.09430358,
        0.04947294,  0.0168977 , -0.05976736, -0.00941411, -0.04209226,
       -0.00997868,  0.02671226,  0.05214744,  0.10015063, -0.08725013,
       -0.02096121, -0.07610181,  0.02608155, -0.07163182, -0.01742543,
       -0.01110346,  0.05773641, -0.0426505 , -0.04985717,  0.07024918,
        0.0724035 , -0.02324498, -0.03840519, -0.00384265, -0.03725229,
       -0.01497874,  0.02560091, -0.02994393,  0.01198395, -0.00979288,
        0.0224643 , -0.04398166,  0.01457101,  0.01353388,  0.01837122,
       -0.06478182,  0.05269882, -0.03988886, -0.01561551,  0.00534409,
        0.02551739, -0.07313363,  0.01118899,  0.0051652 , -0.00649134,
       -0.11102337,  0.05241729,  0.02498581, -0.05071817, -0.05116662,
       -0.07926453,  0.00801331, -0.00355665, -0.0184545 ,  0.00602772,
       -0.05354637, -0.00260395,  0.03088632,  0.00947186, -0.02269647,
       -0.03670284,  0.01269883, -0.02970479, -0.00677465, -0.03938635,
       -0.05408061, -0.01603313, -0.00598982, -0.03914117,  0.00226407])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb73-2"><a href="#cb73-2"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb73-3"><a href="#cb73-3"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb73-5"><a href="#cb73-5"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n_steps set to 1</code></pre>
</div>
</div>
<p>Observamos que con el <strong>pacf</strong> se nos recomienda usar un solo retardo, usaremos <strong>1 retraso</strong> para la serie sin Tendencia</p>
</section>
</section>
<section id="árboles-de-decisión-1" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Árboles de decisión</h1>
<section id="creación-de-los-rezagos-1" class="level3" data-number="4.0.1">
<h3 data-number="4.0.1" class="anchored" data-anchor-id="creación-de-los-rezagos-1"><span class="header-section-number">4.0.1</span> Creación de los rezagos</h3>
<p>Debido al análisis previo tomaremos los rezagos de 1 días atrás para poder predecir un paso adelante.</p>
<div class="cell" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="bu">print</span>(df1)</span>
<span id="cb75-6"><a href="#cb75-6"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb75-7"><a href="#cb75-7"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: []
Index: []
Empty DataFrame
Columns: []
Index: []</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/7/2000'</span>, periods<span class="op">=</span><span class="dv">270</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="bu">print</span>(indice)</span>
<span id="cb77-4"><a href="#cb77-4"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data2[<span class="st">'ExportacionesSinTend'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="bu">print</span>(originalDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-30',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-30', '2000-10-31',
               ...
               '2021-09-30', '2021-10-31', '2021-11-30', '2021-12-31',
               '2022-01-31', '2022-02-28', '2022-03-31', '2022-04-30',
               '2022-05-31', '2022-06-30'],
              dtype='datetime64[ns]', length=270, freq='M')
             0
2000-01-31   5
2000-02-29  70
2000-03-31   9
2000-04-30 -53
2000-05-31  46
...         ..
2022-02-28 -71
2022-03-31  17
2022-04-30 -88
2022-05-31   7
2022-06-30  39

[270 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Rezagos original</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb79-3"><a href="#cb79-3"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="bu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              t-1
2000-01-31    NaN
2000-02-29    5.0
2000-03-31   70.0
2000-04-30    9.0
2000-05-31  -53.0
...           ...
2022-02-28  239.0
2022-03-31  -71.0
2022-04-30   17.0
2022-05-31  -88.0
2022-06-30    7.0

[270 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Create column t original</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             t-1   t
2000-01-31   NaN   5
2000-02-29   5.0  70
2000-03-31  70.0   9
2000-04-30   9.0 -53
2000-05-31 -53.0  46
2000-06-30  46.0  67
2000-07-31  67.0 -28
2000-08-31 -28.0 -51
2000-09-30 -51.0 -31
2000-10-31 -31.0  -3
2000-11-30  -3.0   5
2000-12-31   5.0 -20
2001-01-31 -20.0  -9
2001-02-28  -9.0  81</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">1</span>:]</span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb83-4"><a href="#cb83-4"></a>df1_Ori.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              t-1   t
2000-02-29    5.0  70
2000-03-31   70.0   9
2000-04-30    9.0 -53
2000-05-31  -53.0  46
2000-06-30   46.0  67
...           ...  ..
2022-02-28  239.0 -71
2022-03-31  -71.0  17
2022-04-30   17.0 -88
2022-05-31  -88.0   7
2022-06-30    7.0  39

[269 rows x 2 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>538</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb86-4"><a href="#cb86-4"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb86-5"><a href="#cb86-5"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="bu">print</span>(X1)</span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[   5.]
 [  70.]
 [   9.]
 [ -53.]
 [  46.]
 [  67.]
 [ -28.]
 [ -51.]
 [ -31.]
 [  -3.]
 [   5.]
 [ -20.]
 [  -9.]
 [  81.]
 [  32.]
 [   2.]
 [ -23.]
 [ -20.]
 [ -32.]
 [ -26.]
 [ -66.]
 [  67.]
 [  43.]
 [ -37.]
 [  23.]
 [ -42.]
 [  23.]
 [  27.]
 [ -26.]
 [  14.]
 [ -58.]
 [ -11.]
 [ -14.]
 [  15.]
 [  49.]
 [ -45.]
 [  75.]
 [ -10.]
 [ -20.]
 [  16.]
 [ -31.]
 [  -2.]
 [  -8.]
 [ -92.]
 [ -26.]
 [ -11.]
 [   1.]
 [  25.]
 [  57.]
 [  34.]
 [  18.]
 [   6.]
 [  15.]
 [  16.]
 [ -98.]
 [ -44.]
 [  18.]
 [  -7.]
 [   6.]
 [ 124.]
 [ -43.]
 [  31.]
 [  31.]
 [ -17.]
 [ -14.]
 [  20.]
 [ -84.]
 [ -24.]
 [  -6.]
 [ -36.]
 [  67.]
 [   3.]
 [  32.]
 [  24.]
 [   9.]
 [  49.]
 [  -7.]
 [ -19.]
 [-126.]
 [-114.]
 [  29.]
 [  54.]
 [ 105.]
 [-110.]
 [  30.]
 [  -3.]
 [ -52.]
 [ -40.]
 [  91.]
 [  85.]
 [ -51.]
 [ -77.]
 [ -41.]
 [  43.]
 [  56.]
 [ 150.]
 [ 197.]
 [  80.]
 [  47.]
 [  20.]
 [-180.]
 [-169.]
 [ -55.]
 [ -95.]
 [  28.]
 [ -52.]
 [  34.]
 [  13.]
 [  43.]
 [ -33.]
 [ -11.]
 [  12.]
 [ -33.]
 [  42.]
 [ -38.]
 [ -60.]
 [  54.]
 [  81.]
 [  74.]
 [ -57.]
 [ -47.]
 [ -33.]
 [ -65.]
 [ -25.]
 [ -81.]
 [  -9.]
 [ -63.]
 [ -48.]
 [ 130.]
 [  90.]
 [ 131.]
 [   9.]
 [  19.]
 [  16.]
 [ -77.]
 [ -45.]
 [  29.]
 [  61.]
 [ -46.]
 [   1.]
 [ 143.]
 [  -5.]
 [  72.]
 [ -97.]
 [  -6.]
 [ -90.]
 [  -6.]
 [ 110.]
 [ -16.]
 [  12.]
 [  -9.]
 [ -49.]
 [ -63.]
 [  13.]
 [  95.]
 [  -3.]
 [ -52.]
 [  21.]
 [  -1.]
 [   5.]
 [  32.]
 [  98.]
 [   1.]
 [-118.]
 [ -88.]
 [-106.]
 [ 156.]
 [  18.]
 [ 123.]
 [ 104.]
 [ 180.]
 [  38.]
 [ -53.]
 [ -19.]
 [-211.]
 [-106.]
 [  13.]
 [ -12.]
 [  61.]
 [  47.]
 [  27.]
 [   1.]
 [  33.]
 [  31.]
 [ -62.]
 [  -6.]
 [-207.]
 [ -64.]
 [ -63.]
 [ -21.]
 [  60.]
 [  53.]
 [-123.]
 [  89.]
 [   4.]
 [ -18.]
 [ -11.]
 [ 151.]
 [ -47.]
 [ -78.]
 [  73.]
 [-104.]
 [ 104.]
 [ -66.]
 [ -15.]
 [  -7.]
 [  40.]
 [  -1.]
 [ -56.]
 [ 159.]
 [ -20.]
 [-110.]
 [ -27.]
 [  71.]
 [  47.]
 [ -46.]
 [  39.]
 [  53.]
 [   9.]
 [  71.]
 [ -36.]
 [ -17.]
 [-100.]
 [ -61.]
 [  -9.]
 [ 129.]
 [ 110.]
 [ -51.]
 [ -12.]
 [ -11.]
 [ -50.]
 [  53.]
 [  -8.]
 [ 123.]
 [ 164.]
 [  54.]
 [ -79.]
 [-254.]
 [-121.]
 [ -90.]
 [   3.]
 [  22.]
 [  -1.]
 [   4.]
 [ -58.]
 [  66.]
 [ -74.]
 [   0.]
 [  94.]
 [ -41.]
 [ -38.]
 [ -48.]
 [  -9.]
 [ -30.]
 [  24.]
 [ -12.]
 [  33.]
 [  82.]
 [-132.]
 [ -68.]
 [  39.]
 [ 164.]
 [  -7.]
 [ 159.]
 [ 239.]
 [ -71.]
 [  17.]
 [ -88.]
 [   7.]]
Respuestas 
 [  70.    9.  -53.   46.   67.  -28.  -51.  -31.   -3.    5.  -20.   -9.
   81.   32.    2.  -23.  -20.  -32.  -26.  -66.   67.   43.  -37.   23.
  -42.   23.   27.  -26.   14.  -58.  -11.  -14.   15.   49.  -45.   75.
  -10.  -20.   16.  -31.   -2.   -8.  -92.  -26.  -11.    1.   25.   57.
   34.   18.    6.   15.   16.  -98.  -44.   18.   -7.    6.  124.  -43.
   31.   31.  -17.  -14.   20.  -84.  -24.   -6.  -36.   67.    3.   32.
   24.    9.   49.   -7.  -19. -126. -114.   29.   54.  105. -110.   30.
   -3.  -52.  -40.   91.   85.  -51.  -77.  -41.   43.   56.  150.  197.
   80.   47.   20. -180. -169.  -55.  -95.   28.  -52.   34.   13.   43.
  -33.  -11.   12.  -33.   42.  -38.  -60.   54.   81.   74.  -57.  -47.
  -33.  -65.  -25.  -81.   -9.  -63.  -48.  130.   90.  131.    9.   19.
   16.  -77.  -45.   29.   61.  -46.    1.  143.   -5.   72.  -97.   -6.
  -90.   -6.  110.  -16.   12.   -9.  -49.  -63.   13.   95.   -3.  -52.
   21.   -1.    5.   32.   98.    1. -118.  -88. -106.  156.   18.  123.
  104.  180.   38.  -53.  -19. -211. -106.   13.  -12.   61.   47.   27.
    1.   33.   31.  -62.   -6. -207.  -64.  -63.  -21.   60.   53. -123.
   89.    4.  -18.  -11.  151.  -47.  -78.   73. -104.  104.  -66.  -15.
   -7.   40.   -1.  -56.  159.  -20. -110.  -27.   71.   47.  -46.   39.
   53.    9.   71.  -36.  -17. -100.  -61.   -9.  129.  110.  -51.  -12.
  -11.  -50.   53.   -8.  123.  164.   54.  -79. -254. -121.  -90.    3.
   22.   -1.    4.  -58.   66.  -74.    0.   94.  -41.  -38.  -48.   -9.
  -30.   24.  -12.   33.   82. -132.  -68.   39.  164.   -7.  159.  239.
  -71.   17.  -88.    7.   39.]</code></pre>
</div>
</div>
</section>
</section>
<section id="árbol-para-serie-sin-tendencia" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Árbol para Serie Sin Tendencia</h1>
<section id="entrenamiento-validación-y-prueba-1" class="level4" data-number="5.0.0.1">
<h4 data-number="5.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba-1"><span class="header-section-number">5.0.0.1</span> Entrenamiento, Validación y prueba</h4>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb88-3"><a href="#cb88-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb88-4"><a href="#cb88-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb88-5"><a href="#cb88-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb88-6"><a href="#cb88-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb88-7"><a href="#cb88-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 269
188 27 53
Train + Validation + Test: 268</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb90-3"><a href="#cb90-3"></a></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb90-6"><a href="#cb90-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb90-7"><a href="#cb90-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 269
Training Observations for Target: 188
Validation Observations for Target: 27
Test Observations for Target: 54</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb92-2"><a href="#cb92-2"></a></span>
<span id="cb92-3"><a href="#cb92-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb92-4"><a href="#cb92-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb92-5"><a href="#cb92-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb92-6"><a href="#cb92-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb92-7"><a href="#cb92-7"></a></span>
<span id="cb92-8"><a href="#cb92-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb92-10"><a href="#cb92-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb92-11"><a href="#cb92-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 269
Training Observations for Feature: 188
Validation Observations for Feature: 27
Test Observations for Feature: 54</code></pre>
</div>
</div>
</section>
<section id="árbol-1" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="árbol-1"><span class="header-section-number">5.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb94-3"><a href="#cb94-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb94-4"><a href="#cb94-4"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb94-5"><a href="#cb94-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb94-6"><a href="#cb94-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb94-8"><a href="#cb94-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb94-9"><a href="#cb94-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb94-10"><a href="#cb94-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb94-11"><a href="#cb94-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 0.7489453368451344
Coeficiente R2 sobre el conjunto de Validación: -1.6975126396015692
el RECM sobre validación es: 14514.734567901236</code></pre>
</div>
</div>
<p>Vemos que el R2 para los datos de validación es malo pue ses negativo, Se relizará un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</p>
<div class="cell" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb96-2"><a href="#cb96-2"></a></span>
<span id="cb96-3"><a href="#cb96-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb96-4"><a href="#cb96-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb96-5"><a href="#cb96-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb96-6"><a href="#cb96-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb96-7"><a href="#cb96-7"></a></span>
<span id="cb96-8"><a href="#cb96-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb96-9"><a href="#cb96-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb96-10"><a href="#cb96-10"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb96-11"><a href="#cb96-11"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb96-12"><a href="#cb96-12"></a>    </span>
<span id="cb96-13"><a href="#cb96-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb96-14"><a href="#cb96-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb96-15"><a href="#cb96-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb96-16"><a href="#cb96-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb96-17"><a href="#cb96-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.1235723782133541
Coeficiente R2 sobre el conjunto de validación: -0.3518565653927881 

el RECM sobre el conjunto de validación es: 85.28803572483899 

max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.17605731263213797
Coeficiente R2 sobre el conjunto de validación: -0.5522007205922248 

el RECM sobre el conjunto de validación es: 91.38959344536322 

max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.2213907837370045
Coeficiente R2 sobre el conjunto de validación: -0.6015708507158646 

el RECM sobre el conjunto de validación es: 92.83161006779689 

max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.26335361447640315
Coeficiente R2 sobre el conjunto de validación: -0.6704362731673443 

el RECM sobre el conjunto de validación es: 94.80642296222176 

max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.3510852057484962
Coeficiente R2 sobre el conjunto de validación: -1.0537970511704566 

el RECM sobre el conjunto de validación es: 105.12392505706327 

max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.5098952902968319
Coeficiente R2 sobre el conjunto de validación: -1.4143930116841772 

el RECM sobre el conjunto de validación es: 113.97951054340881 

max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.5602092099294106
Coeficiente R2 sobre el conjunto de validación: -1.5015273506147206 

el RECM sobre el conjunto de validación es: 116.01801556630365 

max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.6340809553747333
Coeficiente R2 sobre el conjunto de validación: -1.510892390367292 

el RECM sobre el conjunto de validación es: 116.23498267717775 

max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.6844362884168376
Coeficiente R2 sobre el conjunto de validación: -1.564814168794511 

el RECM sobre el conjunto de validación es: 117.47643455134788 

max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.7117437335946285
Coeficiente R2 sobre el conjunto de validación: -1.6209922785112494 

el RECM sobre el conjunto de validación es: 118.75603136080248 

max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.7270665850780945
Coeficiente R2 sobre el conjunto de validación: -1.5774545090338221 

el RECM sobre el conjunto de validación es: 117.76556212856453 

max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 0.738598682046781
Coeficiente R2 sobre el conjunto de validación: -1.700580552349058 

el RECM sobre el conjunto de validación es: 120.54560276376328 

max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 0.7425124787217315
Coeficiente R2 sobre el conjunto de validación: -1.697798483757678 

el RECM sobre el conjunto de validación es: 120.48349527526523 

max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 0.7487174304671029
Coeficiente R2 sobre el conjunto de validación: -1.6975126396015692 

el RECM sobre el conjunto de validación es: 120.4771122159775 
</code></pre>
</div>
</div>
<p>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Tomaremos el más cercano a cero que el el de la profundidad 2. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</p>
<div class="cell" data-execution_count="53">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="co">#######</span></span>
<span id="cb98-4"><a href="#cb98-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb98-5"><a href="#cb98-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb98-6"><a href="#cb98-6"></a><span class="co">####</span></span>
<span id="cb98-7"><a href="#cb98-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb98-8"><a href="#cb98-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb98-9"><a href="#cb98-9"></a><span class="co">#####</span></span>
<span id="cb98-10"><a href="#cb98-10"></a><span class="co">####</span></span>
<span id="cb98-11"><a href="#cb98-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb98-12"><a href="#cb98-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb98-13"><a href="#cb98-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb98-14"><a href="#cb98-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb98-15"><a href="#cb98-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb98-16"><a href="#cb98-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb98-17"><a href="#cb98-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(188, 1)
(27, 1)
(188,)
(27,)
(215, 1)
(215,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb100-2"><a href="#cb100-2"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">2</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb100-3"><a href="#cb100-3"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb100-4"><a href="#cb100-4"></a></span>
<span id="cb100-5"><a href="#cb100-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb100-6"><a href="#cb100-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb100-7"><a href="#cb100-7"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb100-8"><a href="#cb100-8"></a></span>
<span id="cb100-9"><a href="#cb100-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb100-10"><a href="#cb100-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb100-11"><a href="#cb100-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb100-12"><a href="#cb100-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb100-13"><a href="#cb100-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb100-14"><a href="#cb100-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb100-15"><a href="#cb100-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb100-16"><a href="#cb100-16"></a>plt.legend()</span>
<span id="cb100-17"><a href="#cb100-17"></a>plt.show()</span>
<span id="cb100-18"><a href="#cb100-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb100-19"><a href="#cb100-19"></a></span>
<span id="cb100-20"><a href="#cb100-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-55-output-1.png" width="604" height="429"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 63.56081240941628
Raíz de la Pérdida cuadrática Prueba: 82.96550957878867</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb102-2"><a href="#cb102-2"></a></span>
<span id="cb102-3"><a href="#cb102-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb102-4"><a href="#cb102-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb102-5"><a href="#cb102-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_0 &lt;= -124.50
|   |--- feature_0 &lt;= -174.50
|   |   |--- value: [-113.00]
|   |--- feature_0 &gt;  -174.50
|   |   |--- value: [-84.50]
|--- feature_0 &gt;  -124.50
|   |--- feature_0 &lt;= 53.50
|   |   |--- value: [-2.67]
|   |--- feature_0 &gt;  53.50
|   |   |--- value: [23.98]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb104-2"><a href="#cb104-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb104-3"><a href="#cb104-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb104-4"><a href="#cb104-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb104-5"><a href="#cb104-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-57-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</p>
<div class="cell" data-execution_count="57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb105-3"><a href="#cb105-3"></a></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>215
215
54
54</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">215</span>]</span>
<span id="cb107-4"><a href="#cb107-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">215</span>:<span class="dv">269</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>269</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>215
54</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb111-2"><a href="#cb111-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb111-3"><a href="#cb111-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb111-4"><a href="#cb111-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>269
269</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb113-2"><a href="#cb113-2"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb113-3"><a href="#cb113-3"></a>ObsvsPred1.tail(<span class="dv">54</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-31</td>
<td>39.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-02-28</td>
<td>53.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-03-31</td>
<td>9.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-04-30</td>
<td>71.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-05-31</td>
<td>-36.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-06-30</td>
<td>-17.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-07-31</td>
<td>-100.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-31</td>
<td>-61.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-09-30</td>
<td>-9.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-10-31</td>
<td>129.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-11-30</td>
<td>110.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-12-31</td>
<td>-51.0</td>
<td>23.975000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-31</td>
<td>-12.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-02-28</td>
<td>-11.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-03-31</td>
<td>-50.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-04-30</td>
<td>53.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-05-31</td>
<td>-8.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-06-30</td>
<td>123.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31</td>
<td>164.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-08-31</td>
<td>54.0</td>
<td>23.975000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-09-30</td>
<td>-79.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-10-31</td>
<td>-254.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-11-30</td>
<td>-121.0</td>
<td>-113.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-12-31</td>
<td>-90.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-01-31</td>
<td>3.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-02-29</td>
<td>22.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-31</td>
<td>-1.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-04-30</td>
<td>4.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-05-31</td>
<td>-58.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-30</td>
<td>66.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-07-31</td>
<td>-74.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-08-31</td>
<td>0.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-09-30</td>
<td>94.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-10-31</td>
<td>-41.0</td>
<td>23.975000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-11-30</td>
<td>-38.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-12-31</td>
<td>-48.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-01-31</td>
<td>-9.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-02-28</td>
<td>-30.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-03-31</td>
<td>24.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-04-30</td>
<td>-12.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-05-31</td>
<td>33.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-06-30</td>
<td>82.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-07-31</td>
<td>-132.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-08-31</td>
<td>-68.0</td>
<td>-84.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-09-30</td>
<td>39.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-10-31</td>
<td>164.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021-11-30</td>
<td>-7.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021-12-31</td>
<td>159.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-31</td>
<td>239.0</td>
<td>23.975000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-02-28</td>
<td>-71.0</td>
<td>23.975000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-03-31</td>
<td>17.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-04-30</td>
<td>-88.0</td>
<td>-2.670588</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-05-31</td>
<td>7.0</td>
<td>-2.670588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-06-30</td>
<td>39.0</td>
<td>-2.670588</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a><span class="co">#gráfico</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb114-4"><a href="#cb114-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb114-5"><a href="#cb114-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb114-6"><a href="#cb114-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb114-7"><a href="#cb114-7"></a>plt.legend()</span>
<span id="cb114-8"><a href="#cb114-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="ModelosDeArbolesSerieExportaciones_files/figure-html/cell-63-output-1.png" width="809" height="485"></p>
</div>
</div>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Volver arriba</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb115" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb115-1"><a href="#cb115-1"></a><span class="co">---</span></span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="an">title:</span><span class="co"> "Predicción 1 paso adelante usando 2 retardos"</span></span>
<span id="cb115-3"><a href="#cb115-3"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb115-5"><a href="#cb115-5"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb115-6"><a href="#cb115-6"></a><span class="co">---</span></span>
<span id="cb115-7"><a href="#cb115-7"></a></span>
<span id="cb115-8"><a href="#cb115-8"></a>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. $<span class="sc">\{</span>X_t<span class="sc">\}</span>$</span>
<span id="cb115-9"><a href="#cb115-9"></a></span>
<span id="cb115-12"><a href="#cb115-12"></a><span class="in">```{python}</span></span>
<span id="cb115-13"><a href="#cb115-13"></a><span class="co"># get working directory</span></span>
<span id="cb115-14"><a href="#cb115-14"></a><span class="im">import</span> os</span>
<span id="cb115-15"><a href="#cb115-15"></a>os.getcwd()</span>
<span id="cb115-16"><a href="#cb115-16"></a><span class="in">```</span></span>
<span id="cb115-17"><a href="#cb115-17"></a></span>
<span id="cb115-20"><a href="#cb115-20"></a><span class="in">```{python}</span></span>
<span id="cb115-21"><a href="#cb115-21"></a><span class="co"># librerias</span></span>
<span id="cb115-22"><a href="#cb115-22"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb115-23"><a href="#cb115-23"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb115-24"><a href="#cb115-24"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb115-25"><a href="#cb115-25"></a><span class="im">import</span> sklearn</span>
<span id="cb115-26"><a href="#cb115-26"></a><span class="im">import</span> openpyxl</span>
<span id="cb115-27"><a href="#cb115-27"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb115-28"><a href="#cb115-28"></a><span class="im">import</span> warnings</span>
<span id="cb115-29"><a href="#cb115-29"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-30"><a href="#cb115-30"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-31"><a href="#cb115-31"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-32"><a href="#cb115-32"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-33"><a href="#cb115-33"></a><span class="in">```</span></span>
<span id="cb115-34"><a href="#cb115-34"></a></span>
<span id="cb115-37"><a href="#cb115-37"></a><span class="in">```{python}</span></span>
<span id="cb115-38"><a href="#cb115-38"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb115-39"><a href="#cb115-39"></a>data <span class="op">=</span> pd.read_excel(<span class="st">"datos/Exportaciones.xlsx"</span>,</span>
<span id="cb115-40"><a href="#cb115-40"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Mes'</span>,<span class="st">'Total'</span>]).iloc[<span class="dv">96</span>:].reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb115-41"><a href="#cb115-41"></a>data[<span class="st">'Total'</span>] <span class="op">=</span> data[<span class="st">'Total'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb115-42"><a href="#cb115-42"></a>data</span>
<span id="cb115-43"><a href="#cb115-43"></a><span class="in">```</span></span>
<span id="cb115-44"><a href="#cb115-44"></a></span>
<span id="cb115-47"><a href="#cb115-47"></a><span class="in">```{python}</span></span>
<span id="cb115-48"><a href="#cb115-48"></a><span class="co"># tipo de datos</span></span>
<span id="cb115-49"><a href="#cb115-49"></a><span class="bu">print</span>(data.info())</span>
<span id="cb115-50"><a href="#cb115-50"></a><span class="in">```</span></span>
<span id="cb115-51"><a href="#cb115-51"></a></span>
<span id="cb115-54"><a href="#cb115-54"></a><span class="in">```{python}</span></span>
<span id="cb115-55"><a href="#cb115-55"></a><span class="co">#mirando los datos</span></span>
<span id="cb115-56"><a href="#cb115-56"></a><span class="co">#objeto ts</span></span>
<span id="cb115-57"><a href="#cb115-57"></a>exportaciones <span class="op">=</span> data[<span class="st">'Total'</span>]</span>
<span id="cb115-58"><a href="#cb115-58"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb115-59"><a href="#cb115-59"></a>plt.plot(exportaciones)</span>
<span id="cb115-60"><a href="#cb115-60"></a><span class="in">```</span></span>
<span id="cb115-61"><a href="#cb115-61"></a></span>
<span id="cb115-64"><a href="#cb115-64"></a><span class="in">```{python}</span></span>
<span id="cb115-65"><a href="#cb115-65"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb115-66"><a href="#cb115-66"></a><span class="in">```</span></span>
<span id="cb115-67"><a href="#cb115-67"></a></span>
<span id="cb115-70"><a href="#cb115-70"></a><span class="in">```{python}</span></span>
<span id="cb115-71"><a href="#cb115-71"></a>data.shape</span>
<span id="cb115-72"><a href="#cb115-72"></a><span class="in">```</span></span>
<span id="cb115-73"><a href="#cb115-73"></a></span>
<span id="cb115-74"><a href="#cb115-74"></a><span class="fu">## PACF</span></span>
<span id="cb115-75"><a href="#cb115-75"></a></span>
<span id="cb115-76"><a href="#cb115-76"></a>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</span>
<span id="cb115-77"><a href="#cb115-77"></a></span>
<span id="cb115-80"><a href="#cb115-80"></a><span class="in">```{python}</span></span>
<span id="cb115-81"><a href="#cb115-81"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb115-82"><a href="#cb115-82"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb115-83"><a href="#cb115-83"></a>plot_pacf(exportaciones,lags<span class="op">=</span><span class="dv">140</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb115-84"><a href="#cb115-84"></a>pyplot.show()</span>
<span id="cb115-85"><a href="#cb115-85"></a><span class="in">```</span></span>
<span id="cb115-86"><a href="#cb115-86"></a></span>
<span id="cb115-89"><a href="#cb115-89"></a><span class="in">```{python}</span></span>
<span id="cb115-90"><a href="#cb115-90"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb115-91"><a href="#cb115-91"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(exportaciones, nlags<span class="op">=</span><span class="dv">140</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb115-92"><a href="#cb115-92"></a>T <span class="op">=</span> <span class="bu">len</span>(exportaciones)</span>
<span id="cb115-93"><a href="#cb115-93"></a></span>
<span id="cb115-94"><a href="#cb115-94"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span>
<span id="cb115-95"><a href="#cb115-95"></a><span class="in">```</span></span>
<span id="cb115-96"><a href="#cb115-96"></a></span>
<span id="cb115-99"><a href="#cb115-99"></a><span class="in">```{python}</span></span>
<span id="cb115-100"><a href="#cb115-100"></a>pacf</span>
<span id="cb115-101"><a href="#cb115-101"></a><span class="in">```</span></span>
<span id="cb115-102"><a href="#cb115-102"></a></span>
<span id="cb115-105"><a href="#cb115-105"></a><span class="in">```{python}</span></span>
<span id="cb115-106"><a href="#cb115-106"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb115-107"><a href="#cb115-107"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb115-108"><a href="#cb115-108"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb115-109"><a href="#cb115-109"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb115-110"><a href="#cb115-110"></a>        <span class="cf">break</span></span>
<span id="cb115-111"><a href="#cb115-111"></a><span class="in">```</span></span>
<span id="cb115-112"><a href="#cb115-112"></a></span>
<span id="cb115-113"><a href="#cb115-113"></a>Observamos que con el **pacf** se nos recomienda usar dos retardos, lo cuál nos recueda que cuando se quizo establecer una componente estacional se sugeria un periodo de 2.4, por lo tanto teniendo encuenta lo anterior usaremos **2 retrasos** para la serie original</span>
<span id="cb115-114"><a href="#cb115-114"></a></span>
<span id="cb115-115"><a href="#cb115-115"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb115-116"><a href="#cb115-116"></a></span>
<span id="cb115-117"><a href="#cb115-117"></a><span class="fu">### Creación de los rezagos</span></span>
<span id="cb115-118"><a href="#cb115-118"></a></span>
<span id="cb115-119"><a href="#cb115-119"></a>Debido al análisis previo tomaremos los rezagos de 2 días atrás para poder predecir un paso adelante.</span>
<span id="cb115-120"><a href="#cb115-120"></a></span>
<span id="cb115-123"><a href="#cb115-123"></a><span class="in">```{python}</span></span>
<span id="cb115-124"><a href="#cb115-124"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb115-125"><a href="#cb115-125"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb115-126"><a href="#cb115-126"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb115-127"><a href="#cb115-127"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb115-128"><a href="#cb115-128"></a><span class="bu">print</span>(df1)</span>
<span id="cb115-129"><a href="#cb115-129"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb115-130"><a href="#cb115-130"></a><span class="bu">print</span>(df2)</span>
<span id="cb115-131"><a href="#cb115-131"></a><span class="in">```</span></span>
<span id="cb115-132"><a href="#cb115-132"></a></span>
<span id="cb115-135"><a href="#cb115-135"></a><span class="in">```{python}</span></span>
<span id="cb115-136"><a href="#cb115-136"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb115-137"><a href="#cb115-137"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">282</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb115-138"><a href="#cb115-138"></a><span class="bu">print</span>(indice)</span>
<span id="cb115-139"><a href="#cb115-139"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Total'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb115-140"><a href="#cb115-140"></a><span class="bu">print</span>(originalDatadf)</span>
<span id="cb115-141"><a href="#cb115-141"></a><span class="in">```</span></span>
<span id="cb115-142"><a href="#cb115-142"></a></span>
<span id="cb115-145"><a href="#cb115-145"></a><span class="in">```{python}</span></span>
<span id="cb115-146"><a href="#cb115-146"></a><span class="co"># Rezagos original</span></span>
<span id="cb115-147"><a href="#cb115-147"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb115-148"><a href="#cb115-148"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb115-149"><a href="#cb115-149"></a><span class="bu">print</span>(df1)</span>
<span id="cb115-150"><a href="#cb115-150"></a><span class="in">```</span></span>
<span id="cb115-151"><a href="#cb115-151"></a></span>
<span id="cb115-154"><a href="#cb115-154"></a><span class="in">```{python}</span></span>
<span id="cb115-155"><a href="#cb115-155"></a><span class="co"># Create column t original</span></span>
<span id="cb115-156"><a href="#cb115-156"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb115-157"><a href="#cb115-157"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span>
<span id="cb115-158"><a href="#cb115-158"></a><span class="in">```</span></span>
<span id="cb115-159"><a href="#cb115-159"></a></span>
<span id="cb115-162"><a href="#cb115-162"></a><span class="in">```{python}</span></span>
<span id="cb115-163"><a href="#cb115-163"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb115-164"><a href="#cb115-164"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">2</span>:]</span>
<span id="cb115-165"><a href="#cb115-165"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb115-166"><a href="#cb115-166"></a>df1_Ori.size</span>
<span id="cb115-167"><a href="#cb115-167"></a><span class="in">```</span></span>
<span id="cb115-168"><a href="#cb115-168"></a></span>
<span id="cb115-171"><a href="#cb115-171"></a><span class="in">```{python}</span></span>
<span id="cb115-172"><a href="#cb115-172"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb115-173"><a href="#cb115-173"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb115-174"><a href="#cb115-174"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb115-175"><a href="#cb115-175"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb115-176"><a href="#cb115-176"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb115-177"><a href="#cb115-177"></a><span class="bu">print</span>(X1)</span>
<span id="cb115-178"><a href="#cb115-178"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span>
<span id="cb115-179"><a href="#cb115-179"></a><span class="in">```</span></span>
<span id="cb115-180"><a href="#cb115-180"></a></span>
<span id="cb115-181"><a href="#cb115-181"></a><span class="fu"># Árbol para Serie Original</span></span>
<span id="cb115-182"><a href="#cb115-182"></a></span>
<span id="cb115-183"><a href="#cb115-183"></a><span class="fu">#### Entrenamiento, Validación y prueba</span></span>
<span id="cb115-184"><a href="#cb115-184"></a></span>
<span id="cb115-187"><a href="#cb115-187"></a><span class="in">```{python}</span></span>
<span id="cb115-188"><a href="#cb115-188"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb115-189"><a href="#cb115-189"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb115-190"><a href="#cb115-190"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb115-191"><a href="#cb115-191"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb115-192"><a href="#cb115-192"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb115-193"><a href="#cb115-193"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb115-194"><a href="#cb115-194"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb115-195"><a href="#cb115-195"></a><span class="in">```</span></span>
<span id="cb115-196"><a href="#cb115-196"></a></span>
<span id="cb115-199"><a href="#cb115-199"></a><span class="in">```{python}</span></span>
<span id="cb115-200"><a href="#cb115-200"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb115-201"><a href="#cb115-201"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb115-202"><a href="#cb115-202"></a></span>
<span id="cb115-203"><a href="#cb115-203"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb115-204"><a href="#cb115-204"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb115-205"><a href="#cb115-205"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb115-206"><a href="#cb115-206"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb115-207"><a href="#cb115-207"></a><span class="in">```</span></span>
<span id="cb115-208"><a href="#cb115-208"></a></span>
<span id="cb115-211"><a href="#cb115-211"></a><span class="in">```{python}</span></span>
<span id="cb115-212"><a href="#cb115-212"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb115-213"><a href="#cb115-213"></a></span>
<span id="cb115-214"><a href="#cb115-214"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb115-215"><a href="#cb115-215"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb115-216"><a href="#cb115-216"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb115-217"><a href="#cb115-217"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb115-218"><a href="#cb115-218"></a></span>
<span id="cb115-219"><a href="#cb115-219"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb115-220"><a href="#cb115-220"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb115-221"><a href="#cb115-221"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb115-222"><a href="#cb115-222"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb115-223"><a href="#cb115-223"></a><span class="in">```</span></span>
<span id="cb115-224"><a href="#cb115-224"></a></span>
<span id="cb115-225"><a href="#cb115-225"></a><span class="fu">### Árbol</span></span>
<span id="cb115-226"><a href="#cb115-226"></a></span>
<span id="cb115-229"><a href="#cb115-229"></a><span class="in">```{python}</span></span>
<span id="cb115-230"><a href="#cb115-230"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb115-231"><a href="#cb115-231"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb115-232"><a href="#cb115-232"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb115-233"><a href="#cb115-233"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb115-234"><a href="#cb115-234"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb115-235"><a href="#cb115-235"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb115-236"><a href="#cb115-236"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb115-237"><a href="#cb115-237"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb115-238"><a href="#cb115-238"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb115-239"><a href="#cb115-239"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb115-240"><a href="#cb115-240"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb115-241"><a href="#cb115-241"></a><span class="in">```</span></span>
<span id="cb115-242"><a href="#cb115-242"></a></span>
<span id="cb115-243"><a href="#cb115-243"></a>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</span>
<span id="cb115-244"><a href="#cb115-244"></a></span>
<span id="cb115-247"><a href="#cb115-247"></a><span class="in">```{python}</span></span>
<span id="cb115-248"><a href="#cb115-248"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb115-249"><a href="#cb115-249"></a></span>
<span id="cb115-250"><a href="#cb115-250"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb115-251"><a href="#cb115-251"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb115-252"><a href="#cb115-252"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb115-253"><a href="#cb115-253"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb115-254"><a href="#cb115-254"></a></span>
<span id="cb115-255"><a href="#cb115-255"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb115-256"><a href="#cb115-256"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb115-257"><a href="#cb115-257"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb115-258"><a href="#cb115-258"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb115-259"><a href="#cb115-259"></a>    </span>
<span id="cb115-260"><a href="#cb115-260"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb115-261"><a href="#cb115-261"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb115-262"><a href="#cb115-262"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb115-263"><a href="#cb115-263"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb115-264"><a href="#cb115-264"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb115-265"><a href="#cb115-265"></a><span class="in">```</span></span>
<span id="cb115-266"><a href="#cb115-266"></a></span>
<span id="cb115-267"><a href="#cb115-267"></a>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</span>
<span id="cb115-268"><a href="#cb115-268"></a></span>
<span id="cb115-271"><a href="#cb115-271"></a><span class="in">```{python}</span></span>
<span id="cb115-272"><a href="#cb115-272"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb115-273"><a href="#cb115-273"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb115-274"><a href="#cb115-274"></a><span class="co">#######</span></span>
<span id="cb115-275"><a href="#cb115-275"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb115-276"><a href="#cb115-276"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb115-277"><a href="#cb115-277"></a><span class="co">####</span></span>
<span id="cb115-278"><a href="#cb115-278"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb115-279"><a href="#cb115-279"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb115-280"><a href="#cb115-280"></a><span class="co">#####</span></span>
<span id="cb115-281"><a href="#cb115-281"></a><span class="co">####</span></span>
<span id="cb115-282"><a href="#cb115-282"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb115-283"><a href="#cb115-283"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb115-284"><a href="#cb115-284"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb115-285"><a href="#cb115-285"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb115-286"><a href="#cb115-286"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb115-287"><a href="#cb115-287"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb115-288"><a href="#cb115-288"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb115-289"><a href="#cb115-289"></a><span class="in">```</span></span>
<span id="cb115-290"><a href="#cb115-290"></a></span>
<span id="cb115-293"><a href="#cb115-293"></a><span class="in">```{python}</span></span>
<span id="cb115-294"><a href="#cb115-294"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb115-295"><a href="#cb115-295"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">4</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb115-296"><a href="#cb115-296"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb115-297"><a href="#cb115-297"></a></span>
<span id="cb115-298"><a href="#cb115-298"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb115-299"><a href="#cb115-299"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb115-300"><a href="#cb115-300"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb115-301"><a href="#cb115-301"></a></span>
<span id="cb115-302"><a href="#cb115-302"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb115-303"><a href="#cb115-303"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb115-304"><a href="#cb115-304"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb115-305"><a href="#cb115-305"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb115-306"><a href="#cb115-306"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb115-307"><a href="#cb115-307"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb115-308"><a href="#cb115-308"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb115-309"><a href="#cb115-309"></a>plt.legend()</span>
<span id="cb115-310"><a href="#cb115-310"></a>plt.show()</span>
<span id="cb115-311"><a href="#cb115-311"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb115-312"><a href="#cb115-312"></a></span>
<span id="cb115-313"><a href="#cb115-313"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb115-314"><a href="#cb115-314"></a><span class="in">```</span></span>
<span id="cb115-315"><a href="#cb115-315"></a></span>
<span id="cb115-318"><a href="#cb115-318"></a><span class="in">```{python}</span></span>
<span id="cb115-319"><a href="#cb115-319"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb115-320"><a href="#cb115-320"></a></span>
<span id="cb115-321"><a href="#cb115-321"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb115-322"><a href="#cb115-322"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb115-323"><a href="#cb115-323"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb115-324"><a href="#cb115-324"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb115-325"><a href="#cb115-325"></a><span class="in">```</span></span>
<span id="cb115-326"><a href="#cb115-326"></a></span>
<span id="cb115-329"><a href="#cb115-329"></a><span class="in">```{python}</span></span>
<span id="cb115-330"><a href="#cb115-330"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb115-331"><a href="#cb115-331"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb115-332"><a href="#cb115-332"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb115-333"><a href="#cb115-333"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb115-334"><a href="#cb115-334"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb115-335"><a href="#cb115-335"></a><span class="in">```</span></span>
<span id="cb115-336"><a href="#cb115-336"></a></span>
<span id="cb115-337"><a href="#cb115-337"></a>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</span>
<span id="cb115-338"><a href="#cb115-338"></a></span>
<span id="cb115-341"><a href="#cb115-341"></a><span class="in">```{python}</span></span>
<span id="cb115-342"><a href="#cb115-342"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb115-343"><a href="#cb115-343"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb115-344"><a href="#cb115-344"></a></span>
<span id="cb115-345"><a href="#cb115-345"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb115-346"><a href="#cb115-346"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb115-347"><a href="#cb115-347"></a><span class="in">```</span></span>
<span id="cb115-348"><a href="#cb115-348"></a></span>
<span id="cb115-351"><a href="#cb115-351"></a><span class="in">```{python}</span></span>
<span id="cb115-352"><a href="#cb115-352"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb115-353"><a href="#cb115-353"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb115-354"><a href="#cb115-354"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">225</span>]</span>
<span id="cb115-355"><a href="#cb115-355"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">225</span>:<span class="dv">280</span>]</span>
<span id="cb115-356"><a href="#cb115-356"></a><span class="in">```</span></span>
<span id="cb115-357"><a href="#cb115-357"></a></span>
<span id="cb115-360"><a href="#cb115-360"></a><span class="in">```{python}</span></span>
<span id="cb115-361"><a href="#cb115-361"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb115-362"><a href="#cb115-362"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb115-363"><a href="#cb115-363"></a><span class="in">```</span></span>
<span id="cb115-364"><a href="#cb115-364"></a></span>
<span id="cb115-367"><a href="#cb115-367"></a><span class="in">```{python}</span></span>
<span id="cb115-368"><a href="#cb115-368"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb115-369"><a href="#cb115-369"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb115-370"><a href="#cb115-370"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb115-371"><a href="#cb115-371"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb115-372"><a href="#cb115-372"></a><span class="in">```</span></span>
<span id="cb115-373"><a href="#cb115-373"></a></span>
<span id="cb115-376"><a href="#cb115-376"></a><span class="in">```{python}</span></span>
<span id="cb115-377"><a href="#cb115-377"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb115-378"><a href="#cb115-378"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb115-379"><a href="#cb115-379"></a>ObsvsPred1.head(<span class="dv">10</span>)</span>
<span id="cb115-380"><a href="#cb115-380"></a><span class="in">```</span></span>
<span id="cb115-381"><a href="#cb115-381"></a></span>
<span id="cb115-384"><a href="#cb115-384"></a><span class="in">```{python}</span></span>
<span id="cb115-385"><a href="#cb115-385"></a><span class="co">#gráfico</span></span>
<span id="cb115-386"><a href="#cb115-386"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb115-387"><a href="#cb115-387"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb115-388"><a href="#cb115-388"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb115-389"><a href="#cb115-389"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb115-390"><a href="#cb115-390"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb115-391"><a href="#cb115-391"></a>plt.legend()</span>
<span id="cb115-392"><a href="#cb115-392"></a>plt.show()</span>
<span id="cb115-393"><a href="#cb115-393"></a><span class="in">```</span></span>
<span id="cb115-394"><a href="#cb115-394"></a></span>
<span id="cb115-395"><a href="#cb115-395"></a><span class="fu"># Serie de Exportaciones sin Tendencia</span></span>
<span id="cb115-396"><a href="#cb115-396"></a></span>
<span id="cb115-397"><a href="#cb115-397"></a>Implementaremos ahora el modelo de árboles sobre la serie sin tendencia, eliminada usando la estimación dada por medio del filtro de promedios móviles. Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. $<span class="sc">\{</span>X_t<span class="sc">\}</span>$</span>
<span id="cb115-398"><a href="#cb115-398"></a></span>
<span id="cb115-401"><a href="#cb115-401"></a><span class="in">```{python}</span></span>
<span id="cb115-402"><a href="#cb115-402"></a><span class="co"># Lectura de la serie</span></span>
<span id="cb115-403"><a href="#cb115-403"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"ExportacionesSinTendencia.xlsx"</span>,</span>
<span id="cb115-404"><a href="#cb115-404"></a>                   header <span class="op">=</span> <span class="dv">0</span>, usecols <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'ExportacionesSinTend'</span>]).reset_index(drop <span class="op">=</span> <span class="va">True</span>).<span class="bu">round</span>()</span>
<span id="cb115-405"><a href="#cb115-405"></a>data2[<span class="st">'ExportacionesSinTend'</span>] <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>].astype(<span class="bu">int</span>) </span>
<span id="cb115-406"><a href="#cb115-406"></a>data2</span>
<span id="cb115-407"><a href="#cb115-407"></a><span class="in">```</span></span>
<span id="cb115-408"><a href="#cb115-408"></a></span>
<span id="cb115-411"><a href="#cb115-411"></a><span class="in">```{python}</span></span>
<span id="cb115-412"><a href="#cb115-412"></a><span class="co"># tipo de datos</span></span>
<span id="cb115-413"><a href="#cb115-413"></a><span class="bu">print</span>(data2.info())</span>
<span id="cb115-414"><a href="#cb115-414"></a><span class="in">```</span></span>
<span id="cb115-415"><a href="#cb115-415"></a></span>
<span id="cb115-418"><a href="#cb115-418"></a><span class="in">```{python}</span></span>
<span id="cb115-419"><a href="#cb115-419"></a><span class="co">#mirando los datos</span></span>
<span id="cb115-420"><a href="#cb115-420"></a><span class="co">#objeto ts</span></span>
<span id="cb115-421"><a href="#cb115-421"></a>exportaciones <span class="op">=</span> data2[<span class="st">'ExportacionesSinTend'</span>]</span>
<span id="cb115-422"><a href="#cb115-422"></a><span class="bu">print</span>(<span class="bu">type</span>(exportaciones))</span>
<span id="cb115-423"><a href="#cb115-423"></a>plt.plot(exportaciones)</span>
<span id="cb115-424"><a href="#cb115-424"></a><span class="in">```</span></span>
<span id="cb115-425"><a href="#cb115-425"></a></span>
<span id="cb115-428"><a href="#cb115-428"></a><span class="in">```{python}</span></span>
<span id="cb115-429"><a href="#cb115-429"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb115-430"><a href="#cb115-430"></a><span class="in">```</span></span>
<span id="cb115-431"><a href="#cb115-431"></a></span>
<span id="cb115-434"><a href="#cb115-434"></a><span class="in">```{python}</span></span>
<span id="cb115-435"><a href="#cb115-435"></a>data2.shape</span>
<span id="cb115-436"><a href="#cb115-436"></a><span class="in">```</span></span>
<span id="cb115-437"><a href="#cb115-437"></a></span>
<span id="cb115-438"><a href="#cb115-438"></a><span class="fu">## PACF</span></span>
<span id="cb115-439"><a href="#cb115-439"></a></span>
<span id="cb115-440"><a href="#cb115-440"></a>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</span>
<span id="cb115-441"><a href="#cb115-441"></a></span>
<span id="cb115-444"><a href="#cb115-444"></a><span class="in">```{python}</span></span>
<span id="cb115-445"><a href="#cb115-445"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb115-446"><a href="#cb115-446"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb115-447"><a href="#cb115-447"></a>plot_pacf(exportaciones,lags<span class="op">=</span><span class="dv">134</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb115-448"><a href="#cb115-448"></a>pyplot.show()</span>
<span id="cb115-449"><a href="#cb115-449"></a><span class="in">```</span></span>
<span id="cb115-450"><a href="#cb115-450"></a></span>
<span id="cb115-453"><a href="#cb115-453"></a><span class="in">```{python}</span></span>
<span id="cb115-454"><a href="#cb115-454"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb115-455"><a href="#cb115-455"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(exportaciones, nlags<span class="op">=</span><span class="dv">134</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb115-456"><a href="#cb115-456"></a>T <span class="op">=</span> <span class="bu">len</span>(exportaciones)</span>
<span id="cb115-457"><a href="#cb115-457"></a></span>
<span id="cb115-458"><a href="#cb115-458"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span>
<span id="cb115-459"><a href="#cb115-459"></a><span class="in">```</span></span>
<span id="cb115-460"><a href="#cb115-460"></a></span>
<span id="cb115-463"><a href="#cb115-463"></a><span class="in">```{python}</span></span>
<span id="cb115-464"><a href="#cb115-464"></a>pacf</span>
<span id="cb115-465"><a href="#cb115-465"></a><span class="in">```</span></span>
<span id="cb115-466"><a href="#cb115-466"></a></span>
<span id="cb115-469"><a href="#cb115-469"></a><span class="in">```{python}</span></span>
<span id="cb115-470"><a href="#cb115-470"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb115-471"><a href="#cb115-471"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb115-472"><a href="#cb115-472"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb115-473"><a href="#cb115-473"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb115-474"><a href="#cb115-474"></a>        <span class="cf">break</span></span>
<span id="cb115-475"><a href="#cb115-475"></a><span class="in">```</span></span>
<span id="cb115-476"><a href="#cb115-476"></a></span>
<span id="cb115-477"><a href="#cb115-477"></a>Observamos que con el **pacf** se nos recomienda usar un solo retardo, usaremos **1 retraso** para la serie sin Tendencia</span>
<span id="cb115-478"><a href="#cb115-478"></a></span>
<span id="cb115-479"><a href="#cb115-479"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb115-480"><a href="#cb115-480"></a></span>
<span id="cb115-481"><a href="#cb115-481"></a><span class="fu">### Creación de los rezagos</span></span>
<span id="cb115-482"><a href="#cb115-482"></a></span>
<span id="cb115-483"><a href="#cb115-483"></a>Debido al análisis previo tomaremos los rezagos de 1 días atrás para poder predecir un paso adelante.</span>
<span id="cb115-484"><a href="#cb115-484"></a></span>
<span id="cb115-487"><a href="#cb115-487"></a><span class="in">```{python}</span></span>
<span id="cb115-488"><a href="#cb115-488"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb115-489"><a href="#cb115-489"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb115-490"><a href="#cb115-490"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb115-491"><a href="#cb115-491"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb115-492"><a href="#cb115-492"></a><span class="bu">print</span>(df1)</span>
<span id="cb115-493"><a href="#cb115-493"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb115-494"><a href="#cb115-494"></a><span class="bu">print</span>(df2)</span>
<span id="cb115-495"><a href="#cb115-495"></a><span class="in">```</span></span>
<span id="cb115-496"><a href="#cb115-496"></a></span>
<span id="cb115-499"><a href="#cb115-499"></a><span class="in">```{python}</span></span>
<span id="cb115-500"><a href="#cb115-500"></a><span class="co"># arreglo de datos para el arreglo de rezagos Serie Original</span></span>
<span id="cb115-501"><a href="#cb115-501"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/7/2000'</span>, periods<span class="op">=</span><span class="dv">270</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb115-502"><a href="#cb115-502"></a><span class="bu">print</span>(indice)</span>
<span id="cb115-503"><a href="#cb115-503"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data2[<span class="st">'ExportacionesSinTend'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb115-504"><a href="#cb115-504"></a><span class="bu">print</span>(originalDatadf)</span>
<span id="cb115-505"><a href="#cb115-505"></a><span class="in">```</span></span>
<span id="cb115-506"><a href="#cb115-506"></a></span>
<span id="cb115-509"><a href="#cb115-509"></a><span class="in">```{python}</span></span>
<span id="cb115-510"><a href="#cb115-510"></a><span class="co"># Rezagos original</span></span>
<span id="cb115-511"><a href="#cb115-511"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb115-512"><a href="#cb115-512"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb115-513"><a href="#cb115-513"></a><span class="bu">print</span>(df1)</span>
<span id="cb115-514"><a href="#cb115-514"></a><span class="in">```</span></span>
<span id="cb115-515"><a href="#cb115-515"></a></span>
<span id="cb115-518"><a href="#cb115-518"></a><span class="in">```{python}</span></span>
<span id="cb115-519"><a href="#cb115-519"></a><span class="co"># Create column t original</span></span>
<span id="cb115-520"><a href="#cb115-520"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb115-521"><a href="#cb115-521"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span>
<span id="cb115-522"><a href="#cb115-522"></a><span class="in">```</span></span>
<span id="cb115-523"><a href="#cb115-523"></a></span>
<span id="cb115-526"><a href="#cb115-526"></a><span class="in">```{python}</span></span>
<span id="cb115-527"><a href="#cb115-527"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 3 rows original</span></span>
<span id="cb115-528"><a href="#cb115-528"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">1</span>:]</span>
<span id="cb115-529"><a href="#cb115-529"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb115-530"><a href="#cb115-530"></a>df1_Ori.size</span>
<span id="cb115-531"><a href="#cb115-531"></a><span class="in">```</span></span>
<span id="cb115-532"><a href="#cb115-532"></a></span>
<span id="cb115-535"><a href="#cb115-535"></a><span class="in">```{python}</span></span>
<span id="cb115-536"><a href="#cb115-536"></a><span class="co"># Split data Serie Original</span></span>
<span id="cb115-537"><a href="#cb115-537"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb115-538"><a href="#cb115-538"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb115-539"><a href="#cb115-539"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb115-540"><a href="#cb115-540"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb115-541"><a href="#cb115-541"></a><span class="bu">print</span>(X1)</span>
<span id="cb115-542"><a href="#cb115-542"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span>
<span id="cb115-543"><a href="#cb115-543"></a><span class="in">```</span></span>
<span id="cb115-544"><a href="#cb115-544"></a></span>
<span id="cb115-545"><a href="#cb115-545"></a><span class="fu"># Árbol para Serie Sin Tendencia</span></span>
<span id="cb115-546"><a href="#cb115-546"></a></span>
<span id="cb115-547"><a href="#cb115-547"></a><span class="fu">#### Entrenamiento, Validación y prueba</span></span>
<span id="cb115-548"><a href="#cb115-548"></a></span>
<span id="cb115-551"><a href="#cb115-551"></a><span class="in">```{python}</span></span>
<span id="cb115-552"><a href="#cb115-552"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb115-553"><a href="#cb115-553"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb115-554"><a href="#cb115-554"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb115-555"><a href="#cb115-555"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb115-556"><a href="#cb115-556"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb115-557"><a href="#cb115-557"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb115-558"><a href="#cb115-558"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb115-559"><a href="#cb115-559"></a><span class="in">```</span></span>
<span id="cb115-560"><a href="#cb115-560"></a></span>
<span id="cb115-563"><a href="#cb115-563"></a><span class="in">```{python}</span></span>
<span id="cb115-564"><a href="#cb115-564"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb115-565"><a href="#cb115-565"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb115-566"><a href="#cb115-566"></a></span>
<span id="cb115-567"><a href="#cb115-567"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb115-568"><a href="#cb115-568"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb115-569"><a href="#cb115-569"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb115-570"><a href="#cb115-570"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb115-571"><a href="#cb115-571"></a><span class="in">```</span></span>
<span id="cb115-572"><a href="#cb115-572"></a></span>
<span id="cb115-575"><a href="#cb115-575"></a><span class="in">```{python}</span></span>
<span id="cb115-576"><a href="#cb115-576"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb115-577"><a href="#cb115-577"></a></span>
<span id="cb115-578"><a href="#cb115-578"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb115-579"><a href="#cb115-579"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb115-580"><a href="#cb115-580"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb115-581"><a href="#cb115-581"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb115-582"><a href="#cb115-582"></a></span>
<span id="cb115-583"><a href="#cb115-583"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb115-584"><a href="#cb115-584"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb115-585"><a href="#cb115-585"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb115-586"><a href="#cb115-586"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb115-587"><a href="#cb115-587"></a><span class="in">```</span></span>
<span id="cb115-588"><a href="#cb115-588"></a></span>
<span id="cb115-589"><a href="#cb115-589"></a><span class="fu">### Árbol</span></span>
<span id="cb115-590"><a href="#cb115-590"></a></span>
<span id="cb115-593"><a href="#cb115-593"></a><span class="in">```{python}</span></span>
<span id="cb115-594"><a href="#cb115-594"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb115-595"><a href="#cb115-595"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb115-596"><a href="#cb115-596"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb115-597"><a href="#cb115-597"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb115-598"><a href="#cb115-598"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb115-599"><a href="#cb115-599"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb115-600"><a href="#cb115-600"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb115-601"><a href="#cb115-601"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb115-602"><a href="#cb115-602"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb115-603"><a href="#cb115-603"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb115-604"><a href="#cb115-604"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb115-605"><a href="#cb115-605"></a><span class="in">```</span></span>
<span id="cb115-606"><a href="#cb115-606"></a></span>
<span id="cb115-607"><a href="#cb115-607"></a>Vemos que el R2 para los datos de validación es malo pue ses negativo, Se relizará un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</span>
<span id="cb115-608"><a href="#cb115-608"></a></span>
<span id="cb115-611"><a href="#cb115-611"></a><span class="in">```{python}</span></span>
<span id="cb115-612"><a href="#cb115-612"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb115-613"><a href="#cb115-613"></a></span>
<span id="cb115-614"><a href="#cb115-614"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb115-615"><a href="#cb115-615"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb115-616"><a href="#cb115-616"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb115-617"><a href="#cb115-617"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb115-618"><a href="#cb115-618"></a></span>
<span id="cb115-619"><a href="#cb115-619"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb115-620"><a href="#cb115-620"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb115-621"><a href="#cb115-621"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb115-622"><a href="#cb115-622"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb115-623"><a href="#cb115-623"></a>    </span>
<span id="cb115-624"><a href="#cb115-624"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb115-625"><a href="#cb115-625"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb115-626"><a href="#cb115-626"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb115-627"><a href="#cb115-627"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb115-628"><a href="#cb115-628"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb115-629"><a href="#cb115-629"></a><span class="in">```</span></span>
<span id="cb115-630"><a href="#cb115-630"></a></span>
<span id="cb115-631"><a href="#cb115-631"></a>Note que los scores para el conjunto de validación son negativos para todas las profundidades evaluadas. Tomaremos el más cercano a cero que el el de la profundidad 2. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</span>
<span id="cb115-632"><a href="#cb115-632"></a></span>
<span id="cb115-635"><a href="#cb115-635"></a><span class="in">```{python}</span></span>
<span id="cb115-636"><a href="#cb115-636"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb115-637"><a href="#cb115-637"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb115-638"><a href="#cb115-638"></a><span class="co">#######</span></span>
<span id="cb115-639"><a href="#cb115-639"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb115-640"><a href="#cb115-640"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb115-641"><a href="#cb115-641"></a><span class="co">####</span></span>
<span id="cb115-642"><a href="#cb115-642"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb115-643"><a href="#cb115-643"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb115-644"><a href="#cb115-644"></a><span class="co">#####</span></span>
<span id="cb115-645"><a href="#cb115-645"></a><span class="co">####</span></span>
<span id="cb115-646"><a href="#cb115-646"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb115-647"><a href="#cb115-647"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb115-648"><a href="#cb115-648"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb115-649"><a href="#cb115-649"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb115-650"><a href="#cb115-650"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb115-651"><a href="#cb115-651"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb115-652"><a href="#cb115-652"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb115-653"><a href="#cb115-653"></a><span class="in">```</span></span>
<span id="cb115-654"><a href="#cb115-654"></a></span>
<span id="cb115-657"><a href="#cb115-657"></a><span class="in">```{python}</span></span>
<span id="cb115-658"><a href="#cb115-658"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb115-659"><a href="#cb115-659"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">2</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb115-660"><a href="#cb115-660"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb115-661"><a href="#cb115-661"></a></span>
<span id="cb115-662"><a href="#cb115-662"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb115-663"><a href="#cb115-663"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb115-664"><a href="#cb115-664"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb115-665"><a href="#cb115-665"></a></span>
<span id="cb115-666"><a href="#cb115-666"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb115-667"><a href="#cb115-667"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb115-668"><a href="#cb115-668"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb115-669"><a href="#cb115-669"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb115-670"><a href="#cb115-670"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb115-671"><a href="#cb115-671"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb115-672"><a href="#cb115-672"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb115-673"><a href="#cb115-673"></a>plt.legend()</span>
<span id="cb115-674"><a href="#cb115-674"></a>plt.show()</span>
<span id="cb115-675"><a href="#cb115-675"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb115-676"><a href="#cb115-676"></a></span>
<span id="cb115-677"><a href="#cb115-677"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb115-678"><a href="#cb115-678"></a><span class="in">```</span></span>
<span id="cb115-679"><a href="#cb115-679"></a></span>
<span id="cb115-682"><a href="#cb115-682"></a><span class="in">```{python}</span></span>
<span id="cb115-683"><a href="#cb115-683"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb115-684"><a href="#cb115-684"></a></span>
<span id="cb115-685"><a href="#cb115-685"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb115-686"><a href="#cb115-686"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb115-687"><a href="#cb115-687"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb115-688"><a href="#cb115-688"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb115-689"><a href="#cb115-689"></a><span class="in">```</span></span>
<span id="cb115-690"><a href="#cb115-690"></a></span>
<span id="cb115-693"><a href="#cb115-693"></a><span class="in">```{python}</span></span>
<span id="cb115-694"><a href="#cb115-694"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb115-695"><a href="#cb115-695"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb115-696"><a href="#cb115-696"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb115-697"><a href="#cb115-697"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb115-698"><a href="#cb115-698"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb115-699"><a href="#cb115-699"></a><span class="in">```</span></span>
<span id="cb115-700"><a href="#cb115-700"></a></span>
<span id="cb115-701"><a href="#cb115-701"></a>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</span>
<span id="cb115-702"><a href="#cb115-702"></a></span>
<span id="cb115-705"><a href="#cb115-705"></a><span class="in">```{python}</span></span>
<span id="cb115-706"><a href="#cb115-706"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb115-707"><a href="#cb115-707"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb115-708"><a href="#cb115-708"></a></span>
<span id="cb115-709"><a href="#cb115-709"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb115-710"><a href="#cb115-710"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb115-711"><a href="#cb115-711"></a><span class="in">```</span></span>
<span id="cb115-712"><a href="#cb115-712"></a></span>
<span id="cb115-715"><a href="#cb115-715"></a><span class="in">```{python}</span></span>
<span id="cb115-716"><a href="#cb115-716"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb115-717"><a href="#cb115-717"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb115-718"><a href="#cb115-718"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">215</span>]</span>
<span id="cb115-719"><a href="#cb115-719"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">215</span>:<span class="dv">269</span>]</span>
<span id="cb115-720"><a href="#cb115-720"></a><span class="in">```</span></span>
<span id="cb115-721"><a href="#cb115-721"></a></span>
<span id="cb115-724"><a href="#cb115-724"></a><span class="in">```{python}</span></span>
<span id="cb115-725"><a href="#cb115-725"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb115-726"><a href="#cb115-726"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb115-727"><a href="#cb115-727"></a><span class="in">```</span></span>
<span id="cb115-728"><a href="#cb115-728"></a></span>
<span id="cb115-731"><a href="#cb115-731"></a><span class="in">```{python}</span></span>
<span id="cb115-732"><a href="#cb115-732"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb115-733"><a href="#cb115-733"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb115-734"><a href="#cb115-734"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb115-735"><a href="#cb115-735"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb115-736"><a href="#cb115-736"></a><span class="in">```</span></span>
<span id="cb115-737"><a href="#cb115-737"></a></span>
<span id="cb115-740"><a href="#cb115-740"></a><span class="in">```{python}</span></span>
<span id="cb115-741"><a href="#cb115-741"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb115-742"><a href="#cb115-742"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb115-743"><a href="#cb115-743"></a>ObsvsPred1.tail(<span class="dv">54</span>)</span>
<span id="cb115-744"><a href="#cb115-744"></a><span class="in">```</span></span>
<span id="cb115-745"><a href="#cb115-745"></a></span>
<span id="cb115-748"><a href="#cb115-748"></a><span class="in">```{python}</span></span>
<span id="cb115-749"><a href="#cb115-749"></a><span class="co">#gráfico</span></span>
<span id="cb115-750"><a href="#cb115-750"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb115-751"><a href="#cb115-751"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb115-752"><a href="#cb115-752"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb115-753"><a href="#cb115-753"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">223</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb115-754"><a href="#cb115-754"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb115-755"><a href="#cb115-755"></a>plt.legend()</span>
<span id="cb115-756"><a href="#cb115-756"></a>plt.show()</span>
<span id="cb115-757"><a href="#cb115-757"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>