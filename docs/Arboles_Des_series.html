<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Series de Tiempo - Predicción 1 paso adelante</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ninguna coincidencia",
    "search-matching-documents-text": "coincidencias",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": ""
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series de Tiempo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-análisis-descriptivo" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Análisis Descriptivo</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-análisis-descriptivo">    
        <li>
    <a class="dropdown-item" href="./DExportaciones.html" rel="" target="">
 <span class="dropdown-text">Exportaciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DBitcoin.html" rel="" target="">
 <span class="dropdown-text">Bitcoin</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-exportaciones">    
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportacionesdoceRetardos.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ModelosDeArbolesSerieExportaciones.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-exportaciones" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Exportaciones</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-exportaciones">    
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_12.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 12 retardos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_exportaciones_con_2.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando 2 retardos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rboles-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Árboles Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rboles-bitcoin">    
        <li>
    <a class="dropdown-item" href="./Arboles_Des_series.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-redes-bitcoin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Redes Bitcoin</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-redes-bitcoin">    
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_bayesiano.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (bayesiano)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./red_bitcoin_con_1_grilla.html" rel="" target="">
 <span class="dropdown-text">Predicción 1 paso adelante usando el último retardo (grilla)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/C-Mario/series" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">GitHub</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
  <li><a href="#serie-original" id="toc-serie-original" class="nav-link active" data-scroll-target="#serie-original"><span class="header-section-number">0.1</span> Serie original</a></li>
  <li><a href="#pacf" id="toc-pacf" class="nav-link" data-scroll-target="#pacf"><span class="header-section-number">0.2</span> PACF</a></li>
  <li><a href="#serie-trasnformada-y-diferenciada" id="toc-serie-trasnformada-y-diferenciada" class="nav-link" data-scroll-target="#serie-trasnformada-y-diferenciada"><span class="header-section-number">0.3</span> Serie Trasnformada y diferenciada</a></li>
  <li><a href="#pacf-1" id="toc-pacf-1" class="nav-link" data-scroll-target="#pacf-1"><span class="header-section-number">0.4</span> PACF</a></li>
  <li><a href="#árboles-de-decisión" id="toc-árboles-de-decisión" class="nav-link" data-scroll-target="#árboles-de-decisión"><span class="header-section-number">1</span> Árboles de decisión</a>
  <ul class="collapse">
  <li><a href="#creación-de-los-rezagos" id="toc-creación-de-los-rezagos" class="nav-link" data-scroll-target="#creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</a></li>
  <li><a href="#división-de-los-datos" id="toc-división-de-los-datos" class="nav-link" data-scroll-target="#división-de-los-datos"><span class="header-section-number">1.0.2</span> División de los datos</a></li>
  </ul></li>
  <li><a href="#árbol-para-datos-originales" id="toc-árbol-para-datos-originales" class="nav-link" data-scroll-target="#árbol-para-datos-originales"><span class="header-section-number">2</span> Árbol para datos originales</a>
  <ul class="collapse">
  <li><a href="#árbol" id="toc-árbol" class="nav-link" data-scroll-target="#árbol"><span class="header-section-number">2.0.1</span> Árbol</a></li>
  </ul></li>
  <li><a href="#árbol-para-datos-diferenciados" id="toc-árbol-para-datos-diferenciados" class="nav-link" data-scroll-target="#árbol-para-datos-diferenciados"><span class="header-section-number">3</span> Árbol para datos Diferenciados</a>
  <ul class="collapse">
  <li><a href="#árbol-1" id="toc-árbol-1" class="nav-link" data-scroll-target="#árbol-1"><span class="header-section-number">3.0.1</span> Árbol</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Predicción 1 paso adelante</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. <span class="math inline">\(\{X_t\}\)</span></p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># get working directory</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3"></a>os.getcwd()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'C:\\Users\\dofca\\Desktop\\series'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># librerias</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">import</span> sklearn</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">import</span> openpyxl</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">import</span> warnings</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Matplotlib Version: 1.25.2
Pandas Version: 2.0.3
Numpy Version: 1.25.2
Sklearn: 1.3.1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># traer datos originales</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>data <span class="op">=</span> pd.ExcelFile(<span class="st">'Bitcoin.xlsx'</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="bu">print</span>(data.sheet_names)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># dataframe con los datos</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>data <span class="op">=</span> data.parse(<span class="st">'Sheet1'</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="bu">print</span>(data)</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="bu">print</span>(<span class="bu">type</span>(data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['Sheet1']
     FechaTiempo     Valor
0     2021-12-31  46214.37
1     2021-12-30  47150.71
2     2021-12-29  46483.36
3     2021-12-28  47543.30
4     2021-12-27  50718.11
...          ...       ...
1821  2017-01-05    994.02
1822  2017-01-04   1122.56
1823  2017-01-03   1036.99
1824  2017-01-02   1014.10
1825  2017-01-01    998.80

[1826 rows x 2 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;</code></pre>
</div>
</div>
<p>Notamos que estan organizador del más reciente al más antiguo asi entonces buscaremos organiarla cámo debe ser</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>data <span class="op">=</span> data[::<span class="op">-</span><span class="dv">1</span>].reset_index(drop<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>data.index <span class="op">=</span> data[<span class="st">'FechaTiempo'</span>]</span>
<span id="cb7-3"><a href="#cb7-3"></a>data<span class="op">=</span>data.asfreq(<span class="st">'D'</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>data <span class="op">=</span> data.drop(columns<span class="op">=</span>[<span class="st">'FechaTiempo'</span>,<span class="st">'index'</span>])</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                Valor
FechaTiempo          
2017-01-01     998.80
2017-01-02    1014.10
2017-01-03    1036.99
2017-01-04    1122.56
2017-01-05     994.02
...               ...
2021-12-27   50718.11
2021-12-28   47543.30
2021-12-29   46483.36
2021-12-30   47150.71
2021-12-31   46214.37

[1826 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># traer datos</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>data_2 <span class="op">=</span> pd.ExcelFile(<span class="st">'dlData.xlsx'</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="bu">print</span>(data_2.sheet_names)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># dataframe con los datos</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>data_2 <span class="op">=</span> data_2.parse(<span class="st">'Sheet1'</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="bu">print</span>(data_2)</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="bu">print</span>(<span class="bu">type</span>(data_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['Sheet1']
      Unnamed: 0        V1
0     2017-01-02  0.015202
1     2017-01-03  0.022321
2     2017-01-04  0.079290
3     2017-01-05 -0.121610
4     2017-01-06 -0.108785
...          ...       ...
1820  2021-12-27 -0.001440
1821  2021-12-28 -0.064642
1822  2021-12-29 -0.022546
1823  2021-12-30  0.014255
1824  2021-12-31 -0.020058

[1825 rows x 2 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;</code></pre>
</div>
</div>
<section id="serie-original" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="serie-original"><span class="header-section-number">0.1</span> Serie original</h2>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="bu">print</span>(data.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 1826 entries, 2017-01-01 to 2021-12-31
Freq: D
Data columns (total 1 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Valor   1826 non-null   float64
dtypes: float64(1)
memory usage: 28.5 KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">#mirando los datos</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#objeto ts</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>Bitcoints <span class="op">=</span> data[<span class="st">'Valor'</span>]</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="bu">print</span>(<span class="bu">type</span>(Bitcoints))</span>
<span id="cb13-5"><a href="#cb13-5"></a>plt.plot(Bitcoints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-8-output-2.png" width="592" height="412"></p>
</div>
</div>
<p>Se tiene concocimieno de que los árboles no son buenos manejando la tendencia, pero debido análisis descriptivo previo utilizaremos el método tanto para la serie original cómo para la serie diferenciada la cuál no presenta tendencía. Ademas miraremos si se tienen datos faltantes y si es regularmente espaciada pues esto es importante en la implementaciòn del modelo</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>(data.index <span class="op">==</span> pd.date_range(start<span class="op">=</span>data.index.<span class="bu">min</span>(),</span>
<span id="cb17-2"><a href="#cb17-2"></a>                             end<span class="op">=</span>data.index.<span class="bu">max</span>(),</span>
<span id="cb17-3"><a href="#cb17-3"></a>                             freq<span class="op">=</span>data.index.freq)).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(1826, 1)</code></pre>
</div>
</div>
</section>
<section id="pacf" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="pacf"><span class="header-section-number">0.2</span> PACF</h2>
<p>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb21-3"><a href="#cb21-3"></a>plot_pacf(Bitcoints,lags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a>pyplot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-12-output-1.png" width="590" height="431"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb22-2"><a href="#cb22-2"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(Bitcoints, nlags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>T <span class="op">=</span> <span class="bu">len</span>(Bitcoints)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>pacf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([ 1.00000000e+00,  9.97420147e-01,  1.43160372e-02,  8.32568596e-03,
       -2.16200676e-02, -6.64909379e-02, -2.05655458e-02, -1.11736885e-02,
        2.64788871e-02,  1.88209990e-02, -1.95036725e-03, -3.88385078e-02,
        1.46649638e-02,  4.02839902e-02, -3.20071212e-02,  7.74967752e-03,
        8.32547029e-04, -3.67461933e-03, -2.23679602e-02,  3.46733025e-02,
       -1.44698212e-02, -3.65428193e-02,  4.56437447e-02, -1.61095969e-02,
       -1.14022513e-02, -2.79038247e-02, -6.17605219e-03, -5.56504201e-03,
       -2.17656400e-02, -9.49903080e-02,  8.18256708e-03, -2.54952528e-02,
       -4.40369560e-02,  5.88072667e-02, -4.49650306e-02,  1.84696791e-02,
        1.29335086e-02, -3.01602433e-02, -2.24434633e-02,  3.04122054e-03,
        2.43040409e-02, -6.97004162e-02,  1.49355410e-02,  3.10018773e-02,
       -1.10061127e-02, -7.95068046e-02,  1.24266404e-02, -1.13964700e-02,
       -4.03688623e-03,  1.55020918e-02,  1.70520860e-02,  1.74989043e-03,
        1.21015350e-02, -3.07520794e-02, -2.40427813e-02,  3.27927080e-02,
       -6.53037375e-03,  2.86474352e-02, -1.96808480e-02, -7.90078780e-02,
       -2.18795898e-02,  7.65068090e-02, -8.24179943e-03, -1.35019893e-02,
        2.53365289e-02,  3.52541195e-02, -8.01130656e-03, -3.91247489e-02,
       -4.42760666e-02,  3.52794241e-02,  3.73066297e-02, -1.08543965e-02,
       -1.17295344e-02, -6.29211466e-03,  4.27725260e-02,  1.80727993e-02,
       -2.17990186e-02,  1.05513512e-02,  3.66616603e-03,  2.96900412e-02,
       -1.55035039e-02, -5.30306130e-04, -4.40593353e-02,  3.84112629e-02,
       -6.68843658e-03,  7.77826673e-04,  1.31354302e-02, -8.62851872e-03,
        3.71172338e-02,  3.88706785e-03,  3.25068553e-02,  4.23596316e-02,
       -3.65463786e-03, -6.20868209e-03,  4.90171389e-02, -2.61232839e-03,
       -8.52400827e-03,  2.99264007e-03,  5.96575554e-03,  2.75967006e-02,
        1.76070503e-03,  1.60482324e-02,  8.28280601e-03, -3.97355197e-03,
       -4.20674978e-02, -3.28793301e-02,  3.38334033e-02,  1.58642323e-02,
        2.62085867e-02,  2.97071376e-03,  1.71855475e-02,  1.72643895e-02,
        3.05017035e-02, -1.35655469e-02, -5.31464285e-02, -1.75808674e-02,
       -5.71492462e-02, -6.12127146e-02,  1.42092759e-02, -4.54482085e-02,
        6.56194552e-02, -3.41984432e-03, -2.08306963e-02,  1.12317601e-03,
       -2.08718936e-02,  2.95680402e-04,  2.94274144e-02, -1.83342533e-02,
        1.23501400e-02, -5.31964809e-02,  1.88857866e-02,  6.64954781e-03,
       -1.43379447e-02, -2.82466048e-02,  3.64362606e-02,  2.78739121e-02,
        4.00735769e-02,  1.60950134e-02, -2.78719893e-02, -1.59682260e-02,
       -6.23924118e-03, -8.63544090e-03,  5.67106623e-02,  8.27328234e-03,
        4.69537337e-02,  7.33401221e-03,  9.90374812e-03, -2.04958984e-02,
        5.00599531e-02,  2.47099009e-02,  1.23689854e-02,  2.88242312e-02,
       -7.26544560e-03, -2.51611592e-03, -1.60389275e-02, -2.31570751e-04,
        3.27550941e-02,  3.31473878e-02, -1.59668082e-02,  1.28527880e-02,
       -1.45727877e-02,  4.27316691e-02,  1.82124277e-02,  1.63395166e-02,
       -1.86837948e-02,  4.88482302e-02, -1.57743652e-02, -3.09831365e-04,
       -1.89292664e-02, -1.65888742e-03,  1.63917403e-03, -1.30371168e-02,
       -2.33155335e-02, -2.96915098e-02, -2.06273374e-02,  4.11185718e-02,
       -1.54189343e-02,  1.44576365e-02, -3.76912726e-02,  6.90010391e-03,
       -5.77743500e-03, -1.40188637e-02, -4.60928488e-03,  2.17524133e-02,
       -7.82033891e-03, -1.92378986e-02, -3.05231074e-02,  8.28077748e-03,
       -2.11831058e-02,  1.41848402e-02, -2.97118304e-02, -2.10906457e-02,
       -1.51244719e-02, -4.85382690e-03, -1.91053390e-02, -3.03267295e-02,
        1.77146734e-02, -3.04039577e-02, -1.14836058e-02, -6.85499644e-03,
       -6.65167786e-03,  2.95699024e-03,  6.03414560e-03,  1.16911360e-02,
        1.40041081e-03, -6.76935135e-03, -1.99822959e-02,  5.51752430e-03,
       -2.10847546e-02, -7.18625743e-02,  8.63421171e-03, -1.10288853e-02,
       -2.25733934e-02,  1.37294158e-02,  6.89325437e-03, -2.29161625e-02,
        1.23999856e-02,  1.70546501e-02,  1.74117842e-03, -1.93238358e-02,
       -1.83998668e-02,  4.29486879e-02,  4.14616038e-03,  5.70185572e-02,
       -2.05325115e-02, -1.24786266e-03, -1.03254954e-02, -3.57573155e-02,
       -5.01515489e-02,  2.03704280e-02, -4.35929732e-02, -7.38676493e-03,
       -2.43014268e-02, -2.42638427e-02,  1.71087053e-02, -3.19742139e-02,
        1.44070451e-03, -2.16294341e-02,  1.64339276e-02,  3.88857254e-02,
       -1.35817837e-02, -3.72236303e-02,  1.70908329e-02, -4.42727962e-02,
        8.03853006e-03, -1.16607008e-03, -3.42341762e-02,  4.01871212e-02,
       -7.45536453e-05,  1.15154434e-02,  1.24299915e-02,  2.68021128e-02,
       -9.64315448e-03, -5.46141388e-03, -2.44323785e-03, -2.54014031e-02,
       -2.03952780e-03,  4.92366525e-03, -4.68436271e-03, -1.31835699e-02,
       -4.76821607e-02, -1.88930236e-02,  1.30503528e-02,  2.08437365e-02,
        1.33966358e-02,  1.13875457e-02,  2.48702460e-03, -3.67389694e-03,
        5.22529370e-03,  1.41512307e-02, -1.04593709e-02,  1.19960657e-02,
        2.30289603e-02, -1.29164094e-02, -6.84866454e-02,  4.79950896e-04,
        2.78088050e-02, -8.54368533e-03,  5.97798147e-03,  1.48702416e-02,
       -2.30013156e-02,  2.22415074e-02,  2.23569473e-02, -9.22784092e-03,
       -2.50679846e-02, -8.66007569e-03, -6.57708149e-02,  9.05987059e-03,
       -4.63119627e-03,  1.05235817e-02, -7.43702104e-03, -1.22062472e-02,
        4.11623022e-02, -2.23490333e-02, -3.17178546e-02,  3.45309242e-02,
        8.64316002e-03,  9.57089467e-03,  2.88525618e-02,  3.49899238e-02,
        2.21508425e-02,  3.72112010e-02,  1.16919064e-02,  1.77118242e-02,
       -3.24603405e-02,  1.27001670e-02, -4.74187985e-02,  4.00286316e-02,
       -2.58404466e-02, -3.07331701e-03, -7.81151761e-03, -2.90424255e-02,
        8.13580750e-03, -2.39895708e-02, -6.36117717e-03,  2.63070654e-03,
       -1.05461221e-02,  2.92048113e-02, -1.86299124e-04, -4.12830566e-03,
       -1.17998033e-02, -1.18160992e-02,  4.32107807e-04, -1.81627229e-02,
        1.98359185e-02,  1.00646166e-02, -1.26461222e-02, -2.60622704e-03,
        3.67424002e-02,  1.82104425e-03,  1.52220352e-02, -5.35907575e-03,
       -2.18962499e-04,  6.61174007e-04,  2.27252797e-02, -2.92407883e-03,
       -1.26736405e-02,  2.40680871e-02,  2.98768975e-03,  2.77788734e-02,
        3.46233953e-03,  3.36272793e-02, -8.12321169e-03, -1.54525772e-02,
       -3.43789613e-03,  3.29625701e-03, -1.72737662e-02, -3.50416112e-02,
       -2.10695692e-02,  2.04856817e-02,  5.33495766e-03,  1.70959501e-02,
       -4.01938437e-02, -1.96291282e-03, -1.60972712e-03, -2.82954716e-02,
       -3.12503945e-02, -8.00801978e-03, -3.75004791e-03, -9.50506474e-03,
        3.71845637e-02,  3.01580206e-02, -9.18347705e-03, -1.32259447e-02,
       -2.16457975e-02,  2.33490331e-02,  3.56516909e-03, -6.48253565e-03,
        3.82506917e-03,  2.36159112e-03,  5.84204891e-03,  2.04932024e-02,
        9.97363648e-03, -1.95683501e-02, -2.44179291e-02, -9.65308557e-03,
        9.34570056e-03,  2.66407297e-03, -3.36869156e-02,  1.24567631e-03,
        1.09435878e-02,  1.52749433e-02,  9.14501791e-03,  8.26701313e-03,
       -3.15384743e-03,  1.25007952e-02, -2.14876244e-02, -9.62489113e-03,
        7.88850820e-03,  1.95622459e-02, -2.08497673e-02, -1.14023050e-02,
        1.86448121e-02, -1.02349355e-02, -8.32842028e-03, -2.21430431e-02,
       -5.45592033e-03, -1.43473437e-02,  1.78245698e-02,  1.71387693e-02,
       -1.86369432e-03])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb25-3"><a href="#cb25-3"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb25-5"><a href="#cb25-5"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n_steps set to 1</code></pre>
</div>
</div>
<p>Observamos que con el <strong>pacf</strong> se nos recomienda usar solo un retraso el mas proximo, lo cuál nos recueda que cuando se quizo establecer una componente estacional se sugeria un periodo de 2.5, por lo tanto teniendo encuenta lo anterior usaremos <strong>3 retrasos</strong> para la serie original</p>
</section>
<section id="serie-trasnformada-y-diferenciada" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="serie-trasnformada-y-diferenciada"><span class="header-section-number">0.3</span> Serie Trasnformada y diferenciada</h2>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># tipo de datos</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="bu">print</span>(data_2.info())</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co"># nombre</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>data_2.columns <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'Valor'</span>]</span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="bu">print</span>(data_2.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1825 entries, 0 to 1824
Data columns (total 2 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   Unnamed: 0  1825 non-null   object 
 1   V1          1825 non-null   float64
dtypes: float64(1), object(1)
memory usage: 28.6+ KB
None
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1825 entries, 0 to 1824
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Fecha   1825 non-null   object 
 1   Valor   1825 non-null   float64
dtypes: float64(1), object(1)
memory usage: 28.6+ KB
None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># fecha</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>data_2[<span class="st">'Fecha'</span>]<span class="op">=</span>pd.to_datetime(data_2[<span class="st">'Fecha'</span>])<span class="co">###Sólo es necesario si no tiene formato de fecha</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>dlData <span class="op">=</span> data_2.set_index(<span class="st">'Fecha'</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a>dlData<span class="op">=</span>dlData.asfreq(<span class="st">'D'</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="bu">print</span>(<span class="bu">type</span>(dlData))</span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="bu">print</span>(dlData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
               Valor
Fecha               
2017-01-02  0.015202
2017-01-03  0.022321
2017-01-04  0.079290
2017-01-05 -0.121610
2017-01-06 -0.108785
...              ...
2021-12-27 -0.001440
2021-12-28 -0.064642
2021-12-29 -0.022546
2021-12-30  0.014255
2021-12-31 -0.020058

[1825 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">#objeto ts</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>dlDatats <span class="op">=</span> dlData[<span class="st">'Valor'</span>]</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="bu">print</span>(<span class="bu">type</span>(dlDatats))</span>
<span id="cb31-4"><a href="#cb31-4"></a>plt.plot(dlDatats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-18-output-2.png" width="582" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data_2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numero de filas con valores faltantes: 0.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>(dlData.index <span class="op">==</span> pd.date_range(start<span class="op">=</span>dlData.index.<span class="bu">min</span>(),</span>
<span id="cb35-2"><a href="#cb35-2"></a>                             end<span class="op">=</span>dlData.index.<span class="bu">max</span>(),</span>
<span id="cb35-3"><a href="#cb35-3"></a>                             freq<span class="op">=</span>dlData.index.freq)).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>dlData.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>(1825, 1)</code></pre>
</div>
</div>
</section>
<section id="pacf-1" class="level2" data-number="0.4">
<h2 data-number="0.4" class="anchored" data-anchor-id="pacf-1"><span class="header-section-number">0.4</span> PACF</h2>
<p>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</p>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb39-3"><a href="#cb39-3"></a>plot_pacf(dlDatats,lags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a>pyplot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-22-output-1.png" width="590" height="431"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>pacf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array([ 1.00000000e+00,  9.97420147e-01,  1.43160372e-02,  8.32568596e-03,
       -2.16200676e-02, -6.64909379e-02, -2.05655458e-02, -1.11736885e-02,
        2.64788871e-02,  1.88209990e-02, -1.95036725e-03, -3.88385078e-02,
        1.46649638e-02,  4.02839902e-02, -3.20071212e-02,  7.74967752e-03,
        8.32547029e-04, -3.67461933e-03, -2.23679602e-02,  3.46733025e-02,
       -1.44698212e-02, -3.65428193e-02,  4.56437447e-02, -1.61095969e-02,
       -1.14022513e-02, -2.79038247e-02, -6.17605219e-03, -5.56504201e-03,
       -2.17656400e-02, -9.49903080e-02,  8.18256708e-03, -2.54952528e-02,
       -4.40369560e-02,  5.88072667e-02, -4.49650306e-02,  1.84696791e-02,
        1.29335086e-02, -3.01602433e-02, -2.24434633e-02,  3.04122054e-03,
        2.43040409e-02, -6.97004162e-02,  1.49355410e-02,  3.10018773e-02,
       -1.10061127e-02, -7.95068046e-02,  1.24266404e-02, -1.13964700e-02,
       -4.03688623e-03,  1.55020918e-02,  1.70520860e-02,  1.74989043e-03,
        1.21015350e-02, -3.07520794e-02, -2.40427813e-02,  3.27927080e-02,
       -6.53037375e-03,  2.86474352e-02, -1.96808480e-02, -7.90078780e-02,
       -2.18795898e-02,  7.65068090e-02, -8.24179943e-03, -1.35019893e-02,
        2.53365289e-02,  3.52541195e-02, -8.01130656e-03, -3.91247489e-02,
       -4.42760666e-02,  3.52794241e-02,  3.73066297e-02, -1.08543965e-02,
       -1.17295344e-02, -6.29211466e-03,  4.27725260e-02,  1.80727993e-02,
       -2.17990186e-02,  1.05513512e-02,  3.66616603e-03,  2.96900412e-02,
       -1.55035039e-02, -5.30306130e-04, -4.40593353e-02,  3.84112629e-02,
       -6.68843658e-03,  7.77826673e-04,  1.31354302e-02, -8.62851872e-03,
        3.71172338e-02,  3.88706785e-03,  3.25068553e-02,  4.23596316e-02,
       -3.65463786e-03, -6.20868209e-03,  4.90171389e-02, -2.61232839e-03,
       -8.52400827e-03,  2.99264007e-03,  5.96575554e-03,  2.75967006e-02,
        1.76070503e-03,  1.60482324e-02,  8.28280601e-03, -3.97355197e-03,
       -4.20674978e-02, -3.28793301e-02,  3.38334033e-02,  1.58642323e-02,
        2.62085867e-02,  2.97071376e-03,  1.71855475e-02,  1.72643895e-02,
        3.05017035e-02, -1.35655469e-02, -5.31464285e-02, -1.75808674e-02,
       -5.71492462e-02, -6.12127146e-02,  1.42092759e-02, -4.54482085e-02,
        6.56194552e-02, -3.41984432e-03, -2.08306963e-02,  1.12317601e-03,
       -2.08718936e-02,  2.95680402e-04,  2.94274144e-02, -1.83342533e-02,
        1.23501400e-02, -5.31964809e-02,  1.88857866e-02,  6.64954781e-03,
       -1.43379447e-02, -2.82466048e-02,  3.64362606e-02,  2.78739121e-02,
        4.00735769e-02,  1.60950134e-02, -2.78719893e-02, -1.59682260e-02,
       -6.23924118e-03, -8.63544090e-03,  5.67106623e-02,  8.27328234e-03,
        4.69537337e-02,  7.33401221e-03,  9.90374812e-03, -2.04958984e-02,
        5.00599531e-02,  2.47099009e-02,  1.23689854e-02,  2.88242312e-02,
       -7.26544560e-03, -2.51611592e-03, -1.60389275e-02, -2.31570751e-04,
        3.27550941e-02,  3.31473878e-02, -1.59668082e-02,  1.28527880e-02,
       -1.45727877e-02,  4.27316691e-02,  1.82124277e-02,  1.63395166e-02,
       -1.86837948e-02,  4.88482302e-02, -1.57743652e-02, -3.09831365e-04,
       -1.89292664e-02, -1.65888742e-03,  1.63917403e-03, -1.30371168e-02,
       -2.33155335e-02, -2.96915098e-02, -2.06273374e-02,  4.11185718e-02,
       -1.54189343e-02,  1.44576365e-02, -3.76912726e-02,  6.90010391e-03,
       -5.77743500e-03, -1.40188637e-02, -4.60928488e-03,  2.17524133e-02,
       -7.82033891e-03, -1.92378986e-02, -3.05231074e-02,  8.28077748e-03,
       -2.11831058e-02,  1.41848402e-02, -2.97118304e-02, -2.10906457e-02,
       -1.51244719e-02, -4.85382690e-03, -1.91053390e-02, -3.03267295e-02,
        1.77146734e-02, -3.04039577e-02, -1.14836058e-02, -6.85499644e-03,
       -6.65167786e-03,  2.95699024e-03,  6.03414560e-03,  1.16911360e-02,
        1.40041081e-03, -6.76935135e-03, -1.99822959e-02,  5.51752430e-03,
       -2.10847546e-02, -7.18625743e-02,  8.63421171e-03, -1.10288853e-02,
       -2.25733934e-02,  1.37294158e-02,  6.89325437e-03, -2.29161625e-02,
        1.23999856e-02,  1.70546501e-02,  1.74117842e-03, -1.93238358e-02,
       -1.83998668e-02,  4.29486879e-02,  4.14616038e-03,  5.70185572e-02,
       -2.05325115e-02, -1.24786266e-03, -1.03254954e-02, -3.57573155e-02,
       -5.01515489e-02,  2.03704280e-02, -4.35929732e-02, -7.38676493e-03,
       -2.43014268e-02, -2.42638427e-02,  1.71087053e-02, -3.19742139e-02,
        1.44070451e-03, -2.16294341e-02,  1.64339276e-02,  3.88857254e-02,
       -1.35817837e-02, -3.72236303e-02,  1.70908329e-02, -4.42727962e-02,
        8.03853006e-03, -1.16607008e-03, -3.42341762e-02,  4.01871212e-02,
       -7.45536453e-05,  1.15154434e-02,  1.24299915e-02,  2.68021128e-02,
       -9.64315448e-03, -5.46141388e-03, -2.44323785e-03, -2.54014031e-02,
       -2.03952780e-03,  4.92366525e-03, -4.68436271e-03, -1.31835699e-02,
       -4.76821607e-02, -1.88930236e-02,  1.30503528e-02,  2.08437365e-02,
        1.33966358e-02,  1.13875457e-02,  2.48702460e-03, -3.67389694e-03,
        5.22529370e-03,  1.41512307e-02, -1.04593709e-02,  1.19960657e-02,
        2.30289603e-02, -1.29164094e-02, -6.84866454e-02,  4.79950896e-04,
        2.78088050e-02, -8.54368533e-03,  5.97798147e-03,  1.48702416e-02,
       -2.30013156e-02,  2.22415074e-02,  2.23569473e-02, -9.22784092e-03,
       -2.50679846e-02, -8.66007569e-03, -6.57708149e-02,  9.05987059e-03,
       -4.63119627e-03,  1.05235817e-02, -7.43702104e-03, -1.22062472e-02,
        4.11623022e-02, -2.23490333e-02, -3.17178546e-02,  3.45309242e-02,
        8.64316002e-03,  9.57089467e-03,  2.88525618e-02,  3.49899238e-02,
        2.21508425e-02,  3.72112010e-02,  1.16919064e-02,  1.77118242e-02,
       -3.24603405e-02,  1.27001670e-02, -4.74187985e-02,  4.00286316e-02,
       -2.58404466e-02, -3.07331701e-03, -7.81151761e-03, -2.90424255e-02,
        8.13580750e-03, -2.39895708e-02, -6.36117717e-03,  2.63070654e-03,
       -1.05461221e-02,  2.92048113e-02, -1.86299124e-04, -4.12830566e-03,
       -1.17998033e-02, -1.18160992e-02,  4.32107807e-04, -1.81627229e-02,
        1.98359185e-02,  1.00646166e-02, -1.26461222e-02, -2.60622704e-03,
        3.67424002e-02,  1.82104425e-03,  1.52220352e-02, -5.35907575e-03,
       -2.18962499e-04,  6.61174007e-04,  2.27252797e-02, -2.92407883e-03,
       -1.26736405e-02,  2.40680871e-02,  2.98768975e-03,  2.77788734e-02,
        3.46233953e-03,  3.36272793e-02, -8.12321169e-03, -1.54525772e-02,
       -3.43789613e-03,  3.29625701e-03, -1.72737662e-02, -3.50416112e-02,
       -2.10695692e-02,  2.04856817e-02,  5.33495766e-03,  1.70959501e-02,
       -4.01938437e-02, -1.96291282e-03, -1.60972712e-03, -2.82954716e-02,
       -3.12503945e-02, -8.00801978e-03, -3.75004791e-03, -9.50506474e-03,
        3.71845637e-02,  3.01580206e-02, -9.18347705e-03, -1.32259447e-02,
       -2.16457975e-02,  2.33490331e-02,  3.56516909e-03, -6.48253565e-03,
        3.82506917e-03,  2.36159112e-03,  5.84204891e-03,  2.04932024e-02,
        9.97363648e-03, -1.95683501e-02, -2.44179291e-02, -9.65308557e-03,
        9.34570056e-03,  2.66407297e-03, -3.36869156e-02,  1.24567631e-03,
        1.09435878e-02,  1.52749433e-02,  9.14501791e-03,  8.26701313e-03,
       -3.15384743e-03,  1.25007952e-02, -2.14876244e-02, -9.62489113e-03,
        7.88850820e-03,  1.95622459e-02, -2.08497673e-02, -1.14023050e-02,
        1.86448121e-02, -1.02349355e-02, -8.32842028e-03, -2.21430431e-02,
       -5.45592033e-03, -1.43473437e-02,  1.78245698e-02,  1.71387693e-02,
       -1.86369432e-03])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb42-2"><a href="#cb42-2"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb42-3"><a href="#cb42-3"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb42-5"><a href="#cb42-5"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n_steps set to 1</code></pre>
</div>
</div>
<p>Vemos que para la serie diferencidad tenemos un resultado igual que para la serie original, asì tomaremos lo mismo <strong>3 retrasos</strong></p>
</section>
<section id="árboles-de-decisión" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Árboles de decisión</h1>
<section id="creación-de-los-rezagos" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1" class="anchored" data-anchor-id="creación-de-los-rezagos"><span class="header-section-number">1.0.1</span> Creación de los rezagos</h3>
<p>Debido al análisis previo tomaremos los rezagos de 3 días atrás para poder predecir un paso adelante.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="bu">print</span>(df1)</span>
<span id="cb44-6"><a href="#cb44-6"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: []
Index: []
Empty DataFrame
Columns: []
Index: []</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos Elimnada STL</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2017'</span>, periods<span class="op">=</span><span class="dv">1826</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="bu">print</span>(indice)</span>
<span id="cb46-4"><a href="#cb46-4"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Valor'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="bu">print</span>(originalDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2017-01-01', '2017-01-02', '2017-01-03', '2017-01-04',
               '2017-01-05', '2017-01-06', '2017-01-07', '2017-01-08',
               '2017-01-09', '2017-01-10',
               ...
               '2021-12-22', '2021-12-23', '2021-12-24', '2021-12-25',
               '2021-12-26', '2021-12-27', '2021-12-28', '2021-12-29',
               '2021-12-30', '2021-12-31'],
              dtype='datetime64[ns]', length=1826, freq='D')
                   0
2017-01-01    998.80
2017-01-02   1014.10
2017-01-03   1036.99
2017-01-04   1122.56
2017-01-05    994.02
...              ...
2021-12-27  50718.11
2021-12-28  47543.30
2021-12-29  46483.36
2021-12-30  47150.71
2021-12-31  46214.37

[1826 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># arreglo de datos para el arreglo de rezagos diferenciada</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>indice_2 <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/2/2017'</span>, periods<span class="op">=</span><span class="dv">1825</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="bu">print</span>(indice_2)</span>
<span id="cb48-4"><a href="#cb48-4"></a>dlDatadf <span class="op">=</span> pd.DataFrame(data_2[<span class="st">'Valor'</span>].values,index<span class="op">=</span>indice_2)</span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="bu">print</span>(dlDatadf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2017-01-02', '2017-01-03', '2017-01-04', '2017-01-05',
               '2017-01-06', '2017-01-07', '2017-01-08', '2017-01-09',
               '2017-01-10', '2017-01-11',
               ...
               '2021-12-22', '2021-12-23', '2021-12-24', '2021-12-25',
               '2021-12-26', '2021-12-27', '2021-12-28', '2021-12-29',
               '2021-12-30', '2021-12-31'],
              dtype='datetime64[ns]', length=1825, freq='D')
                   0
2017-01-02  0.015202
2017-01-03  0.022321
2017-01-04  0.079290
2017-01-05 -0.121610
2017-01-06 -0.108785
...              ...
2021-12-27 -0.001440
2021-12-28 -0.064642
2021-12-29 -0.022546
2021-12-30  0.014255
2021-12-31 -0.020058

[1825 rows x 1 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Rezagos original</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb50-3"><a href="#cb50-3"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="bu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-3       t-2       t-1
2017-01-01       NaN       NaN       NaN
2017-01-02       NaN       NaN    998.80
2017-01-03       NaN    998.80   1014.10
2017-01-04    998.80   1014.10   1036.99
2017-01-05   1014.10   1036.99   1122.56
...              ...       ...       ...
2021-12-27  50841.48  50442.22  50791.21
2021-12-28  50442.22  50791.21  50718.11
2021-12-29  50791.21  50718.11  47543.30
2021-12-30  50718.11  47543.30  46483.36
2021-12-31  47543.30  46483.36  47150.71

[1826 rows x 3 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># REzagos diferenciada</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb52-3"><a href="#cb52-3"></a>    df2[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> dlDatadf.shift(i)</span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="bu">print</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-3       t-2       t-1
2017-01-02       NaN       NaN       NaN
2017-01-03       NaN       NaN  0.015202
2017-01-04       NaN  0.015202  0.022321
2017-01-05  0.015202  0.022321  0.079290
2017-01-06  0.022321  0.079290 -0.121610
...              ...       ...       ...
2021-12-27 -0.000168 -0.007884  0.006895
2021-12-28 -0.007884  0.006895 -0.001440
2021-12-29  0.006895 -0.001440 -0.064642
2021-12-30 -0.001440 -0.064642 -0.022546
2021-12-31 -0.064642 -0.022546  0.014255

[1825 rows x 3 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Create column t original</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                t-3      t-2      t-1        t
2017-01-01      NaN      NaN      NaN   998.80
2017-01-02      NaN      NaN   998.80  1014.10
2017-01-03      NaN   998.80  1014.10  1036.99
2017-01-04   998.80  1014.10  1036.99  1122.56
2017-01-05  1014.10  1036.99  1122.56   994.02
2017-01-06  1036.99  1122.56   994.02   891.56
2017-01-07  1122.56   994.02   891.56   897.14
2017-01-08   994.02   891.56   897.14   906.17
2017-01-09   891.56   897.14   906.17   899.99
2017-01-10   897.14   906.17   899.99   907.96
2017-01-11   906.17   899.99   907.96   788.81
2017-01-12   899.99   907.96   788.81   816.00
2017-01-13   907.96   788.81   816.00   826.90
2017-01-14   788.81   816.00   826.90   819.66</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Create column t diferenciada</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>df2[<span class="st">'t'</span>] <span class="op">=</span> dlDatadf.values</span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="bu">print</span>(df2.head(<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-3       t-2       t-1         t
2017-01-02       NaN       NaN       NaN  0.015202
2017-01-03       NaN       NaN  0.015202  0.022321
2017-01-04       NaN  0.015202  0.022321  0.079290
2017-01-05  0.015202  0.022321  0.079290 -0.121610
2017-01-06  0.022321  0.079290 -0.121610 -0.108785
2017-01-07  0.079290 -0.121610 -0.108785  0.006239
2017-01-08 -0.121610 -0.108785  0.006239  0.010015
2017-01-09 -0.108785  0.006239  0.010015 -0.006843
2017-01-10  0.006239  0.010015 -0.006843  0.008817
2017-01-11  0.010015 -0.006843  0.008817 -0.140675
2017-01-12 -0.006843  0.008817 -0.140675  0.033889
2017-01-13  0.008817 -0.140675  0.033889  0.013269
2017-01-14 -0.140675  0.033889  0.013269 -0.008794
2017-01-15  0.033889  0.013269 -0.008794  0.003422</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 7 rows original</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">3</span>:]</span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb58-4"><a href="#cb58-4"></a>df1_Ori.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-3       t-2       t-1         t
2017-01-04    998.80   1014.10   1036.99   1122.56
2017-01-05   1014.10   1036.99   1122.56    994.02
2017-01-06   1036.99   1122.56    994.02    891.56
2017-01-07   1122.56    994.02    891.56    897.14
2017-01-08    994.02    891.56    897.14    906.17
...              ...       ...       ...       ...
2021-12-27  50841.48  50442.22  50791.21  50718.11
2021-12-28  50442.22  50791.21  50718.11  47543.30
2021-12-29  50791.21  50718.11  47543.30  46483.36
2021-12-30  50718.11  47543.30  46483.36  47150.71
2021-12-31  47543.30  46483.36  47150.71  46214.37

[1823 rows x 4 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>7292</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 7 rows diferenciada</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>df2_Dif <span class="op">=</span> df2[<span class="dv">3</span>:]</span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="bu">print</span>(df2_Dif)</span>
<span id="cb61-4"><a href="#cb61-4"></a>df2_Dif.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 t-3       t-2       t-1         t
2017-01-05  0.015202  0.022321  0.079290 -0.121610
2017-01-06  0.022321  0.079290 -0.121610 -0.108785
2017-01-07  0.079290 -0.121610 -0.108785  0.006239
2017-01-08 -0.121610 -0.108785  0.006239  0.010015
2017-01-09 -0.108785  0.006239  0.010015 -0.006843
...              ...       ...       ...       ...
2021-12-27 -0.000168 -0.007884  0.006895 -0.001440
2021-12-28 -0.007884  0.006895 -0.001440 -0.064642
2021-12-29  0.006895 -0.001440 -0.064642 -0.022546
2021-12-30 -0.001440 -0.064642 -0.022546  0.014255
2021-12-31 -0.064642 -0.022546  0.014255 -0.020058

[1822 rows x 4 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>7288</code></pre>
</div>
</div>
<p>hemos creado lo necesario para tener los 3 rezagos y la prediccion un paso adelante ahora. así tenemos los modelos : 1. Para los datos originales <span class="math display">\[y_{t} = f(y_{t-1},y_{t-2},y_{t-3}) + \epsilon\]</span> 2. Para la serie con estabilización de varianza y difereciada <span class="math display">\[\Delta y_t = f(\Delta y_{t-1}, \Delta y_{t-2}, \Delta y_{t-3}) + \epsilon\]</span></p>
</section>
<section id="división-de-los-datos" class="level3" data-number="1.0.2">
<h3 data-number="1.0.2" class="anchored" data-anchor-id="división-de-los-datos"><span class="header-section-number">1.0.2</span> División de los datos</h3>
<div class="cell" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Split data Eliminada</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="bu">print</span>(X1)</span>
<span id="cb64-7"><a href="#cb64-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[  998.8   1014.1   1036.99]
 [ 1014.1   1036.99  1122.56]
 [ 1036.99  1122.56   994.02]
 ...
 [50791.21 50718.11 47543.3 ]
 [50718.11 47543.3  46483.36]
 [47543.3  46483.36 47150.71]]
Respuestas 
 [ 1122.56   994.02   891.56 ... 46483.36 47150.71 46214.37]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Split data Diferenciada</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>Dife_Split <span class="op">=</span> df2_Dif.values</span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>X2 <span class="op">=</span> Dife_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>y2 <span class="op">=</span> Dife_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb66-6"><a href="#cb66-6"></a><span class="bu">print</span>(X2)</span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.01520224  0.02232077  0.07928951]
 [ 0.02232077  0.07928951 -0.12160974]
 [ 0.07928951 -0.12160974 -0.10878459]
 ...
 [ 0.00689479 -0.00144026 -0.06464217]
 [-0.00144026 -0.06464217 -0.02254648]
 [-0.06464217 -0.02254648  0.01425467]]
Respuestas 
 [-0.12160974 -0.10878459  0.00623919 ... -0.02254648  0.01425467
 -0.02005828]</code></pre>
</div>
</div>
</section>
</section>
<section id="árbol-para-datos-originales" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Árbol para datos originales</h1>
<section id="entrenamiento-validación-y-prueba" class="level4" data-number="2.0.0.1">
<h4 data-number="2.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba"><span class="header-section-number">2.0.0.1</span> Entrenamiento, Validación y prueba</h4>
<div class="cell" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb68-3"><a href="#cb68-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb68-4"><a href="#cb68-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 1823
1276 183 364
Train + Validation + Test: 1823</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb70-3"><a href="#cb70-3"></a></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb70-5"><a href="#cb70-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb70-7"><a href="#cb70-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 1823
Training Observations for Target: 1276
Validation Observations for Target: 183
Test Observations for Target: 364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb72-2"><a href="#cb72-2"></a></span>
<span id="cb72-3"><a href="#cb72-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb72-4"><a href="#cb72-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb72-5"><a href="#cb72-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb72-6"><a href="#cb72-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb72-7"><a href="#cb72-7"></a></span>
<span id="cb72-8"><a href="#cb72-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb72-9"><a href="#cb72-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb72-10"><a href="#cb72-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb72-11"><a href="#cb72-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 1823
Training Observations for Feature: 1276
Validation Observations for Feature: 183
Test Observations for Feature: 364</code></pre>
</div>
</div>
</section>
<section id="árbol" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="árbol"><span class="header-section-number">2.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb74-7"><a href="#cb74-7"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb74-8"><a href="#cb74-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb74-9"><a href="#cb74-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb74-10"><a href="#cb74-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb74-11"><a href="#cb74-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de Validación: 0.697469135281228
el RECM sobre validación es: 6824360.155536612</code></pre>
</div>
</div>
<p>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</p>
<div class="cell" data-execution_count="39">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb76-2"><a href="#cb76-2"></a></span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb76-7"><a href="#cb76-7"></a></span>
<span id="cb76-8"><a href="#cb76-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb76-9"><a href="#cb76-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb76-10"><a href="#cb76-10"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb76-11"><a href="#cb76-11"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb76-12"><a href="#cb76-12"></a>    </span>
<span id="cb76-13"><a href="#cb76-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb76-14"><a href="#cb76-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb76-15"><a href="#cb76-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb76-16"><a href="#cb76-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb76-17"><a href="#cb76-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.8641833855804382
Coeficiente R2 sobre el conjunto de validación: -0.3096623317395266 

el RECM sobre el conjunto de validación es: 5435.328452325418
max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9651805280470427
Coeficiente R2 sobre el conjunto de validación: 0.46422772719484806 

el RECM sobre el conjunto de validación es: 3476.452037988641
max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9846904732982006
Coeficiente R2 sobre el conjunto de validación: 0.6773389398995682 

el RECM sobre el conjunto de validación es: 2697.859963056876
max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9891809414001131
Coeficiente R2 sobre el conjunto de validación: 0.7663366686101318 

el RECM sobre el conjunto de validación es: 2295.8388837097596
max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9918052290572952
Coeficiente R2 sobre el conjunto de validación: 0.6785792116131668 

el RECM sobre el conjunto de validación es: 2692.669840210029
max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9939577729677915
Coeficiente R2 sobre el conjunto de validación: 0.7134404751454829 

el RECM sobre el conjunto de validación es: 2542.4566056238273
max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9952892190117961
Coeficiente R2 sobre el conjunto de validación: 0.7122730245872446 

el RECM sobre el conjunto de validación es: 2547.630356880796
max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9969206521928918
Coeficiente R2 sobre el conjunto de validación: 0.7087139369031451 

el RECM sobre el conjunto de validación es: 2563.3386028920927
max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9980208435086566
Coeficiente R2 sobre el conjunto de validación: 0.7075812987165642 

el RECM sobre el conjunto de validación es: 2568.317417007087
max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9987905600593933
Coeficiente R2 sobre el conjunto de validación: 0.7093182749314967 

el RECM sobre el conjunto de validación es: 2560.6781128640946
max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9992227814144231
Coeficiente R2 sobre el conjunto de validación: 0.7023942523309804 

el RECM sobre el conjunto de validación es: 2590.996236826548
max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9995167904154337
Coeficiente R2 sobre el conjunto de validación: 0.6958069558601423 

el RECM sobre el conjunto de validación es: 2619.514244792769
max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9997624797203807
Coeficiente R2 sobre el conjunto de validación: 0.7000391436415081 

el RECM sobre el conjunto de validación es: 2601.227983196671
max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 0.9998629094815242
Coeficiente R2 sobre el conjunto de validación: 0.7057748189347055 

el RECM sobre el conjunto de validación es: 2576.238370696423</code></pre>
</div>
</div>
<p>Note que el score mayor para el conjunto de validación es para max depth = 5. después este valor el R2 comienza a oscilar en valores cercanos a 0.7. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</p>
<div class="cell" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="co">#######</span></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="co">####</span></span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb78-8"><a href="#cb78-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb78-9"><a href="#cb78-9"></a><span class="co">#####</span></span>
<span id="cb78-10"><a href="#cb78-10"></a><span class="co">####</span></span>
<span id="cb78-11"><a href="#cb78-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb78-12"><a href="#cb78-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb78-13"><a href="#cb78-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb78-14"><a href="#cb78-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb78-15"><a href="#cb78-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb78-16"><a href="#cb78-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb78-17"><a href="#cb78-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(1276, 3)
(183, 3)
(1276,)
(183,)
(1459, 3)
(1459,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb80-2"><a href="#cb80-2"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">5</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb80-3"><a href="#cb80-3"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb80-4"><a href="#cb80-4"></a></span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb80-6"><a href="#cb80-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb80-7"><a href="#cb80-7"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb80-8"><a href="#cb80-8"></a></span>
<span id="cb80-9"><a href="#cb80-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb80-10"><a href="#cb80-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb80-11"><a href="#cb80-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb80-12"><a href="#cb80-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb80-13"><a href="#cb80-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb80-14"><a href="#cb80-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb80-15"><a href="#cb80-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb80-16"><a href="#cb80-16"></a>plt.legend()</span>
<span id="cb80-17"><a href="#cb80-17"></a>plt.show()</span>
<span id="cb80-18"><a href="#cb80-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb80-19"><a href="#cb80-19"></a></span>
<span id="cb80-20"><a href="#cb80-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-42-output-1.png" width="623" height="430"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 379.6739573163321
Raíz de la Pérdida cuadrática Prueba: 20803.68301403984</code></pre>
</div>
</div>
<p>Vemos que el RECM es menor para el entrenamiento y mayor para la prubea lo cuál podría indicar sobre ajuste pero notamos en el gráfico que para los valores de prueba se queda con la ultimá predicción dada para el entrenamiento</p>
<div class="cell" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb82-2"><a href="#cb82-2"></a></span>
<span id="cb82-3"><a href="#cb82-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb82-4"><a href="#cb82-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb82-5"><a href="#cb82-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_2 &lt;= 7621.53
|   |--- feature_2 &lt;= 4674.63
|   |   |--- feature_2 &lt;= 2643.52
|   |   |   |--- feature_2 &lt;= 1603.78
|   |   |   |   |--- feature_2 &lt;= 1123.59
|   |   |   |   |   |--- value: [978.62]
|   |   |   |   |--- feature_2 &gt;  1123.59
|   |   |   |   |   |--- value: [1257.23]
|   |   |   |--- feature_2 &gt;  1603.78
|   |   |   |   |--- feature_2 &lt;= 2029.78
|   |   |   |   |   |--- value: [1867.15]
|   |   |   |   |--- feature_2 &gt;  2029.78
|   |   |   |   |   |--- value: [2443.26]
|   |   |--- feature_2 &gt;  2643.52
|   |   |   |--- feature_2 &lt;= 3479.78
|   |   |   |   |--- feature_2 &lt;= 3066.88
|   |   |   |   |   |--- value: [2757.72]
|   |   |   |   |--- feature_2 &gt;  3066.88
|   |   |   |   |   |--- value: [3403.13]
|   |   |   |--- feature_2 &gt;  3479.78
|   |   |   |   |--- feature_2 &lt;= 4124.92
|   |   |   |   |   |--- value: [3821.26]
|   |   |   |   |--- feature_2 &gt;  4124.92
|   |   |   |   |   |--- value: [4341.35]
|   |--- feature_2 &gt;  4674.63
|   |   |--- feature_2 &lt;= 6267.99
|   |   |   |--- feature_2 &lt;= 5638.17
|   |   |   |   |--- feature_2 &lt;= 5364.32
|   |   |   |   |   |--- value: [5146.57]
|   |   |   |   |--- feature_2 &gt;  5364.32
|   |   |   |   |   |--- value: [5511.71]
|   |   |   |--- feature_2 &gt;  5638.17
|   |   |   |   |--- feature_1 &lt;= 6101.82
|   |   |   |   |   |--- value: [5911.09]
|   |   |   |   |--- feature_1 &gt;  6101.82
|   |   |   |   |   |--- value: [6228.33]
|   |   |--- feature_2 &gt;  6267.99
|   |   |   |--- feature_2 &lt;= 6773.45
|   |   |   |   |--- feature_2 &lt;= 6592.66
|   |   |   |   |   |--- value: [6447.39]
|   |   |   |   |--- feature_2 &gt;  6592.66
|   |   |   |   |   |--- value: [6709.36]
|   |   |   |--- feature_2 &gt;  6773.45
|   |   |   |   |--- feature_2 &lt;= 6938.52
|   |   |   |   |   |--- value: [6920.69]
|   |   |   |   |--- feature_2 &gt;  6938.52
|   |   |   |   |   |--- value: [7315.07]
|--- feature_2 &gt;  7621.53
|   |--- feature_2 &lt;= 13615.27
|   |   |--- feature_2 &lt;= 9928.84
|   |   |   |--- feature_2 &lt;= 8704.25
|   |   |   |   |--- feature_2 &lt;= 8228.69
|   |   |   |   |   |--- value: [7969.37]
|   |   |   |   |--- feature_2 &gt;  8228.69
|   |   |   |   |   |--- value: [8465.67]
|   |   |   |--- feature_2 &gt;  8704.25
|   |   |   |   |--- feature_2 &lt;= 9383.12
|   |   |   |   |   |--- value: [9087.07]
|   |   |   |   |--- feature_2 &gt;  9383.12
|   |   |   |   |   |--- value: [9638.44]
|   |   |--- feature_2 &gt;  9928.84
|   |   |   |--- feature_2 &lt;= 10969.25
|   |   |   |   |--- feature_2 &lt;= 10506.95
|   |   |   |   |   |--- value: [10273.00]
|   |   |   |   |--- feature_2 &gt;  10506.95
|   |   |   |   |   |--- value: [10710.85]
|   |   |   |--- feature_2 &gt;  10969.25
|   |   |   |   |--- feature_1 &lt;= 12789.33
|   |   |   |   |   |--- value: [11533.88]
|   |   |   |   |--- feature_1 &gt;  12789.33
|   |   |   |   |   |--- value: [13198.58]
|   |--- feature_2 &gt;  13615.27
|   |   |--- feature_2 &lt;= 20532.94
|   |   |   |--- feature_2 &lt;= 16687.31
|   |   |   |   |--- feature_2 &lt;= 15071.83
|   |   |   |   |   |--- value: [14419.04]
|   |   |   |   |--- feature_2 &gt;  15071.83
|   |   |   |   |   |--- value: [15735.35]
|   |   |   |--- feature_2 &gt;  16687.31
|   |   |   |   |--- feature_2 &lt;= 17805.71
|   |   |   |   |   |--- value: [17530.87]
|   |   |   |   |--- feature_2 &gt;  17805.71
|   |   |   |   |   |--- value: [18875.22]
|   |   |--- feature_2 &gt;  20532.94
|   |   |   |--- feature_2 &lt;= 24274.07
|   |   |   |   |--- feature_0 &lt;= 23652.97
|   |   |   |   |   |--- value: [23281.46]
|   |   |   |   |--- feature_0 &gt;  23652.97
|   |   |   |   |   |--- value: [24270.12]
|   |   |   |--- feature_2 &gt;  24274.07
|   |   |   |   |--- feature_2 &lt;= 27203.96
|   |   |   |   |   |--- value: [26783.45]
|   |   |   |   |--- feature_2 &gt;  27203.96
|   |   |   |   |   |--- value: [29092.24]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb84-2"><a href="#cb84-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb84-3"><a href="#cb84-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb84-4"><a href="#cb84-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb84-5"><a href="#cb84-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-44-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</p>
<div class="cell" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb85-3"><a href="#cb85-3"></a></span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb85-5"><a href="#cb85-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1459
1459
364
364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">1459</span>]</span>
<span id="cb87-4"><a href="#cb87-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>:<span class="dv">1823</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1823</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1459
364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb91-2"><a href="#cb91-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1823
1823</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb93-2"><a href="#cb93-2"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb93-3"><a href="#cb93-3"></a>ObsvsPred1.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-04</td>
<td>1122.56</td>
<td>978.616119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-05</td>
<td>994.02</td>
<td>978.616119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-06</td>
<td>891.56</td>
<td>978.616119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-07</td>
<td>897.14</td>
<td>978.616119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-08</td>
<td>906.17</td>
<td>978.616119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-09</td>
<td>899.99</td>
<td>978.616119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-10</td>
<td>907.96</td>
<td>978.616119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-11</td>
<td>788.81</td>
<td>978.616119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-12</td>
<td>816.00</td>
<td>978.616119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-13</td>
<td>826.90</td>
<td>978.616119</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a><span class="co">#gráfico</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb94-3"><a href="#cb94-3"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb94-5"><a href="#cb94-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb94-6"><a href="#cb94-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>plt.legend()</span>
<span id="cb94-8"><a href="#cb94-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-50-output-1.png" width="815" height="485"></p>
</div>
</div>
<p>Podemos observar que como nos anticipaba el RECM en el entrenamiento las predicciones son cercanas al valor real, pero para los datos de prueba se queda con lo ultimo visto para el entrenamiento sin tener encuenta el comportamiento de la serie.</p>
</section>
</section>
<section id="árbol-para-datos-diferenciados" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Árbol para datos Diferenciados</h1>
<section id="entrenamiento-validación-y-prueba-diferenciada" class="level4" data-number="3.0.0.1">
<h4 data-number="3.0.0.1" class="anchored" data-anchor-id="entrenamiento-validación-y-prueba-diferenciada"><span class="header-section-number">3.0.0.1</span> Entrenamiento, Validación y prueba (Diferenciada)</h4>
<div class="cell" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>Y2 <span class="op">=</span> y2</span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y2))</span>
<span id="cb95-3"><a href="#cb95-3"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb95-4"><a href="#cb95-4"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb95-5"><a href="#cb95-5"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb95-6"><a href="#cb95-6"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb95-7"><a href="#cb95-7"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete Observations for Target after Supervised configuration: 1822
1275 183 364
Train + Validation + Test: 1822</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>train_target, val_target,test_target <span class="op">=</span> Y2[<span class="dv">0</span>:traintarget_size], Y2[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y2[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y2)]</span>
<span id="cb97-3"><a href="#cb97-3"></a></span>
<span id="cb97-4"><a href="#cb97-4"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y2)))</span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb97-6"><a href="#cb97-6"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb97-7"><a href="#cb97-7"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Target: 1822
Training Observations for Target: 1275
Validation Observations for Target: 183
Test Observations for Target: 364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb99-2"><a href="#cb99-2"></a></span>
<span id="cb99-3"><a href="#cb99-3"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb99-4"><a href="#cb99-4"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">2</span><span class="co"># Set split</span></span>
<span id="cb99-5"><a href="#cb99-5"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>train_feature, val_feature,test_feature <span class="op">=</span> X2[<span class="dv">0</span>:traintarget_size],X2[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X2[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y2)]</span>
<span id="cb99-7"><a href="#cb99-7"></a></span>
<span id="cb99-8"><a href="#cb99-8"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X2)))</span>
<span id="cb99-9"><a href="#cb99-9"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb99-10"><a href="#cb99-10"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb99-11"><a href="#cb99-11"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observations for Feature: 1822
Training Observations for Feature: 1275
Validation Observations for Feature: 183
Test Observations for Feature: 364</code></pre>
</div>
</div>
</section>
<section id="árbol-1" class="level3" data-number="3.0.1">
<h3 data-number="3.0.1" class="anchored" data-anchor-id="árbol-1"><span class="header-section-number">3.0.1</span> Árbol</h3>
<div class="cell" data-execution_count="53">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb101-4"><a href="#cb101-4"></a>decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb101-5"><a href="#cb101-5"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb101-6"><a href="#cb101-6"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb101-7"><a href="#cb101-7"></a>decision_tree_Dif.fit(train_feature, train_target)</span>
<span id="cb101-8"><a href="#cb101-8"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb101-9"><a href="#cb101-9"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Dif.score(train_feature, train_target))</span>
<span id="cb101-10"><a href="#cb101-10"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Dif.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb101-11"><a href="#cb101-11"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Dif.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente R2 sobre el conjunto de entrenamiento: 1.0
Coeficiente R2 sobre el conjunto de Validación: -1.834601734864465
el RECM sobre validación es: 0.002291340627241473</code></pre>
</div>
</div>
<p>Vemos que el <span class="math inline">\(R^2\)</span> en la validaciòn nos da negativo lo cual indica que el modelo es malo en las predicciones, pues es mejor predecir con la media cal sería un <span class="math inline">\(R^2 = 0\)</span>. intentaremos ajustar la profundidad del árbol para ver si mejoramos esto.</p>
<div class="cell" data-execution_count="54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb103-2"><a href="#cb103-2"></a></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb103-7"><a href="#cb103-7"></a></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb103-9"><a href="#cb103-9"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb103-10"><a href="#cb103-10"></a>    decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb103-11"><a href="#cb103-11"></a>    decision_tree_Dif.fit(train_feature, train_target)</span>
<span id="cb103-12"><a href="#cb103-12"></a>    </span>
<span id="cb103-13"><a href="#cb103-13"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb103-14"><a href="#cb103-14"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb103-15"><a href="#cb103-15"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Dif.score(train_feature, train_target))</span>
<span id="cb103-16"><a href="#cb103-16"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Dif.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb103-17"><a href="#cb103-17"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Dif.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>max_depth= 2
Coeficiente R2 sobre el conjunto de entrenamiento: 0.02112211774494066
Coeficiente R2 sobre el conjunto de validación: -0.04086783241359471 

el RECM sobre el conjunto de validación es: 0.029006584699726702
max_depth= 3
Coeficiente R2 sobre el conjunto de entrenamiento: 0.043151853090840464
Coeficiente R2 sobre el conjunto de validación: -0.11476562348335917 

el RECM sobre el conjunto de validación es: 0.03001861060847263
max_depth= 4
Coeficiente R2 sobre el conjunto de entrenamiento: 0.10174463012125312
Coeficiente R2 sobre el conjunto de validación: -0.7128617381303293 

el RECM sobre el conjunto de validación es: 0.037210024638406496
max_depth= 5
Coeficiente R2 sobre el conjunto de entrenamiento: 0.17307907820763202
Coeficiente R2 sobre el conjunto de validación: -0.13211837154826211 

el RECM sobre el conjunto de validación es: 0.030251347366213332
max_depth= 6
Coeficiente R2 sobre el conjunto de entrenamiento: 0.21218945551992108
Coeficiente R2 sobre el conjunto de validación: -0.1787371056023772 

el RECM sobre el conjunto de validación es: 0.03086791395380015
max_depth= 7
Coeficiente R2 sobre el conjunto de entrenamiento: 0.2625424051395596
Coeficiente R2 sobre el conjunto de validación: -0.13173844148938252 

el RECM sobre el conjunto de validación es: 0.030246270882644928
max_depth= 8
Coeficiente R2 sobre el conjunto de entrenamiento: 0.32062379586770295
Coeficiente R2 sobre el conjunto de validación: -0.16541487263232835 

el RECM sobre el conjunto de validación es: 0.030692981776892597
max_depth= 9
Coeficiente R2 sobre el conjunto de entrenamiento: 0.3643839505698868
Coeficiente R2 sobre el conjunto de validación: -0.3476334399455505 

el RECM sobre el conjunto de validación es: 0.03300537663242648
max_depth= 10
Coeficiente R2 sobre el conjunto de entrenamiento: 0.40857038127400724
Coeficiente R2 sobre el conjunto de validación: -0.49464690737403516 

el RECM sobre el conjunto de validación es: 0.03475906674143191
max_depth= 11
Coeficiente R2 sobre el conjunto de entrenamiento: 0.46543130650339715
Coeficiente R2 sobre el conjunto de validación: -0.35878145330378186 

el RECM sobre el conjunto de validación es: 0.03314161047922133
max_depth= 12
Coeficiente R2 sobre el conjunto de entrenamiento: 0.5161038603267865
Coeficiente R2 sobre el conjunto de validación: -0.5647318466269751 

el RECM sobre el conjunto de validación es: 0.03556466844942393
max_depth= 13
Coeficiente R2 sobre el conjunto de entrenamiento: 0.561801808671654
Coeficiente R2 sobre el conjunto de validación: -0.4619537886323939 

el RECM sobre el conjunto de validación es: 0.03437681413256396
max_depth= 14
Coeficiente R2 sobre el conjunto de entrenamiento: 0.6025567859928427
Coeficiente R2 sobre el conjunto de validación: -0.5980150287853778 

el RECM sobre el conjunto de validación es: 0.03594092358989619
max_depth= 15
Coeficiente R2 sobre el conjunto de entrenamiento: 0.6487947235477474
Coeficiente R2 sobre el conjunto de validación: -0.807773285368834 

el RECM sobre el conjunto de validación es: 0.038227050089062256</code></pre>
</div>
</div>
<p>Note que el score mayor para el conjunto de prueba es para max depth = 2. También que es valor es negativo pero cercano a 0 Con este valor de hiperparámetro juntamos validación y entrenamiento para reestimar los parámetros.</p>
<div class="cell" data-execution_count="55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="co">#######</span></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb105-6"><a href="#cb105-6"></a><span class="co">####</span></span>
<span id="cb105-7"><a href="#cb105-7"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb105-8"><a href="#cb105-8"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb105-9"><a href="#cb105-9"></a><span class="co">#####</span></span>
<span id="cb105-10"><a href="#cb105-10"></a><span class="co">####</span></span>
<span id="cb105-11"><a href="#cb105-11"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb105-12"><a href="#cb105-12"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb105-13"><a href="#cb105-13"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb105-14"><a href="#cb105-14"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb105-15"><a href="#cb105-15"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb105-16"><a href="#cb105-16"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb105-17"><a href="#cb105-17"></a><span class="bu">print</span>(train_val_target.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
&lt;class 'numpy.ndarray'&gt;
(1275, 3)
(183, 3)
(1275,)
(183,)
(1458, 3)
(1458,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb107-2"><a href="#cb107-2"></a>decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">2</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>decision_tree_Dif.fit(train_val_feature, train_val_target)</span>
<span id="cb107-4"><a href="#cb107-4"></a></span>
<span id="cb107-5"><a href="#cb107-5"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb107-6"><a href="#cb107-6"></a>train_val_prediction <span class="op">=</span> decision_tree_Dif.predict(train_val_feature)</span>
<span id="cb107-7"><a href="#cb107-7"></a>test_prediction <span class="op">=</span> decision_tree_Dif.predict(test_feature)</span>
<span id="cb107-8"><a href="#cb107-8"></a></span>
<span id="cb107-9"><a href="#cb107-9"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb107-10"><a href="#cb107-10"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb107-11"><a href="#cb107-11"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb107-12"><a href="#cb107-12"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb107-13"><a href="#cb107-13"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb107-14"><a href="#cb107-14"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb107-15"><a href="#cb107-15"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb107-16"><a href="#cb107-16"></a>plt.legend()</span>
<span id="cb107-17"><a href="#cb107-17"></a>plt.show()</span>
<span id="cb107-18"><a href="#cb107-18"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb107-19"><a href="#cb107-19"></a></span>
<span id="cb107-20"><a href="#cb107-20"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-57-output-1.png" width="600" height="429"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raíz de la Pérdida cuadrática Entrenamiento: 0.042920242044064146
Raíz de la Pérdida cuadrática Prueba: 0.042579197337237217</code></pre>
</div>
</div>
<p>Podemos notar que aparecen dos valores extremos los cuales pueden influir en el resultado, ademàs los valores de RECM son similares para entrenamiento y prueba.</p>
<div class="cell" data-execution_count="57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb109-2"><a href="#cb109-2"></a></span>
<span id="cb109-3"><a href="#cb109-3"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df2_Dif.columns.values)</span>
<span id="cb109-4"><a href="#cb109-4"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb109-5"><a href="#cb109-5"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Dif)</span>
<span id="cb109-6"><a href="#cb109-6"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_2 &lt;= -0.18
|   |--- feature_0 &lt;= -0.01
|   |   |--- value: [0.14]
|   |--- feature_0 &gt;  -0.01
|   |   |--- value: [0.15]
|--- feature_2 &gt;  -0.18
|   |--- feature_1 &lt;= -0.04
|   |   |--- value: [-0.01]
|   |--- feature_1 &gt;  -0.04
|   |   |--- value: [0.00]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb111-2"><a href="#cb111-2"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Dif, </span>
<span id="cb111-3"><a href="#cb111-3"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb111-4"><a href="#cb111-4"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb111-5"><a href="#cb111-5"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-59-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<p>Veremos cómo se ve estos datos para la serie diferenciada.</p>
<div class="cell" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb112-3"><a href="#cb112-3"></a></span>
<span id="cb112-4"><a href="#cb112-4"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb112-5"><a href="#cb112-5"></a><span class="bu">print</span>(test_target.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1458
1458
364
364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a>indicetrian_val_test<span class="op">=</span>df2_Dif.index</span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">1458</span>]</span>
<span id="cb114-4"><a href="#cb114-4"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">1458</span>:<span class="dv">1822</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1822</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="bu">print</span>(indicetest.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1458
364</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb118-2"><a href="#cb118-2"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb118-4"><a href="#cb118-4"></a><span class="bu">print</span>(predictionjoint.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1822
1822</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb120-2"><a href="#cb120-2"></a>ObsvsPred2<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb120-3"><a href="#cb120-3"></a>ObsvsPred2.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-05</td>
<td>-0.121610</td>
<td>0.003162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-06</td>
<td>-0.108785</td>
<td>0.003162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-07</td>
<td>0.006239</td>
<td>-0.006118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-08</td>
<td>0.010015</td>
<td>-0.006118</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-09</td>
<td>-0.006843</td>
<td>0.003162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-10</td>
<td>0.008817</td>
<td>0.003162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-11</td>
<td>-0.140675</td>
<td>0.003162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-12</td>
<td>0.033889</td>
<td>0.003162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-13</td>
<td>0.013269</td>
<td>-0.006118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-14</td>
<td>-0.008794</td>
<td>0.003162</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="co">#gráfico</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>ax <span class="op">=</span> ObsvsPred2[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb121-3"><a href="#cb121-3"></a>ObsvsPred2[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb121-4"><a href="#cb121-4"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb121-5"><a href="#cb121-5"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb121-6"><a href="#cb121-6"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>plt.legend()</span>
<span id="cb121-8"><a href="#cb121-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-65-output-1.png" width="805" height="485"></p>
</div>
</div>
<p>Podemos observar que dado que esta seríe es estacionaría los alores oscilan alrededor de un punto fijo el cual es <span class="math inline">\(0\)</span> y los valores de predicción son cercanos a él, con ellos el modelo no toma encuenta la información de los rezagos, para la predicción solo usa la media muestral lo cual se reflejaba en el <span class="math inline">\(R^2 \approx 0\)</span></p>
<p>Con esto podemos concluir que <strong>los árboles de decisión</strong> no son un buen modelo para tratar con una serie cómo esta</p>
<p>Esto sería lle varlo a la original lo cual me parece mala idea porque los valores son 0 entonces prácticamente usa el retardo anterior cómo predicción, además no se si poner la logaritmica</p>
<p>Ahora para poder obtener los valores en la serie original necesitamos hacer la transfromacion de las predicciones via <span class="math display">\[\hat{y}_{t+h} = \hat{\Delta} y_{t+1} + y_{t}\]</span></p>
<div class="cell" data-execution_count="65">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a>yhat <span class="op">=</span> ObsvsPred2[<span class="st">'Predicción'</span>]<span class="op">+</span>ObsvsPred1[<span class="st">'observado'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb122-2"><a href="#cb122-2"></a>yhat <span class="op">=</span> yhat.drop(<span class="st">'2017-01-04'</span>)</span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="bu">print</span>(yhat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-01-05     1122.563162
2017-01-06      994.023162
2017-01-07      891.553882
2017-01-08      897.133882
2017-01-09      906.173162
                  ...     
2021-12-27    50791.213162
2021-12-28    50718.113162
2021-12-29    47543.303162
2021-12-30    46483.353882
2021-12-31    47150.713162
Freq: D, Length: 1822, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a>y <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>]</span>
<span id="cb124-2"><a href="#cb124-2"></a>y <span class="op">=</span> y.drop(<span class="st">'2017-01-04'</span>)</span>
<span id="cb124-3"><a href="#cb124-3"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: y, <span class="st">'Predicción'</span>: yhat}</span>
<span id="cb124-4"><a href="#cb124-4"></a>ObsvsPred3<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb124-5"><a href="#cb124-5"></a>ObsvsPred3.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observado</th>
<th data-quarto-table-cell-role="th">Predicción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-05</td>
<td>994.02</td>
<td>1122.563162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-06</td>
<td>891.56</td>
<td>994.023162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-07</td>
<td>897.14</td>
<td>891.553882</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-08</td>
<td>906.17</td>
<td>897.133882</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-09</td>
<td>899.99</td>
<td>906.173162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-10</td>
<td>907.96</td>
<td>899.993162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-11</td>
<td>788.81</td>
<td>907.963162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-12</td>
<td>816.00</td>
<td>788.813162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-13</td>
<td>826.90</td>
<td>815.993882</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-01-14</td>
<td>819.66</td>
<td>826.903162</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>ax <span class="op">=</span> ObsvsPred3.plot( marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb125-2"><a href="#cb125-2"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1458</span>].date(),color<span class="op">=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>&lt;matplotlib.lines.Line2D at 0x27047ac10d0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Arboles_Des_series_files/figure-html/cell-68-output-2.png" width="964" height="633"></p>
</div>
</div>
<p>Notamos los valores predichos para la diferencia son muy cercanos a cero lo cual al llervalos</p>
<p>Podemos concluir que los arboles de deicison no son buenos tratando con serie que presentan tendencia potencialmente estocastica y que</p>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Volver arriba</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb127" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb127-1"><a href="#cb127-1"></a><span class="co">---</span></span>
<span id="cb127-2"><a href="#cb127-2"></a><span class="an">title:</span><span class="co"> "Predicción 1 paso adelante"</span></span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb127-6"><a href="#cb127-6"></a><span class="co">---</span></span>
<span id="cb127-7"><a href="#cb127-7"></a></span>
<span id="cb127-8"><a href="#cb127-8"></a>Vamos a importar la bases de datos y a convertirlas en objetos de series de Tiempo. $<span class="sc">\{</span>X_t<span class="sc">\}</span>$</span>
<span id="cb127-9"><a href="#cb127-9"></a></span>
<span id="cb127-12"><a href="#cb127-12"></a><span class="in">```{python}</span></span>
<span id="cb127-13"><a href="#cb127-13"></a><span class="co"># get working directory</span></span>
<span id="cb127-14"><a href="#cb127-14"></a><span class="im">import</span> os</span>
<span id="cb127-15"><a href="#cb127-15"></a>os.getcwd()</span>
<span id="cb127-16"><a href="#cb127-16"></a><span class="in">```</span></span>
<span id="cb127-17"><a href="#cb127-17"></a></span>
<span id="cb127-20"><a href="#cb127-20"></a><span class="in">```{python}</span></span>
<span id="cb127-21"><a href="#cb127-21"></a><span class="co"># librerias</span></span>
<span id="cb127-22"><a href="#cb127-22"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb127-23"><a href="#cb127-23"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb127-24"><a href="#cb127-24"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb127-25"><a href="#cb127-25"></a><span class="im">import</span> sklearn</span>
<span id="cb127-26"><a href="#cb127-26"></a><span class="im">import</span> openpyxl</span>
<span id="cb127-27"><a href="#cb127-27"></a><span class="im">from</span> skforecast.ForecasterAutoreg <span class="im">import</span> ForecasterAutoreg</span>
<span id="cb127-28"><a href="#cb127-28"></a><span class="im">import</span> warnings</span>
<span id="cb127-29"><a href="#cb127-29"></a><span class="bu">print</span>(<span class="ss">f"Matplotlib Version: </span><span class="sc">{</span>plt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-30"><a href="#cb127-30"></a><span class="bu">print</span>(<span class="ss">f"Pandas Version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-31"><a href="#cb127-31"></a><span class="bu">print</span>(<span class="ss">f"Numpy Version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-32"><a href="#cb127-32"></a><span class="bu">print</span>(<span class="ss">f"Sklearn: </span><span class="sc">{</span>sklearn<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-33"><a href="#cb127-33"></a><span class="in">```</span></span>
<span id="cb127-34"><a href="#cb127-34"></a></span>
<span id="cb127-37"><a href="#cb127-37"></a><span class="in">```{python}</span></span>
<span id="cb127-38"><a href="#cb127-38"></a><span class="co"># traer datos originales</span></span>
<span id="cb127-39"><a href="#cb127-39"></a>data <span class="op">=</span> pd.ExcelFile(<span class="st">'Bitcoin.xlsx'</span>)</span>
<span id="cb127-40"><a href="#cb127-40"></a><span class="bu">print</span>(data.sheet_names)</span>
<span id="cb127-41"><a href="#cb127-41"></a><span class="co"># dataframe con los datos</span></span>
<span id="cb127-42"><a href="#cb127-42"></a>data <span class="op">=</span> data.parse(<span class="st">'Sheet1'</span>)</span>
<span id="cb127-43"><a href="#cb127-43"></a><span class="bu">print</span>(data)</span>
<span id="cb127-44"><a href="#cb127-44"></a><span class="bu">print</span>(<span class="bu">type</span>(data))</span>
<span id="cb127-45"><a href="#cb127-45"></a><span class="in">```</span></span>
<span id="cb127-46"><a href="#cb127-46"></a></span>
<span id="cb127-47"><a href="#cb127-47"></a>Notamos que estan organizador del más reciente al más antiguo asi entonces buscaremos organiarla cámo debe ser</span>
<span id="cb127-48"><a href="#cb127-48"></a></span>
<span id="cb127-51"><a href="#cb127-51"></a><span class="in">```{python}</span></span>
<span id="cb127-52"><a href="#cb127-52"></a>data <span class="op">=</span> data[::<span class="op">-</span><span class="dv">1</span>].reset_index(drop<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb127-53"><a href="#cb127-53"></a>data.index <span class="op">=</span> data[<span class="st">'FechaTiempo'</span>]</span>
<span id="cb127-54"><a href="#cb127-54"></a>data<span class="op">=</span>data.asfreq(<span class="st">'D'</span>)</span>
<span id="cb127-55"><a href="#cb127-55"></a>data <span class="op">=</span> data.drop(columns<span class="op">=</span>[<span class="st">'FechaTiempo'</span>,<span class="st">'index'</span>])</span>
<span id="cb127-56"><a href="#cb127-56"></a><span class="bu">print</span>(data)</span>
<span id="cb127-57"><a href="#cb127-57"></a><span class="in">```</span></span>
<span id="cb127-58"><a href="#cb127-58"></a></span>
<span id="cb127-61"><a href="#cb127-61"></a><span class="in">```{python}</span></span>
<span id="cb127-62"><a href="#cb127-62"></a><span class="co"># traer datos</span></span>
<span id="cb127-63"><a href="#cb127-63"></a>data_2 <span class="op">=</span> pd.ExcelFile(<span class="st">'dlData.xlsx'</span>)</span>
<span id="cb127-64"><a href="#cb127-64"></a><span class="bu">print</span>(data_2.sheet_names)</span>
<span id="cb127-65"><a href="#cb127-65"></a><span class="co"># dataframe con los datos</span></span>
<span id="cb127-66"><a href="#cb127-66"></a>data_2 <span class="op">=</span> data_2.parse(<span class="st">'Sheet1'</span>)</span>
<span id="cb127-67"><a href="#cb127-67"></a><span class="bu">print</span>(data_2)</span>
<span id="cb127-68"><a href="#cb127-68"></a><span class="bu">print</span>(<span class="bu">type</span>(data_2))</span>
<span id="cb127-69"><a href="#cb127-69"></a><span class="in">```</span></span>
<span id="cb127-70"><a href="#cb127-70"></a></span>
<span id="cb127-71"><a href="#cb127-71"></a><span class="fu">## Serie original</span></span>
<span id="cb127-72"><a href="#cb127-72"></a></span>
<span id="cb127-75"><a href="#cb127-75"></a><span class="in">```{python}</span></span>
<span id="cb127-76"><a href="#cb127-76"></a><span class="co"># tipo de datos</span></span>
<span id="cb127-77"><a href="#cb127-77"></a><span class="bu">print</span>(data.info())</span>
<span id="cb127-78"><a href="#cb127-78"></a><span class="in">```</span></span>
<span id="cb127-79"><a href="#cb127-79"></a></span>
<span id="cb127-82"><a href="#cb127-82"></a><span class="in">```{python}</span></span>
<span id="cb127-83"><a href="#cb127-83"></a><span class="co">#mirando los datos</span></span>
<span id="cb127-84"><a href="#cb127-84"></a><span class="co">#objeto ts</span></span>
<span id="cb127-85"><a href="#cb127-85"></a>Bitcoints <span class="op">=</span> data[<span class="st">'Valor'</span>]</span>
<span id="cb127-86"><a href="#cb127-86"></a><span class="bu">print</span>(<span class="bu">type</span>(Bitcoints))</span>
<span id="cb127-87"><a href="#cb127-87"></a>plt.plot(Bitcoints)</span>
<span id="cb127-88"><a href="#cb127-88"></a><span class="in">```</span></span>
<span id="cb127-89"><a href="#cb127-89"></a></span>
<span id="cb127-90"><a href="#cb127-90"></a>Se tiene concocimieno de que los árboles no son buenos manejando la tendencia, pero debido análisis descriptivo previo utilizaremos el método tanto para la serie original cómo para la serie diferenciada la cuál no presenta tendencía. Ademas miraremos si se tienen datos faltantes y si es regularmente espaciada pues esto es importante en la implementaciòn del modelo</span>
<span id="cb127-91"><a href="#cb127-91"></a></span>
<span id="cb127-94"><a href="#cb127-94"></a><span class="in">```{python}</span></span>
<span id="cb127-95"><a href="#cb127-95"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb127-96"><a href="#cb127-96"></a><span class="in">```</span></span>
<span id="cb127-97"><a href="#cb127-97"></a></span>
<span id="cb127-100"><a href="#cb127-100"></a><span class="in">```{python}</span></span>
<span id="cb127-101"><a href="#cb127-101"></a>(data.index <span class="op">==</span> pd.date_range(start<span class="op">=</span>data.index.<span class="bu">min</span>(),</span>
<span id="cb127-102"><a href="#cb127-102"></a>                             end<span class="op">=</span>data.index.<span class="bu">max</span>(),</span>
<span id="cb127-103"><a href="#cb127-103"></a>                             freq<span class="op">=</span>data.index.freq)).<span class="bu">all</span>()</span>
<span id="cb127-104"><a href="#cb127-104"></a><span class="in">```</span></span>
<span id="cb127-105"><a href="#cb127-105"></a></span>
<span id="cb127-108"><a href="#cb127-108"></a><span class="in">```{python}</span></span>
<span id="cb127-109"><a href="#cb127-109"></a>data.shape</span>
<span id="cb127-110"><a href="#cb127-110"></a><span class="in">```</span></span>
<span id="cb127-111"><a href="#cb127-111"></a></span>
<span id="cb127-112"><a href="#cb127-112"></a><span class="fu">## PACF</span></span>
<span id="cb127-113"><a href="#cb127-113"></a></span>
<span id="cb127-114"><a href="#cb127-114"></a>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</span>
<span id="cb127-115"><a href="#cb127-115"></a></span>
<span id="cb127-118"><a href="#cb127-118"></a><span class="in">```{python}</span></span>
<span id="cb127-119"><a href="#cb127-119"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb127-120"><a href="#cb127-120"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb127-121"><a href="#cb127-121"></a>plot_pacf(Bitcoints,lags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb127-122"><a href="#cb127-122"></a>pyplot.show()</span>
<span id="cb127-123"><a href="#cb127-123"></a><span class="in">```</span></span>
<span id="cb127-124"><a href="#cb127-124"></a></span>
<span id="cb127-127"><a href="#cb127-127"></a><span class="in">```{python}</span></span>
<span id="cb127-128"><a href="#cb127-128"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb127-129"><a href="#cb127-129"></a>pacf <span class="op">=</span>  sm.tsa.stattools.pacf(Bitcoints, nlags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>)</span>
<span id="cb127-130"><a href="#cb127-130"></a>T <span class="op">=</span> <span class="bu">len</span>(Bitcoints)</span>
<span id="cb127-131"><a href="#cb127-131"></a></span>
<span id="cb127-132"><a href="#cb127-132"></a>sig_test <span class="op">=</span> <span class="kw">lambda</span> tau_h: np.<span class="bu">abs</span>(tau_h) <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">/</span>np.sqrt(T)</span>
<span id="cb127-133"><a href="#cb127-133"></a><span class="in">```</span></span>
<span id="cb127-134"><a href="#cb127-134"></a></span>
<span id="cb127-137"><a href="#cb127-137"></a><span class="in">```{python}</span></span>
<span id="cb127-138"><a href="#cb127-138"></a>pacf</span>
<span id="cb127-139"><a href="#cb127-139"></a><span class="in">```</span></span>
<span id="cb127-140"><a href="#cb127-140"></a></span>
<span id="cb127-143"><a href="#cb127-143"></a><span class="in">```{python}</span></span>
<span id="cb127-144"><a href="#cb127-144"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb127-145"><a href="#cb127-145"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb127-146"><a href="#cb127-146"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb127-147"><a href="#cb127-147"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb127-148"><a href="#cb127-148"></a>        <span class="cf">break</span></span>
<span id="cb127-149"><a href="#cb127-149"></a><span class="in">```</span></span>
<span id="cb127-150"><a href="#cb127-150"></a></span>
<span id="cb127-151"><a href="#cb127-151"></a>Observamos que con el **pacf** se nos recomienda usar solo un retraso el mas proximo, lo cuál nos recueda que cuando se quizo establecer una componente estacional se sugeria un periodo de 2.5, por lo tanto teniendo encuenta lo anterior usaremos **3 retrasos** para la serie original</span>
<span id="cb127-152"><a href="#cb127-152"></a></span>
<span id="cb127-153"><a href="#cb127-153"></a><span class="fu">## Serie Trasnformada y diferenciada</span></span>
<span id="cb127-154"><a href="#cb127-154"></a></span>
<span id="cb127-157"><a href="#cb127-157"></a><span class="in">```{python}</span></span>
<span id="cb127-158"><a href="#cb127-158"></a><span class="co"># tipo de datos</span></span>
<span id="cb127-159"><a href="#cb127-159"></a><span class="bu">print</span>(data_2.info())</span>
<span id="cb127-160"><a href="#cb127-160"></a><span class="co"># nombre</span></span>
<span id="cb127-161"><a href="#cb127-161"></a>data_2.columns <span class="op">=</span> [<span class="st">'Fecha'</span>,<span class="st">'Valor'</span>]</span>
<span id="cb127-162"><a href="#cb127-162"></a><span class="bu">print</span>(data_2.info())</span>
<span id="cb127-163"><a href="#cb127-163"></a><span class="in">```</span></span>
<span id="cb127-164"><a href="#cb127-164"></a></span>
<span id="cb127-167"><a href="#cb127-167"></a><span class="in">```{python}</span></span>
<span id="cb127-168"><a href="#cb127-168"></a><span class="co"># fecha</span></span>
<span id="cb127-169"><a href="#cb127-169"></a>data_2[<span class="st">'Fecha'</span>]<span class="op">=</span>pd.to_datetime(data_2[<span class="st">'Fecha'</span>])<span class="co">###Sólo es necesario si no tiene formato de fecha</span></span>
<span id="cb127-170"><a href="#cb127-170"></a>dlData <span class="op">=</span> data_2.set_index(<span class="st">'Fecha'</span>)</span>
<span id="cb127-171"><a href="#cb127-171"></a>dlData<span class="op">=</span>dlData.asfreq(<span class="st">'D'</span>)</span>
<span id="cb127-172"><a href="#cb127-172"></a><span class="bu">print</span>(<span class="bu">type</span>(dlData))</span>
<span id="cb127-173"><a href="#cb127-173"></a><span class="bu">print</span>(dlData)</span>
<span id="cb127-174"><a href="#cb127-174"></a><span class="in">```</span></span>
<span id="cb127-175"><a href="#cb127-175"></a></span>
<span id="cb127-178"><a href="#cb127-178"></a><span class="in">```{python}</span></span>
<span id="cb127-179"><a href="#cb127-179"></a><span class="co">#objeto ts</span></span>
<span id="cb127-180"><a href="#cb127-180"></a>dlDatats <span class="op">=</span> dlData[<span class="st">'Valor'</span>]</span>
<span id="cb127-181"><a href="#cb127-181"></a><span class="bu">print</span>(<span class="bu">type</span>(dlDatats))</span>
<span id="cb127-182"><a href="#cb127-182"></a>plt.plot(dlDatats)</span>
<span id="cb127-183"><a href="#cb127-183"></a><span class="in">```</span></span>
<span id="cb127-184"><a href="#cb127-184"></a></span>
<span id="cb127-187"><a href="#cb127-187"></a><span class="in">```{python}</span></span>
<span id="cb127-188"><a href="#cb127-188"></a><span class="bu">print</span>(<span class="ss">f'Numero de filas con valores faltantes: </span><span class="sc">{</span>data_2<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">.</span>mean()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb127-189"><a href="#cb127-189"></a><span class="in">```</span></span>
<span id="cb127-190"><a href="#cb127-190"></a></span>
<span id="cb127-193"><a href="#cb127-193"></a><span class="in">```{python}</span></span>
<span id="cb127-194"><a href="#cb127-194"></a>(dlData.index <span class="op">==</span> pd.date_range(start<span class="op">=</span>dlData.index.<span class="bu">min</span>(),</span>
<span id="cb127-195"><a href="#cb127-195"></a>                             end<span class="op">=</span>dlData.index.<span class="bu">max</span>(),</span>
<span id="cb127-196"><a href="#cb127-196"></a>                             freq<span class="op">=</span>dlData.index.freq)).<span class="bu">all</span>()</span>
<span id="cb127-197"><a href="#cb127-197"></a><span class="in">```</span></span>
<span id="cb127-198"><a href="#cb127-198"></a></span>
<span id="cb127-201"><a href="#cb127-201"></a><span class="in">```{python}</span></span>
<span id="cb127-202"><a href="#cb127-202"></a>dlData.shape</span>
<span id="cb127-203"><a href="#cb127-203"></a><span class="in">```</span></span>
<span id="cb127-204"><a href="#cb127-204"></a></span>
<span id="cb127-205"><a href="#cb127-205"></a><span class="fu">## PACF</span></span>
<span id="cb127-206"><a href="#cb127-206"></a></span>
<span id="cb127-207"><a href="#cb127-207"></a>usaremos la funcion de autocorrealcion parcial para darnos una idea de cuantos rezagos usaremos en el modelo</span>
<span id="cb127-208"><a href="#cb127-208"></a></span>
<span id="cb127-211"><a href="#cb127-211"></a><span class="in">```{python}</span></span>
<span id="cb127-212"><a href="#cb127-212"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb127-213"><a href="#cb127-213"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb127-214"><a href="#cb127-214"></a>plot_pacf(dlDatats,lags<span class="op">=</span><span class="dv">400</span>,method<span class="op">=</span><span class="st">'ywm'</span>,alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb127-215"><a href="#cb127-215"></a>pyplot.show()</span>
<span id="cb127-216"><a href="#cb127-216"></a><span class="in">```</span></span>
<span id="cb127-217"><a href="#cb127-217"></a></span>
<span id="cb127-220"><a href="#cb127-220"></a><span class="in">```{python}</span></span>
<span id="cb127-221"><a href="#cb127-221"></a>pacf</span>
<span id="cb127-222"><a href="#cb127-222"></a><span class="in">```</span></span>
<span id="cb127-223"><a href="#cb127-223"></a></span>
<span id="cb127-226"><a href="#cb127-226"></a><span class="in">```{python}</span></span>
<span id="cb127-227"><a href="#cb127-227"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pacf)):</span>
<span id="cb127-228"><a href="#cb127-228"></a>    <span class="cf">if</span> sig_test(pacf[i]) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb127-229"><a href="#cb127-229"></a>        n_steps <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb127-230"><a href="#cb127-230"></a>        <span class="bu">print</span>(<span class="st">'n_steps set to'</span>, n_steps)</span>
<span id="cb127-231"><a href="#cb127-231"></a>        <span class="cf">break</span></span>
<span id="cb127-232"><a href="#cb127-232"></a><span class="in">```</span></span>
<span id="cb127-233"><a href="#cb127-233"></a></span>
<span id="cb127-234"><a href="#cb127-234"></a>Vemos que para la serie diferencidad tenemos un resultado igual que para la serie original, asì tomaremos lo mismo **3 retrasos**</span>
<span id="cb127-235"><a href="#cb127-235"></a></span>
<span id="cb127-236"><a href="#cb127-236"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb127-237"><a href="#cb127-237"></a></span>
<span id="cb127-238"><a href="#cb127-238"></a><span class="fu">### Creación de los rezagos</span></span>
<span id="cb127-239"><a href="#cb127-239"></a></span>
<span id="cb127-240"><a href="#cb127-240"></a>Debido al análisis previo tomaremos los rezagos de 3 días atrás para poder predecir un paso adelante.</span>
<span id="cb127-241"><a href="#cb127-241"></a></span>
<span id="cb127-244"><a href="#cb127-244"></a><span class="in">```{python}</span></span>
<span id="cb127-245"><a href="#cb127-245"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb127-246"><a href="#cb127-246"></a><span class="co"># reframe as supervised learning</span></span>
<span id="cb127-247"><a href="#cb127-247"></a><span class="co"># lag observation (t-1) is the input variable and t is the output variable.</span></span>
<span id="cb127-248"><a href="#cb127-248"></a>df1 <span class="op">=</span> DataFrame() <span class="co"># original</span></span>
<span id="cb127-249"><a href="#cb127-249"></a><span class="bu">print</span>(df1)</span>
<span id="cb127-250"><a href="#cb127-250"></a>df2 <span class="op">=</span> DataFrame() <span class="co">#diferenciada</span></span>
<span id="cb127-251"><a href="#cb127-251"></a><span class="bu">print</span>(df2)</span>
<span id="cb127-252"><a href="#cb127-252"></a><span class="in">```</span></span>
<span id="cb127-253"><a href="#cb127-253"></a></span>
<span id="cb127-256"><a href="#cb127-256"></a><span class="in">```{python}</span></span>
<span id="cb127-257"><a href="#cb127-257"></a><span class="co"># arreglo de datos para el arreglo de rezagos Elimnada STL</span></span>
<span id="cb127-258"><a href="#cb127-258"></a>indice <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/1/2017'</span>, periods<span class="op">=</span><span class="dv">1826</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb127-259"><a href="#cb127-259"></a><span class="bu">print</span>(indice)</span>
<span id="cb127-260"><a href="#cb127-260"></a>originalDatadf <span class="op">=</span> pd.DataFrame(data[<span class="st">'Valor'</span>].values,index<span class="op">=</span>indice)</span>
<span id="cb127-261"><a href="#cb127-261"></a><span class="bu">print</span>(originalDatadf)</span>
<span id="cb127-262"><a href="#cb127-262"></a><span class="in">```</span></span>
<span id="cb127-263"><a href="#cb127-263"></a></span>
<span id="cb127-266"><a href="#cb127-266"></a><span class="in">```{python}</span></span>
<span id="cb127-267"><a href="#cb127-267"></a><span class="co"># arreglo de datos para el arreglo de rezagos diferenciada</span></span>
<span id="cb127-268"><a href="#cb127-268"></a>indice_2 <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1/2/2017'</span>, periods<span class="op">=</span><span class="dv">1825</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb127-269"><a href="#cb127-269"></a><span class="bu">print</span>(indice_2)</span>
<span id="cb127-270"><a href="#cb127-270"></a>dlDatadf <span class="op">=</span> pd.DataFrame(data_2[<span class="st">'Valor'</span>].values,index<span class="op">=</span>indice_2)</span>
<span id="cb127-271"><a href="#cb127-271"></a><span class="bu">print</span>(dlDatadf)</span>
<span id="cb127-272"><a href="#cb127-272"></a><span class="in">```</span></span>
<span id="cb127-273"><a href="#cb127-273"></a></span>
<span id="cb127-276"><a href="#cb127-276"></a><span class="in">```{python}</span></span>
<span id="cb127-277"><a href="#cb127-277"></a><span class="co"># Rezagos original</span></span>
<span id="cb127-278"><a href="#cb127-278"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb127-279"><a href="#cb127-279"></a>    df1[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> originalDatadf.shift(i)</span>
<span id="cb127-280"><a href="#cb127-280"></a><span class="bu">print</span>(df1)</span>
<span id="cb127-281"><a href="#cb127-281"></a><span class="in">```</span></span>
<span id="cb127-282"><a href="#cb127-282"></a></span>
<span id="cb127-285"><a href="#cb127-285"></a><span class="in">```{python}</span></span>
<span id="cb127-286"><a href="#cb127-286"></a><span class="co"># REzagos diferenciada</span></span>
<span id="cb127-287"><a href="#cb127-287"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb127-288"><a href="#cb127-288"></a>    df2[[<span class="st">'t-'</span><span class="op">+</span><span class="bu">str</span>(i)]] <span class="op">=</span> dlDatadf.shift(i)</span>
<span id="cb127-289"><a href="#cb127-289"></a><span class="bu">print</span>(df2)</span>
<span id="cb127-290"><a href="#cb127-290"></a><span class="in">```</span></span>
<span id="cb127-291"><a href="#cb127-291"></a></span>
<span id="cb127-294"><a href="#cb127-294"></a><span class="in">```{python}</span></span>
<span id="cb127-295"><a href="#cb127-295"></a><span class="co"># Create column t original</span></span>
<span id="cb127-296"><a href="#cb127-296"></a>df1[<span class="st">'t'</span>] <span class="op">=</span> originalDatadf.values</span>
<span id="cb127-297"><a href="#cb127-297"></a><span class="bu">print</span>(df1.head(<span class="dv">14</span>))</span>
<span id="cb127-298"><a href="#cb127-298"></a><span class="in">```</span></span>
<span id="cb127-299"><a href="#cb127-299"></a></span>
<span id="cb127-302"><a href="#cb127-302"></a><span class="in">```{python}</span></span>
<span id="cb127-303"><a href="#cb127-303"></a><span class="co"># Create column t diferenciada</span></span>
<span id="cb127-304"><a href="#cb127-304"></a>df2[<span class="st">'t'</span>] <span class="op">=</span> dlDatadf.values</span>
<span id="cb127-305"><a href="#cb127-305"></a><span class="bu">print</span>(df2.head(<span class="dv">14</span>))</span>
<span id="cb127-306"><a href="#cb127-306"></a><span class="in">```</span></span>
<span id="cb127-307"><a href="#cb127-307"></a></span>
<span id="cb127-310"><a href="#cb127-310"></a><span class="in">```{python}</span></span>
<span id="cb127-311"><a href="#cb127-311"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 7 rows original</span></span>
<span id="cb127-312"><a href="#cb127-312"></a>df1_Ori <span class="op">=</span> df1[<span class="dv">3</span>:]</span>
<span id="cb127-313"><a href="#cb127-313"></a><span class="bu">print</span>(df1_Ori)</span>
<span id="cb127-314"><a href="#cb127-314"></a>df1_Ori.size</span>
<span id="cb127-315"><a href="#cb127-315"></a><span class="in">```</span></span>
<span id="cb127-316"><a href="#cb127-316"></a></span>
<span id="cb127-319"><a href="#cb127-319"></a><span class="in">```{python}</span></span>
<span id="cb127-320"><a href="#cb127-320"></a><span class="co"># Create a new subsetted dataframe, removing Nans from first 7 rows diferenciada</span></span>
<span id="cb127-321"><a href="#cb127-321"></a>df2_Dif <span class="op">=</span> df2[<span class="dv">3</span>:]</span>
<span id="cb127-322"><a href="#cb127-322"></a><span class="bu">print</span>(df2_Dif)</span>
<span id="cb127-323"><a href="#cb127-323"></a>df2_Dif.size</span>
<span id="cb127-324"><a href="#cb127-324"></a><span class="in">```</span></span>
<span id="cb127-325"><a href="#cb127-325"></a></span>
<span id="cb127-326"><a href="#cb127-326"></a>hemos creado lo necesario para tener los 3 rezagos y la prediccion un paso adelante ahora. así tenemos los modelos : 1. Para los datos originales $$y_{t} = f(y_{t-1},y_{t-2},y_{t-3}) + \epsilon$$ 2. Para la serie con estabilización de varianza y difereciada $$\Delta y_t = f(\Delta y_{t-1}, \Delta y_{t-2}, \Delta y_{t-3}) + \epsilon$$</span>
<span id="cb127-327"><a href="#cb127-327"></a></span>
<span id="cb127-328"><a href="#cb127-328"></a><span class="fu">### División de los datos</span></span>
<span id="cb127-329"><a href="#cb127-329"></a></span>
<span id="cb127-332"><a href="#cb127-332"></a><span class="in">```{python}</span></span>
<span id="cb127-333"><a href="#cb127-333"></a><span class="co"># Split data Eliminada</span></span>
<span id="cb127-334"><a href="#cb127-334"></a>Orig_Split <span class="op">=</span> df1_Ori.values</span>
<span id="cb127-335"><a href="#cb127-335"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb127-336"><a href="#cb127-336"></a>X1 <span class="op">=</span> Orig_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb127-337"><a href="#cb127-337"></a>y1 <span class="op">=</span> Orig_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb127-338"><a href="#cb127-338"></a><span class="bu">print</span>(X1)</span>
<span id="cb127-339"><a href="#cb127-339"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y1)</span>
<span id="cb127-340"><a href="#cb127-340"></a><span class="in">```</span></span>
<span id="cb127-341"><a href="#cb127-341"></a></span>
<span id="cb127-344"><a href="#cb127-344"></a><span class="in">```{python}</span></span>
<span id="cb127-345"><a href="#cb127-345"></a><span class="co"># Split data Diferenciada</span></span>
<span id="cb127-346"><a href="#cb127-346"></a>Dife_Split <span class="op">=</span> df2_Dif.values</span>
<span id="cb127-347"><a href="#cb127-347"></a><span class="co"># split into lagged variables and original time series</span></span>
<span id="cb127-348"><a href="#cb127-348"></a>X2 <span class="op">=</span> Dife_Split[:, <span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and start with column 0 and go up to but not including the last column</span></span>
<span id="cb127-349"><a href="#cb127-349"></a>y2 <span class="op">=</span> Dife_Split[:,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># slice all rows and last column, essentially separating out 't' column</span></span>
<span id="cb127-350"><a href="#cb127-350"></a><span class="bu">print</span>(X2)</span>
<span id="cb127-351"><a href="#cb127-351"></a><span class="bu">print</span>(<span class="st">'Respuestas </span><span class="ch">\n</span><span class="st">'</span>,y2)</span>
<span id="cb127-352"><a href="#cb127-352"></a><span class="in">```</span></span>
<span id="cb127-353"><a href="#cb127-353"></a></span>
<span id="cb127-354"><a href="#cb127-354"></a><span class="fu"># Árbol para datos originales</span></span>
<span id="cb127-355"><a href="#cb127-355"></a></span>
<span id="cb127-356"><a href="#cb127-356"></a><span class="fu">#### Entrenamiento, Validación y prueba</span></span>
<span id="cb127-357"><a href="#cb127-357"></a></span>
<span id="cb127-360"><a href="#cb127-360"></a><span class="in">```{python}</span></span>
<span id="cb127-361"><a href="#cb127-361"></a>Y1 <span class="op">=</span> y1</span>
<span id="cb127-362"><a href="#cb127-362"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y1))</span>
<span id="cb127-363"><a href="#cb127-363"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb127-364"><a href="#cb127-364"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb127-365"><a href="#cb127-365"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb127-366"><a href="#cb127-366"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb127-367"><a href="#cb127-367"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb127-368"><a href="#cb127-368"></a><span class="in">```</span></span>
<span id="cb127-369"><a href="#cb127-369"></a></span>
<span id="cb127-372"><a href="#cb127-372"></a><span class="in">```{python}</span></span>
<span id="cb127-373"><a href="#cb127-373"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb127-374"><a href="#cb127-374"></a>train_target, val_target,test_target <span class="op">=</span> Y1[<span class="dv">0</span>:traintarget_size], Y1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb127-375"><a href="#cb127-375"></a></span>
<span id="cb127-376"><a href="#cb127-376"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y1)))</span>
<span id="cb127-377"><a href="#cb127-377"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb127-378"><a href="#cb127-378"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb127-379"><a href="#cb127-379"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb127-380"><a href="#cb127-380"></a><span class="in">```</span></span>
<span id="cb127-381"><a href="#cb127-381"></a></span>
<span id="cb127-384"><a href="#cb127-384"></a><span class="in">```{python}</span></span>
<span id="cb127-385"><a href="#cb127-385"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb127-386"><a href="#cb127-386"></a></span>
<span id="cb127-387"><a href="#cb127-387"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb127-388"><a href="#cb127-388"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb127-389"><a href="#cb127-389"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X1) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb127-390"><a href="#cb127-390"></a>train_feature, val_feature,test_feature <span class="op">=</span> X1[<span class="dv">0</span>:traintarget_size],X1[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X1[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y1)]</span>
<span id="cb127-391"><a href="#cb127-391"></a></span>
<span id="cb127-392"><a href="#cb127-392"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X1)))</span>
<span id="cb127-393"><a href="#cb127-393"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb127-394"><a href="#cb127-394"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb127-395"><a href="#cb127-395"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb127-396"><a href="#cb127-396"></a><span class="in">```</span></span>
<span id="cb127-397"><a href="#cb127-397"></a></span>
<span id="cb127-398"><a href="#cb127-398"></a><span class="fu">### Árbol</span></span>
<span id="cb127-399"><a href="#cb127-399"></a></span>
<span id="cb127-402"><a href="#cb127-402"></a><span class="in">```{python}</span></span>
<span id="cb127-403"><a href="#cb127-403"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb127-404"><a href="#cb127-404"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb127-405"><a href="#cb127-405"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb127-406"><a href="#cb127-406"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb127-407"><a href="#cb127-407"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb127-408"><a href="#cb127-408"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb127-409"><a href="#cb127-409"></a>decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb127-410"><a href="#cb127-410"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb127-411"><a href="#cb127-411"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb127-412"><a href="#cb127-412"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Orig.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb127-413"><a href="#cb127-413"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Orig.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb127-414"><a href="#cb127-414"></a><span class="in">```</span></span>
<span id="cb127-415"><a href="#cb127-415"></a></span>
<span id="cb127-416"><a href="#cb127-416"></a>Vemos que el R2 para los datos de validación es bueno así sin ningún ajuste, Se relizara un ajuste de la profundidad como hiperparametro para ver si mejora dicho valor</span>
<span id="cb127-417"><a href="#cb127-417"></a></span>
<span id="cb127-420"><a href="#cb127-420"></a><span class="in">```{python}</span></span>
<span id="cb127-421"><a href="#cb127-421"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb127-422"><a href="#cb127-422"></a></span>
<span id="cb127-423"><a href="#cb127-423"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb127-424"><a href="#cb127-424"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb127-425"><a href="#cb127-425"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb127-426"><a href="#cb127-426"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb127-427"><a href="#cb127-427"></a></span>
<span id="cb127-428"><a href="#cb127-428"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb127-429"><a href="#cb127-429"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb127-430"><a href="#cb127-430"></a>    decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb127-431"><a href="#cb127-431"></a>    decision_tree_Orig.fit(train_feature, train_target)</span>
<span id="cb127-432"><a href="#cb127-432"></a>    </span>
<span id="cb127-433"><a href="#cb127-433"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb127-434"><a href="#cb127-434"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb127-435"><a href="#cb127-435"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Orig.score(train_feature, train_target))</span>
<span id="cb127-436"><a href="#cb127-436"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Orig.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb127-437"><a href="#cb127-437"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Orig.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-438"><a href="#cb127-438"></a></span>
<span id="cb127-439"><a href="#cb127-439"></a><span class="in">```</span></span>
<span id="cb127-440"><a href="#cb127-440"></a></span>
<span id="cb127-441"><a href="#cb127-441"></a>Note que el score mayor para el conjunto de validación es para max depth = 5. después este valor el R2 comienza a oscilar en valores cercanos a 0.7. Ahora uniremos validacion y entrenamiento para re para reestimar los parametros</span>
<span id="cb127-442"><a href="#cb127-442"></a></span>
<span id="cb127-445"><a href="#cb127-445"></a><span class="in">```{python}</span></span>
<span id="cb127-446"><a href="#cb127-446"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb127-447"><a href="#cb127-447"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb127-448"><a href="#cb127-448"></a><span class="co">#######</span></span>
<span id="cb127-449"><a href="#cb127-449"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb127-450"><a href="#cb127-450"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb127-451"><a href="#cb127-451"></a><span class="co">####</span></span>
<span id="cb127-452"><a href="#cb127-452"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb127-453"><a href="#cb127-453"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb127-454"><a href="#cb127-454"></a><span class="co">#####</span></span>
<span id="cb127-455"><a href="#cb127-455"></a><span class="co">####</span></span>
<span id="cb127-456"><a href="#cb127-456"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb127-457"><a href="#cb127-457"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb127-458"><a href="#cb127-458"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb127-459"><a href="#cb127-459"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb127-460"><a href="#cb127-460"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb127-461"><a href="#cb127-461"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb127-462"><a href="#cb127-462"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb127-463"><a href="#cb127-463"></a><span class="in">```</span></span>
<span id="cb127-464"><a href="#cb127-464"></a></span>
<span id="cb127-467"><a href="#cb127-467"></a><span class="in">```{python}</span></span>
<span id="cb127-468"><a href="#cb127-468"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb127-469"><a href="#cb127-469"></a>decision_tree_Orig <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">5</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb127-470"><a href="#cb127-470"></a>decision_tree_Orig.fit(train_val_feature, train_val_target)</span>
<span id="cb127-471"><a href="#cb127-471"></a></span>
<span id="cb127-472"><a href="#cb127-472"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb127-473"><a href="#cb127-473"></a>train_val_prediction <span class="op">=</span> decision_tree_Orig.predict(train_val_feature)</span>
<span id="cb127-474"><a href="#cb127-474"></a>test_prediction <span class="op">=</span> decision_tree_Orig.predict(test_feature)</span>
<span id="cb127-475"><a href="#cb127-475"></a></span>
<span id="cb127-476"><a href="#cb127-476"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb127-477"><a href="#cb127-477"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb127-478"><a href="#cb127-478"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb127-479"><a href="#cb127-479"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb127-480"><a href="#cb127-480"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb127-481"><a href="#cb127-481"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb127-482"><a href="#cb127-482"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb127-483"><a href="#cb127-483"></a>plt.legend()</span>
<span id="cb127-484"><a href="#cb127-484"></a>plt.show()</span>
<span id="cb127-485"><a href="#cb127-485"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-486"><a href="#cb127-486"></a></span>
<span id="cb127-487"><a href="#cb127-487"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-488"><a href="#cb127-488"></a><span class="in">```</span></span>
<span id="cb127-489"><a href="#cb127-489"></a></span>
<span id="cb127-490"><a href="#cb127-490"></a>Vemos que el RECM es menor para el entrenamiento y mayor para la prubea lo cuál podría indicar sobre ajuste pero notamos en el gráfico que para los valores de prueba se queda con la ultimá predicción dada para el entrenamiento</span>
<span id="cb127-491"><a href="#cb127-491"></a></span>
<span id="cb127-494"><a href="#cb127-494"></a><span class="in">```{python}</span></span>
<span id="cb127-495"><a href="#cb127-495"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb127-496"><a href="#cb127-496"></a></span>
<span id="cb127-497"><a href="#cb127-497"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df1_Ori.columns.values)</span>
<span id="cb127-498"><a href="#cb127-498"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb127-499"><a href="#cb127-499"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Orig)</span>
<span id="cb127-500"><a href="#cb127-500"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb127-501"><a href="#cb127-501"></a><span class="in">```</span></span>
<span id="cb127-502"><a href="#cb127-502"></a></span>
<span id="cb127-505"><a href="#cb127-505"></a><span class="in">```{python}</span></span>
<span id="cb127-506"><a href="#cb127-506"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb127-507"><a href="#cb127-507"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Orig, </span>
<span id="cb127-508"><a href="#cb127-508"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb127-509"><a href="#cb127-509"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb127-510"><a href="#cb127-510"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-511"><a href="#cb127-511"></a><span class="in">```</span></span>
<span id="cb127-512"><a href="#cb127-512"></a></span>
<span id="cb127-513"><a href="#cb127-513"></a>Ahora miraremos las predicciones comparadas con los valores verdaderos, para ver más claro lo anterior.</span>
<span id="cb127-514"><a href="#cb127-514"></a></span>
<span id="cb127-517"><a href="#cb127-517"></a><span class="in">```{python}</span></span>
<span id="cb127-518"><a href="#cb127-518"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb127-519"><a href="#cb127-519"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb127-520"><a href="#cb127-520"></a></span>
<span id="cb127-521"><a href="#cb127-521"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb127-522"><a href="#cb127-522"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb127-523"><a href="#cb127-523"></a><span class="in">```</span></span>
<span id="cb127-524"><a href="#cb127-524"></a></span>
<span id="cb127-527"><a href="#cb127-527"></a><span class="in">```{python}</span></span>
<span id="cb127-528"><a href="#cb127-528"></a>indicetrian_val_test<span class="op">=</span>df1_Ori.index</span>
<span id="cb127-529"><a href="#cb127-529"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb127-530"><a href="#cb127-530"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">1459</span>]</span>
<span id="cb127-531"><a href="#cb127-531"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>:<span class="dv">1823</span>]</span>
<span id="cb127-532"><a href="#cb127-532"></a><span class="in">```</span></span>
<span id="cb127-533"><a href="#cb127-533"></a></span>
<span id="cb127-536"><a href="#cb127-536"></a><span class="in">```{python}</span></span>
<span id="cb127-537"><a href="#cb127-537"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb127-538"><a href="#cb127-538"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb127-539"><a href="#cb127-539"></a><span class="in">```</span></span>
<span id="cb127-540"><a href="#cb127-540"></a></span>
<span id="cb127-543"><a href="#cb127-543"></a><span class="in">```{python}</span></span>
<span id="cb127-544"><a href="#cb127-544"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb127-545"><a href="#cb127-545"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb127-546"><a href="#cb127-546"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb127-547"><a href="#cb127-547"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb127-548"><a href="#cb127-548"></a><span class="in">```</span></span>
<span id="cb127-549"><a href="#cb127-549"></a></span>
<span id="cb127-552"><a href="#cb127-552"></a><span class="in">```{python}</span></span>
<span id="cb127-553"><a href="#cb127-553"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb127-554"><a href="#cb127-554"></a>ObsvsPred1<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb127-555"><a href="#cb127-555"></a>ObsvsPred1.head(<span class="dv">10</span>)</span>
<span id="cb127-556"><a href="#cb127-556"></a><span class="in">```</span></span>
<span id="cb127-557"><a href="#cb127-557"></a></span>
<span id="cb127-560"><a href="#cb127-560"></a><span class="in">```{python}</span></span>
<span id="cb127-561"><a href="#cb127-561"></a><span class="co">#gráfico</span></span>
<span id="cb127-562"><a href="#cb127-562"></a>ax <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb127-563"><a href="#cb127-563"></a>ObsvsPred1[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb127-564"><a href="#cb127-564"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb127-565"><a href="#cb127-565"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb127-566"><a href="#cb127-566"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb127-567"><a href="#cb127-567"></a>plt.legend()</span>
<span id="cb127-568"><a href="#cb127-568"></a>plt.show()</span>
<span id="cb127-569"><a href="#cb127-569"></a><span class="in">```</span></span>
<span id="cb127-570"><a href="#cb127-570"></a></span>
<span id="cb127-571"><a href="#cb127-571"></a>Podemos observar que como nos anticipaba el RECM en el entrenamiento las predicciones son cercanas al valor real, pero para los datos de prueba se queda con lo ultimo visto para el entrenamiento sin tener encuenta el comportamiento de la serie.</span>
<span id="cb127-572"><a href="#cb127-572"></a></span>
<span id="cb127-573"><a href="#cb127-573"></a><span class="fu"># Árbol para datos Diferenciados</span></span>
<span id="cb127-574"><a href="#cb127-574"></a></span>
<span id="cb127-575"><a href="#cb127-575"></a><span class="fu">#### Entrenamiento, Validación y prueba (Diferenciada)</span></span>
<span id="cb127-576"><a href="#cb127-576"></a></span>
<span id="cb127-579"><a href="#cb127-579"></a><span class="in">```{python}</span></span>
<span id="cb127-580"><a href="#cb127-580"></a>Y2 <span class="op">=</span> y2</span>
<span id="cb127-581"><a href="#cb127-581"></a><span class="bu">print</span>(<span class="st">'Complete Observations for Target after Supervised configuration: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span><span class="bu">len</span>(Y2))</span>
<span id="cb127-582"><a href="#cb127-582"></a>traintarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.70</span>) </span>
<span id="cb127-583"><a href="#cb127-583"></a>valtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">1</span><span class="co"># Set split</span></span>
<span id="cb127-584"><a href="#cb127-584"></a>testtarget_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Y2) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb127-585"><a href="#cb127-585"></a><span class="bu">print</span>(traintarget_size,valtarget_size,testtarget_size)</span>
<span id="cb127-586"><a href="#cb127-586"></a><span class="bu">print</span>(<span class="st">'Train + Validation + Test: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span>(traintarget_size<span class="op">+</span>valtarget_size<span class="op">+</span>testtarget_size))</span>
<span id="cb127-587"><a href="#cb127-587"></a><span class="in">```</span></span>
<span id="cb127-588"><a href="#cb127-588"></a></span>
<span id="cb127-591"><a href="#cb127-591"></a><span class="in">```{python}</span></span>
<span id="cb127-592"><a href="#cb127-592"></a><span class="co"># Target Train-Validation-Test split(70-10-20)</span></span>
<span id="cb127-593"><a href="#cb127-593"></a>train_target, val_target,test_target <span class="op">=</span> Y2[<span class="dv">0</span>:traintarget_size], Y2[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)],Y2[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y2)]</span>
<span id="cb127-594"><a href="#cb127-594"></a></span>
<span id="cb127-595"><a href="#cb127-595"></a><span class="bu">print</span>(<span class="st">'Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(Y2)))</span>
<span id="cb127-596"><a href="#cb127-596"></a><span class="bu">print</span>(<span class="st">'Training Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_target)))</span>
<span id="cb127-597"><a href="#cb127-597"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_target)))</span>
<span id="cb127-598"><a href="#cb127-598"></a><span class="bu">print</span>(<span class="st">'Test Observations for Target: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_target)))</span>
<span id="cb127-599"><a href="#cb127-599"></a><span class="in">```</span></span>
<span id="cb127-600"><a href="#cb127-600"></a></span>
<span id="cb127-603"><a href="#cb127-603"></a><span class="in">```{python}</span></span>
<span id="cb127-604"><a href="#cb127-604"></a><span class="co"># Features Train--Val-Test split</span></span>
<span id="cb127-605"><a href="#cb127-605"></a></span>
<span id="cb127-606"><a href="#cb127-606"></a>trainfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.70</span>)</span>
<span id="cb127-607"><a href="#cb127-607"></a>valfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.10</span>)<span class="op">+</span><span class="dv">2</span><span class="co"># Set split</span></span>
<span id="cb127-608"><a href="#cb127-608"></a>testfeature_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(X2) <span class="op">*</span> <span class="fl">0.20</span>)<span class="co"># Set split</span></span>
<span id="cb127-609"><a href="#cb127-609"></a>train_feature, val_feature,test_feature <span class="op">=</span> X2[<span class="dv">0</span>:traintarget_size],X2[(traintarget_size):(traintarget_size<span class="op">+</span>valtarget_size)] ,X2[(traintarget_size<span class="op">+</span>valtarget_size):<span class="bu">len</span>(Y2)]</span>
<span id="cb127-610"><a href="#cb127-610"></a></span>
<span id="cb127-611"><a href="#cb127-611"></a><span class="bu">print</span>(<span class="st">'Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(X2)))</span>
<span id="cb127-612"><a href="#cb127-612"></a><span class="bu">print</span>(<span class="st">'Training Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(train_feature)))</span>
<span id="cb127-613"><a href="#cb127-613"></a><span class="bu">print</span>(<span class="st">'Validation Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(val_feature)))</span>
<span id="cb127-614"><a href="#cb127-614"></a><span class="bu">print</span>(<span class="st">'Test Observations for Feature: </span><span class="sc">%d</span><span class="st">'</span> <span class="op">%</span> (<span class="bu">len</span>(test_feature)))</span>
<span id="cb127-615"><a href="#cb127-615"></a><span class="in">```</span></span>
<span id="cb127-616"><a href="#cb127-616"></a></span>
<span id="cb127-617"><a href="#cb127-617"></a><span class="fu">### Árbol</span></span>
<span id="cb127-618"><a href="#cb127-618"></a></span>
<span id="cb127-621"><a href="#cb127-621"></a><span class="in">```{python}</span></span>
<span id="cb127-622"><a href="#cb127-622"></a><span class="co"># Decision Tree Regresion Model</span></span>
<span id="cb127-623"><a href="#cb127-623"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb127-624"><a href="#cb127-624"></a><span class="co"># Create a decision tree regression model with default arguments</span></span>
<span id="cb127-625"><a href="#cb127-625"></a>decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor()  <span class="co"># max-depth not set</span></span>
<span id="cb127-626"><a href="#cb127-626"></a><span class="co"># The maximum depth of the tree. If None, then nodes are expanded until all leaves are pure or until all leaves contain less than min_samples_split samples.</span></span>
<span id="cb127-627"><a href="#cb127-627"></a><span class="co"># Fit the model to the training features(covariables) and targets(respuestas)</span></span>
<span id="cb127-628"><a href="#cb127-628"></a>decision_tree_Dif.fit(train_feature, train_target)</span>
<span id="cb127-629"><a href="#cb127-629"></a><span class="co"># Check the score on train and test</span></span>
<span id="cb127-630"><a href="#cb127-630"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Dif.score(train_feature, train_target))</span>
<span id="cb127-631"><a href="#cb127-631"></a><span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de Validación:"</span>,decision_tree_Dif.score(val_feature,val_target))  <span class="co"># predictions are horrible if negative value, no relationship if 0</span></span>
<span id="cb127-632"><a href="#cb127-632"></a><span class="bu">print</span>(<span class="st">"el RECM sobre validación es:"</span>,(((decision_tree_Dif.predict(val_feature)<span class="op">-</span>val_target)<span class="op">**</span><span class="dv">2</span>).mean()) )</span>
<span id="cb127-633"><a href="#cb127-633"></a><span class="in">```</span></span>
<span id="cb127-634"><a href="#cb127-634"></a></span>
<span id="cb127-635"><a href="#cb127-635"></a>Vemos que el $R^2$ en la validaciòn nos da negativo lo cual indica que el modelo es malo en las predicciones, pues es mejor predecir con la media cal sería un $R^2 = 0$. intentaremos ajustar la profundidad del árbol para ver si mejoramos esto.</span>
<span id="cb127-636"><a href="#cb127-636"></a></span>
<span id="cb127-639"><a href="#cb127-639"></a><span class="in">```{python}</span></span>
<span id="cb127-640"><a href="#cb127-640"></a><span class="co"># Find the best Max Depth</span></span>
<span id="cb127-641"><a href="#cb127-641"></a></span>
<span id="cb127-642"><a href="#cb127-642"></a><span class="co"># Loop through a few different max depths and check the performance</span></span>
<span id="cb127-643"><a href="#cb127-643"></a><span class="co"># Try different max depths. We want to optimize our ML models to make the best predictions possible.</span></span>
<span id="cb127-644"><a href="#cb127-644"></a><span class="co"># For regular decision trees, max_depth, which is a hyperparameter, limits the number of splits in a tree.</span></span>
<span id="cb127-645"><a href="#cb127-645"></a><span class="co"># You can find the best value of max_depth based on the R-squared score of the model on the test set.</span></span>
<span id="cb127-646"><a href="#cb127-646"></a></span>
<span id="cb127-647"><a href="#cb127-647"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>]:</span>
<span id="cb127-648"><a href="#cb127-648"></a>    <span class="co"># Create the tree and fit it</span></span>
<span id="cb127-649"><a href="#cb127-649"></a>    decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span>d)</span>
<span id="cb127-650"><a href="#cb127-650"></a>    decision_tree_Dif.fit(train_feature, train_target)</span>
<span id="cb127-651"><a href="#cb127-651"></a>    </span>
<span id="cb127-652"><a href="#cb127-652"></a>    <span class="co"># Print out the scores on train and test</span></span>
<span id="cb127-653"><a href="#cb127-653"></a>    <span class="bu">print</span>(<span class="st">'max_depth='</span>, <span class="bu">str</span>(d))</span>
<span id="cb127-654"><a href="#cb127-654"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de entrenamiento:"</span>,decision_tree_Dif.score(train_feature, train_target))</span>
<span id="cb127-655"><a href="#cb127-655"></a>    <span class="bu">print</span>(<span class="st">"Coeficiente R2 sobre el conjunto de validación:"</span>,decision_tree_Dif.score(val_feature, val_target), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)  <span class="co"># You want the test score to be positive and high</span></span>
<span id="cb127-656"><a href="#cb127-656"></a>    <span class="bu">print</span>(<span class="st">"el RECM sobre el conjunto de validación es:"</span>,sklearn.metrics.mean_squared_error(decision_tree_Dif.predict(val_feature),val_target, squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-657"><a href="#cb127-657"></a></span>
<span id="cb127-658"><a href="#cb127-658"></a><span class="in">```</span></span>
<span id="cb127-659"><a href="#cb127-659"></a></span>
<span id="cb127-660"><a href="#cb127-660"></a>Note que el score mayor para el conjunto de prueba es para max depth = 2. También que es valor es negativo pero cercano a 0 Con este valor de hiperparámetro juntamos validación y entrenamiento para reestimar los parámetros.</span>
<span id="cb127-661"><a href="#cb127-661"></a></span>
<span id="cb127-664"><a href="#cb127-664"></a><span class="in">```{python}</span></span>
<span id="cb127-665"><a href="#cb127-665"></a><span class="bu">print</span>(<span class="bu">type</span>(train_feature))</span>
<span id="cb127-666"><a href="#cb127-666"></a><span class="bu">print</span>(<span class="bu">type</span>(val_feature))</span>
<span id="cb127-667"><a href="#cb127-667"></a><span class="co">#######</span></span>
<span id="cb127-668"><a href="#cb127-668"></a><span class="bu">print</span>(<span class="bu">type</span>(train_target))</span>
<span id="cb127-669"><a href="#cb127-669"></a><span class="bu">print</span>(<span class="bu">type</span>(val_target))</span>
<span id="cb127-670"><a href="#cb127-670"></a><span class="co">####</span></span>
<span id="cb127-671"><a href="#cb127-671"></a><span class="bu">print</span>(train_feature.shape)</span>
<span id="cb127-672"><a href="#cb127-672"></a><span class="bu">print</span>(val_feature.shape)</span>
<span id="cb127-673"><a href="#cb127-673"></a><span class="co">#####</span></span>
<span id="cb127-674"><a href="#cb127-674"></a><span class="co">####</span></span>
<span id="cb127-675"><a href="#cb127-675"></a><span class="bu">print</span>(train_target.shape)</span>
<span id="cb127-676"><a href="#cb127-676"></a><span class="bu">print</span>(val_target.shape)</span>
<span id="cb127-677"><a href="#cb127-677"></a><span class="co">###Concatenate Validation and test</span></span>
<span id="cb127-678"><a href="#cb127-678"></a>train_val_feature<span class="op">=</span>np.concatenate((train_feature,val_feature),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb127-679"><a href="#cb127-679"></a>train_val_target<span class="op">=</span>np.concatenate((train_target,val_target),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb127-680"><a href="#cb127-680"></a><span class="bu">print</span>(train_val_feature.shape)</span>
<span id="cb127-681"><a href="#cb127-681"></a><span class="bu">print</span>(train_val_target.shape)</span>
<span id="cb127-682"><a href="#cb127-682"></a><span class="in">```</span></span>
<span id="cb127-683"><a href="#cb127-683"></a></span>
<span id="cb127-686"><a href="#cb127-686"></a><span class="in">```{python}</span></span>
<span id="cb127-687"><a href="#cb127-687"></a><span class="co"># Use the best max_depth </span></span>
<span id="cb127-688"><a href="#cb127-688"></a>decision_tree_Dif <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">2</span>)  <span class="co"># fill in best max depth here</span></span>
<span id="cb127-689"><a href="#cb127-689"></a>decision_tree_Dif.fit(train_val_feature, train_val_target)</span>
<span id="cb127-690"><a href="#cb127-690"></a></span>
<span id="cb127-691"><a href="#cb127-691"></a><span class="co"># Predict values for train and test</span></span>
<span id="cb127-692"><a href="#cb127-692"></a>train_val_prediction <span class="op">=</span> decision_tree_Dif.predict(train_val_feature)</span>
<span id="cb127-693"><a href="#cb127-693"></a>test_prediction <span class="op">=</span> decision_tree_Dif.predict(test_feature)</span>
<span id="cb127-694"><a href="#cb127-694"></a></span>
<span id="cb127-695"><a href="#cb127-695"></a><span class="co"># Scatter the predictions vs actual values</span></span>
<span id="cb127-696"><a href="#cb127-696"></a>plt.scatter(train_val_prediction, train_val_target, label<span class="op">=</span><span class="st">'train'</span>)  <span class="co"># blue</span></span>
<span id="cb127-697"><a href="#cb127-697"></a>plt.scatter(test_prediction, test_target, label<span class="op">=</span><span class="st">'test'</span>)  <span class="co"># orange</span></span>
<span id="cb127-698"><a href="#cb127-698"></a><span class="co"># Agrega títulos a los ejes</span></span>
<span id="cb127-699"><a href="#cb127-699"></a>plt.xlabel(<span class="st">'Valores Predichos'</span>)  <span class="co"># Título para el eje x</span></span>
<span id="cb127-700"><a href="#cb127-700"></a>plt.ylabel(<span class="st">'Valores Objetivo'</span>)  <span class="co"># Título para el eje y</span></span>
<span id="cb127-701"><a href="#cb127-701"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb127-702"><a href="#cb127-702"></a>plt.legend()</span>
<span id="cb127-703"><a href="#cb127-703"></a>plt.show()</span>
<span id="cb127-704"><a href="#cb127-704"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Entrenamiento:"</span>,sklearn.metrics.mean_squared_error( train_val_prediction, train_val_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-705"><a href="#cb127-705"></a></span>
<span id="cb127-706"><a href="#cb127-706"></a><span class="bu">print</span>(<span class="st">"Raíz de la Pérdida cuadrática Prueba:"</span>,sklearn.metrics.mean_squared_error(test_prediction, test_target,squared<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb127-707"><a href="#cb127-707"></a><span class="in">```</span></span>
<span id="cb127-708"><a href="#cb127-708"></a></span>
<span id="cb127-709"><a href="#cb127-709"></a>Podemos notar que aparecen dos valores extremos los cuales pueden influir en el resultado, ademàs los valores de RECM son similares para entrenamiento y prueba.</span>
<span id="cb127-710"><a href="#cb127-710"></a></span>
<span id="cb127-713"><a href="#cb127-713"></a><span class="in">```{python}</span></span>
<span id="cb127-714"><a href="#cb127-714"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb127-715"><a href="#cb127-715"></a></span>
<span id="cb127-716"><a href="#cb127-716"></a>listacaract<span class="op">=</span><span class="bu">list</span>(df2_Dif.columns.values)</span>
<span id="cb127-717"><a href="#cb127-717"></a>respuesta<span class="op">=</span>listacaract.pop()</span>
<span id="cb127-718"><a href="#cb127-718"></a>text_representation <span class="op">=</span> tree.export_text(decision_tree_Dif)</span>
<span id="cb127-719"><a href="#cb127-719"></a><span class="bu">print</span>(text_representation)</span>
<span id="cb127-720"><a href="#cb127-720"></a><span class="in">```</span></span>
<span id="cb127-721"><a href="#cb127-721"></a></span>
<span id="cb127-724"><a href="#cb127-724"></a><span class="in">```{python}</span></span>
<span id="cb127-725"><a href="#cb127-725"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb127-726"><a href="#cb127-726"></a>_ <span class="op">=</span> tree.plot_tree(decision_tree_Dif, </span>
<span id="cb127-727"><a href="#cb127-727"></a>                   feature_names<span class="op">=</span>listacaract,  </span>
<span id="cb127-728"><a href="#cb127-728"></a>                   class_names<span class="op">=</span>[respuesta],</span>
<span id="cb127-729"><a href="#cb127-729"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-730"><a href="#cb127-730"></a><span class="in">```</span></span>
<span id="cb127-731"><a href="#cb127-731"></a></span>
<span id="cb127-732"><a href="#cb127-732"></a>Veremos cómo se ve estos datos para la serie diferenciada.</span>
<span id="cb127-733"><a href="#cb127-733"></a></span>
<span id="cb127-736"><a href="#cb127-736"></a><span class="in">```{python}</span></span>
<span id="cb127-737"><a href="#cb127-737"></a><span class="bu">print</span>(train_val_prediction.size)</span>
<span id="cb127-738"><a href="#cb127-738"></a><span class="bu">print</span>(train_val_target.size)</span>
<span id="cb127-739"><a href="#cb127-739"></a></span>
<span id="cb127-740"><a href="#cb127-740"></a><span class="bu">print</span>(test_prediction.size)</span>
<span id="cb127-741"><a href="#cb127-741"></a><span class="bu">print</span>(test_target.size)</span>
<span id="cb127-742"><a href="#cb127-742"></a><span class="in">```</span></span>
<span id="cb127-743"><a href="#cb127-743"></a></span>
<span id="cb127-746"><a href="#cb127-746"></a><span class="in">```{python}</span></span>
<span id="cb127-747"><a href="#cb127-747"></a>indicetrian_val_test<span class="op">=</span>df2_Dif.index</span>
<span id="cb127-748"><a href="#cb127-748"></a><span class="bu">print</span>(indicetrian_val_test.size)  <span class="co">###Tamaño del índice</span></span>
<span id="cb127-749"><a href="#cb127-749"></a>indicetrain_val<span class="op">=</span>indicetrian_val_test[<span class="dv">0</span>:<span class="dv">1458</span>]</span>
<span id="cb127-750"><a href="#cb127-750"></a>indicetest<span class="op">=</span>indicetrian_val_test[<span class="dv">1458</span>:<span class="dv">1822</span>]</span>
<span id="cb127-751"><a href="#cb127-751"></a><span class="in">```</span></span>
<span id="cb127-752"><a href="#cb127-752"></a></span>
<span id="cb127-755"><a href="#cb127-755"></a><span class="in">```{python}</span></span>
<span id="cb127-756"><a href="#cb127-756"></a><span class="bu">print</span>(indicetrain_val.size)</span>
<span id="cb127-757"><a href="#cb127-757"></a><span class="bu">print</span>(indicetest.size)</span>
<span id="cb127-758"><a href="#cb127-758"></a><span class="in">```</span></span>
<span id="cb127-759"><a href="#cb127-759"></a></span>
<span id="cb127-762"><a href="#cb127-762"></a><span class="in">```{python}</span></span>
<span id="cb127-763"><a href="#cb127-763"></a>targetjoint<span class="op">=</span>np.concatenate((train_val_target,test_target))</span>
<span id="cb127-764"><a href="#cb127-764"></a>predictionjoint<span class="op">=</span>np.concatenate((train_val_prediction,test_prediction))</span>
<span id="cb127-765"><a href="#cb127-765"></a><span class="bu">print</span>(targetjoint.size)</span>
<span id="cb127-766"><a href="#cb127-766"></a><span class="bu">print</span>(predictionjoint.size)</span>
<span id="cb127-767"><a href="#cb127-767"></a><span class="in">```</span></span>
<span id="cb127-768"><a href="#cb127-768"></a></span>
<span id="cb127-771"><a href="#cb127-771"></a><span class="in">```{python}</span></span>
<span id="cb127-772"><a href="#cb127-772"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: targetjoint, <span class="st">'Predicción'</span>: predictionjoint}</span>
<span id="cb127-773"><a href="#cb127-773"></a>ObsvsPred2<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb127-774"><a href="#cb127-774"></a>ObsvsPred2.head(<span class="dv">10</span>)</span>
<span id="cb127-775"><a href="#cb127-775"></a><span class="in">```</span></span>
<span id="cb127-776"><a href="#cb127-776"></a></span>
<span id="cb127-779"><a href="#cb127-779"></a><span class="in">```{python}</span></span>
<span id="cb127-780"><a href="#cb127-780"></a><span class="co">#gráfico</span></span>
<span id="cb127-781"><a href="#cb127-781"></a>ax <span class="op">=</span> ObsvsPred2[<span class="st">'observado'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb127-782"><a href="#cb127-782"></a>ObsvsPred2[<span class="st">'Predicción'</span>].plot(marker<span class="op">=</span><span class="st">"o"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)  <span class="co"># Ajusta el grosor de las líneas y puntos</span></span>
<span id="cb127-783"><a href="#cb127-783"></a><span class="co"># Agrega una línea vertical roja</span></span>
<span id="cb127-784"><a href="#cb127-784"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1459</span>].date(), color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Ajusta el grosor de la línea vertical</span></span>
<span id="cb127-785"><a href="#cb127-785"></a><span class="co"># Muestra una leyenda</span></span>
<span id="cb127-786"><a href="#cb127-786"></a>plt.legend()</span>
<span id="cb127-787"><a href="#cb127-787"></a>plt.show()</span>
<span id="cb127-788"><a href="#cb127-788"></a><span class="in">```</span></span>
<span id="cb127-789"><a href="#cb127-789"></a></span>
<span id="cb127-790"><a href="#cb127-790"></a>Podemos observar que dado que esta seríe es estacionaría los alores oscilan alrededor de un punto fijo el cual es $0$ y los valores de predicción son cercanos a él, con ellos el modelo no toma encuenta la información de los rezagos, para la predicción solo usa la media muestral lo cual se reflejaba en el $R^2 \approx 0$</span>
<span id="cb127-791"><a href="#cb127-791"></a></span>
<span id="cb127-792"><a href="#cb127-792"></a>Con esto podemos concluir que **los árboles de decisión** no son un buen modelo para tratar con una serie cómo esta</span>
<span id="cb127-793"><a href="#cb127-793"></a></span>
<span id="cb127-794"><a href="#cb127-794"></a>Esto sería lle varlo a la original lo cual me parece mala idea porque los valores son 0 entonces prácticamente usa el retardo anterior cómo predicción, además no se si poner la logaritmica</span>
<span id="cb127-795"><a href="#cb127-795"></a></span>
<span id="cb127-796"><a href="#cb127-796"></a>Ahora para poder obtener los valores en la serie original necesitamos hacer la transfromacion de las predicciones via $$\hat{y}_{t+h} = \hat{\Delta} y_{t+1} + y_{t}$$</span>
<span id="cb127-797"><a href="#cb127-797"></a></span>
<span id="cb127-800"><a href="#cb127-800"></a><span class="in">```{python}</span></span>
<span id="cb127-801"><a href="#cb127-801"></a>yhat <span class="op">=</span> ObsvsPred2[<span class="st">'Predicción'</span>]<span class="op">+</span>ObsvsPred1[<span class="st">'observado'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb127-802"><a href="#cb127-802"></a>yhat <span class="op">=</span> yhat.drop(<span class="st">'2017-01-04'</span>)</span>
<span id="cb127-803"><a href="#cb127-803"></a><span class="bu">print</span>(yhat)</span>
<span id="cb127-804"><a href="#cb127-804"></a><span class="in">```</span></span>
<span id="cb127-805"><a href="#cb127-805"></a></span>
<span id="cb127-808"><a href="#cb127-808"></a><span class="in">```{python}</span></span>
<span id="cb127-809"><a href="#cb127-809"></a>y <span class="op">=</span> ObsvsPred1[<span class="st">'observado'</span>]</span>
<span id="cb127-810"><a href="#cb127-810"></a>y <span class="op">=</span> y.drop(<span class="st">'2017-01-04'</span>)</span>
<span id="cb127-811"><a href="#cb127-811"></a>d <span class="op">=</span> {<span class="st">'observado'</span>: y, <span class="st">'Predicción'</span>: yhat}</span>
<span id="cb127-812"><a href="#cb127-812"></a>ObsvsPred3<span class="op">=</span>pd.DataFrame(data<span class="op">=</span>d,index<span class="op">=</span>indicetrian_val_test)</span>
<span id="cb127-813"><a href="#cb127-813"></a>ObsvsPred3.head(<span class="dv">10</span>)</span>
<span id="cb127-814"><a href="#cb127-814"></a><span class="in">```</span></span>
<span id="cb127-815"><a href="#cb127-815"></a></span>
<span id="cb127-818"><a href="#cb127-818"></a><span class="in">```{python}</span></span>
<span id="cb127-819"><a href="#cb127-819"></a>ax <span class="op">=</span> ObsvsPred3.plot( marker<span class="op">=</span><span class="st">"o"</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb127-820"><a href="#cb127-820"></a>ax.axvline(x<span class="op">=</span>indicetrian_val_test[<span class="dv">1458</span>].date(),color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb127-821"><a href="#cb127-821"></a><span class="in">```</span></span>
<span id="cb127-822"><a href="#cb127-822"></a></span>
<span id="cb127-823"><a href="#cb127-823"></a>Notamos los valores predichos para la diferencia son muy cercanos a cero lo cual al llervalos</span>
<span id="cb127-824"><a href="#cb127-824"></a></span>
<span id="cb127-825"><a href="#cb127-825"></a>Podemos concluir que los arboles de deicison no son buenos tratando con serie que presentan tendencia potencialmente estocastica y que</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>